{"version":3,"sources":["webpack://@fof/upload/webpack/bootstrap","webpack://@fof/upload/./forum.js","webpack://@fof/upload/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/upload/./src/common/fileToBBcode.js","webpack://@fof/upload/./src/common/mimeToIcon.js","webpack://@fof/upload/./src/common/models/File.js","webpack://@fof/upload/./src/forum/addUploadButton.js","webpack://@fof/upload/./src/forum/components/DragAndDrop.js","webpack://@fof/upload/./src/forum/components/FileManagerButton.js","webpack://@fof/upload/./src/forum/components/FileManagerModal.js","webpack://@fof/upload/./src/forum/components/PasteClipboard.js","webpack://@fof/upload/./src/forum/components/UploadButton.js","webpack://@fof/upload/./src/forum/components/UserFileList.js","webpack://@fof/upload/./src/forum/components/index.js","webpack://@fof/upload/./src/forum/downloadButtonInteraction.js","webpack://@fof/upload/./src/forum/handler/Uploader.js","webpack://@fof/upload/./src/forum/index.js","webpack://@fof/upload/./src/forum/states/FileListState.js","webpack://@fof/upload/external \"flarum.core.compat['Component']\"","webpack://@fof/upload/external \"flarum.core.compat['Model']\"","webpack://@fof/upload/external \"flarum.core.compat['app']\"","webpack://@fof/upload/external \"flarum.core.compat['components/Button']\"","webpack://@fof/upload/external \"flarum.core.compat['components/LoadingIndicator']\"","webpack://@fof/upload/external \"flarum.core.compat['components/Modal']\"","webpack://@fof/upload/external \"flarum.core.compat['components/Post']\"","webpack://@fof/upload/external \"flarum.core.compat['components/TextEditor']\"","webpack://@fof/upload/external \"flarum.core.compat['extend']\"","webpack://@fof/upload/external \"flarum.core.compat['utils/classList']\"","webpack://@fof/upload/external \"flarum.core.compat['utils/mixin']\""],"names":["fileToBBcode","file","tag","uuid","humanSize","baseName","url","image","archive","code","word","mimeToIcon","fileType","indexOf","includes","File","apiEndpoint","exists","data","id","bbcode","mixin","Model","attribute","path","type","size","createdAt","extend","TextEditor","prototype","uploader","Uploader","items","app","forum","add","FileManagerButton","component","UploadButton","f_","vnode","on","addBBcode","attrs","composer","editor","insertAtCursor","preview","originalIsFullScreen","isFullScreen","dragAndDrop","DragAndDrop","files","upload","$","parents","unloadHandler","unload","bind","PasteClipboard","composerElement","handlers","supportsFileDragging","addEventListener","out","dropping","div","document","createElement","window","removeEventListener","isNotFile","event","dataTransfer","i","length","kind","preventDefault","over","classList","remove","view","Button","className","onclick","fileManagerButtonClicked","icon","title","translator","trans","oncreate","tooltip","e","modal","show","FileManagerModal","selectFile","Component","oninit","selectedFiles","multiSelect","dragDrop","onUpload","find","onremove","disabled","fileListState","isLoading","isMediaUploadButton","alertAttrs","Alert","UserFileList","user","selectable","onFileSelect","hide","onSelect","transChoice","itemPosition","splice","push","map","fileId","store","getById","Modal","textAreaElement","paste","clipboardData","getAsFile","reset","m","redraw","buttonText","uploading","uploadButtonClicked","LoadingIndicator","process","prop","click","setUser","session","inModal","restrictFileType","state","empty","screen","fileClassNames","fileIcon","fileSelectable","isSelectable","hasMoreResults","loadMore","Array","isArray","components","Post","unbind","stopPropagation","alert","currentTarget","dataset","fofUploadDownloadUuid","post","csrfToken","open","callbacks","success","failure","uploaded","callback","dispatch","response","forEach","body","FormData","append","request","method","serialize","raw","then","result","error","fileObj","pushObject","addToList","initializers","addUploadButton","downloadButtonInteraction","models","FileListState","moreResults","loading","loadResults","offset","filter","page","parseResults","results","payload","links","next","unshift","hasFiles"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\r\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","export default function fileToBBcode(file) {\r\n    switch(file.tag()) {\r\n        // File\r\n        case \"file\":\r\n            return `[upl-file uuid=${file.uuid()} size=${file.humanSize()}]${file.baseName()}[/upl-file]`;\r\n\r\n        // Image template\r\n        case \"image\":\r\n            return `[upl-image uuid=${file.uuid()} size=${file.humanSize()} url=${file.url()}]${file.baseName()}[/upl-image]`;\r\n\r\n        // Image preview\r\n        case \"image-preview\":\r\n            return `[upl-image-preview url=${file.url()}]`;\r\n\r\n        // 'just-url' or unknown\r\n        default:\r\n            return file.url();\r\n    }\r\n}","const image = [\"image/png\", \"image/jpg\", \"image/jpeg\", \"image/svg+xml\"];\r\nconst archive = [\"application/zip\", \"application/x-7z-compressed\", \"application/gzip\", \"application/vnd.rar\", \"application/x-rar-compressed\"];\r\nconst code = [\"text/html\", \"text/css\", \"text/javascript\", \"application/json\", \"application/ld+json\", \"text/javascript\", \"application/x-httpd-php\"];\r\nconst word = [\"application/x-abiword\", \"application/msword\", \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\"];\r\n\r\nexport default function mimeToIcon(fileType) {\r\n    // Display image (do not display for)\r\n    if(image.indexOf(fileType) >= 0) {\r\n        return 'image';\r\n    }\r\n    // Display image icon for other types\r\n    else if(fileType.includes(\"image/\")) {\r\n        return 'far fa-file-image';\r\n    }\r\n    // Video icon\r\n    else if(fileType.includes(\"video/\")) {\r\n        return 'far fa-file-video';\r\n    }\r\n    // Archive icon\r\n    else if(archive.indexOf(fileType) >= 0) {\r\n        return 'far fa-file-archive';\r\n    }\r\n    // PDF icon\r\n    else if(fileType === \"application/pdf\") {\r\n        return 'far fa-file-pdf';\r\n    }\r\n    // Word\r\n    else if(word.indexOf(fileType) >= 0) {\r\n        return 'far fa-file-word';\r\n    }\r\n    // Audio icon\r\n    else if(fileType.includes(\"audio/\")) {\r\n        return 'far fa-file-audio';\r\n    }\r\n    // Code files\r\n    else if(code.indexOf(fileType) >= 0) {\r\n        return 'far fa-file-code';\r\n    }\r\n    \r\n    return 'far fa-file';\r\n}","import Model from \"flarum/Model\";\r\nimport mixin from \"flarum/utils/mixin\";\r\nimport fileToBBcode from \"../fileToBBcode\";\r\n\r\nexport default class File extends mixin(Model, {\r\n    baseName: Model.attribute(\"baseName\"),\r\n    path: Model.attribute(\"path\"),\r\n    url: Model.attribute(\"url\"),\r\n    type: Model.attribute(\"type\"),\r\n    size: Model.attribute(\"size\"),\r\n    humanSize: Model.attribute(\"humanSize\"),\r\n    createdAt: Model.attribute(\"createdAt\"),\r\n    uuid: Model.attribute(\"uuid\"),\r\n    tag: Model.attribute(\"tag\"),\r\n}) {\r\n    /**\r\n     * Use FoF Uploads endpoint\r\n     */\r\n    apiEndpoint() {\r\n        return '/fof/uploads' + (this.exists ? '/' + this.data.id : '');\r\n    }\r\n\r\n    /**\r\n     * Generate bbcode for this file\r\n     */\r\n    bbcode() {\r\n        return fileToBBcode(this);\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport { extend } from 'flarum/extend';\r\nimport TextEditor from 'flarum/components/TextEditor';\r\nimport UploadButton from './components/UploadButton';\r\nimport DragAndDrop from './components/DragAndDrop';\r\nimport PasteClipboard from './components/PasteClipboard';\r\nimport Uploader from './handler/Uploader';\r\nimport FileManagerButton from './components/FileManagerButton';\r\n\r\nexport default function () {\r\n    extend(TextEditor.prototype, 'oninit', function () {\r\n        this.uploader = new Uploader();\r\n    });\r\n    extend(TextEditor.prototype, 'controlItems', function (items) {\r\n        if (!app.forum.attribute('fof-upload.canUpload')) return;\r\n\r\n        // Add media button\r\n        items.add(\r\n            'fof-upload-media',\r\n            FileManagerButton.component({\r\n                uploader: this.uploader,\r\n            })\r\n        );\r\n\r\n        // Add upload button\r\n        items.add(\r\n            'fof-upload',\r\n            UploadButton.component({\r\n                uploader: this.uploader,\r\n            })\r\n        );\r\n    });\r\n\r\n    extend(TextEditor.prototype, 'oncreate', function (f_, vnode) {\r\n        if (!app.forum.attribute('fof-upload.canUpload')) return;\r\n\r\n        this.uploader.on('success', ({ file, addBBcode }) => {\r\n            if(!addBBcode) return;\r\n\r\n            this.attrs.composer.editor.insertAtCursor(file.bbcode() + '\\n');\r\n\r\n            // We wrap this in a typeof check to prevent it running when a user\r\n            // is creating a new discussion. There's nothing to preview in a new\r\n            // discussion, so the `preview` function isn't defined.\r\n            if (typeof this.attrs.preview === 'function') {\r\n                // Scroll the preview into view\r\n                // preview() causes the composer to close on mobile, but we don't want that. We want only the scroll\r\n                // We work around that by temporarily patching the isFullScreen method\r\n                const originalIsFullScreen = app.composer.isFullScreen;\r\n\r\n                app.composer.isFullScreen = () => false;\r\n\r\n                this.attrs.preview();\r\n\r\n                app.composer.isFullScreen = originalIsFullScreen;\r\n            }\r\n        });\r\n\r\n        const dragAndDrop = new DragAndDrop((files) => this.uploader.upload(files), this.$().parents('.Composer')[0]);\r\n\r\n        const unloadHandler = () => {\r\n            dragAndDrop.unload();\r\n        };\r\n\r\n        this.$('textarea').bind('onunload', unloadHandler);\r\n\r\n        new PasteClipboard((files) => this.uploader.upload(files), this.$('textarea')[0]);\r\n    });\r\n}\r\n","export default class DragAndDrop {\r\n    constructor(upload, composerElement) {\r\n        this.upload = upload;\r\n        this.composerElement = composerElement;\r\n\r\n        // Keep references to the bound methods so we can remove the event listeners later\r\n        this.handlers = {};\r\n\r\n        if (!this.supportsFileDragging()) {\r\n            return;\r\n        }\r\n\r\n        this.composerElement.addEventListener('dragover', (this.handlers.in = this.in.bind(this)));\r\n\r\n        this.composerElement.addEventListener('dragleave', (this.handlers.out = this.out.bind(this)));\r\n        this.composerElement.addEventListener('dragend', this.handlers.out);\r\n\r\n        this.composerElement.addEventListener('drop', (this.handlers.dropping = this.dropping.bind(this)));\r\n    }\r\n\r\n    supportsFileDragging() {\r\n        // Based on https://css-tricks.com/drag-and-drop-file-uploading/\r\n        const div = document.createElement('div');\r\n\r\n        return ('draggable' in div || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\r\n    }\r\n\r\n    unload() {\r\n        // If the handlers were not set (drag and drop not supported), we skip removing them\r\n        if (!this.handlers.in) {\r\n            return;\r\n        }\r\n\r\n        this.composerElement.removeEventListener('dragover', this.handlers.in);\r\n\r\n        this.composerElement.removeEventListener('dragleave', this.handlers.out);\r\n        this.composerElement.removeEventListener('dragend', this.handlers.out);\r\n\r\n        this.composerElement.removeEventListener('drop', this.handlers.dropping);\r\n    }\r\n\r\n    isNotFile(event) {\r\n        // Checking event.dataTransfer.files.length does not work on dragover event, it's always zero\r\n        // So we use the dataTransfer.items property to check whether any file is being dragged\r\n        if (event.dataTransfer.items) {\r\n            for (let i = 0; i < event.dataTransfer.items.length; i++) {\r\n                if (event.dataTransfer.items[i].kind !== 'file') {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    in(event) {\r\n        if (this.isNotFile(event)) {\r\n            return;\r\n        }\r\n\r\n        event.preventDefault();\r\n\r\n        if (!this.over) {\r\n            this.composerElement.classList.add('fof-upload-dragging');\r\n            this.over = true;\r\n        }\r\n    }\r\n\r\n    out(event) {\r\n        if (this.isNotFile(event)) {\r\n            return;\r\n        }\r\n\r\n        event.preventDefault();\r\n\r\n        if (this.over) {\r\n            this.composerElement.classList.remove('fof-upload-dragging');\r\n            this.over = false;\r\n        }\r\n    }\r\n\r\n    dropping(event) {\r\n        if (this.isNotFile(event)) {\r\n            return;\r\n        }\r\n\r\n        event.preventDefault();\r\n\r\n        this.upload(event.dataTransfer.files);\r\n\r\n        this.composerElement.classList.remove('fof-upload-dragging');\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport Component from 'flarum/Component';\r\nimport Button from 'flarum/components/Button';\r\nimport FileManagerModal from './FileManagerModal';\r\n\r\nexport default class FileManagerButton extends Component {\r\n    view() {\r\n        return Button.component({\r\n            className: \"Button fof-upload-button Button--icon\",\r\n            onclick: this.fileManagerButtonClicked.bind(this),\r\n            icon: 'fas fa-photo-video',\r\n            title: app.translator.trans('fof-upload.forum.buttons.media')\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Show tooltip on hover\r\n     * \r\n     * @param {*} vnode \r\n     */\r\n    oncreate(vnode) {\r\n        super.oncreate(vnode);\r\n  \r\n        // Add tooltip\r\n        this.$().tooltip();\r\n    }\r\n\r\n    /**\r\n     * Event handler for upload button being clicked\r\n     *\r\n     * @param {PointerEvent} e\r\n     */\r\n    fileManagerButtonClicked(e) {\r\n        e.preventDefault();\r\n\r\n        // Open dialog\r\n        app.modal.show(FileManagerModal, {\r\n            selectFile: true,\r\n            uploader: this.attrs.uploader\r\n        });\r\n    }\r\n}\r\n","import Modal from \"flarum/components/Modal\";\r\nimport Button from \"flarum/components/Button\";\r\nimport UploadButton from \"./UploadButton\";\r\nimport UserFileList from \"./UserFileList\";\r\nimport DragAndDrop from \"./DragAndDrop\";\r\n\r\nexport default class FileManagerModal extends Modal {\r\n    oninit(vnode) {\r\n        super.oninit(vnode);\r\n\r\n        // Initialize upload managers\r\n        this.uploader = vnode.attrs.uploader;\r\n\r\n        // Current selected files\r\n        this.selectedFiles = [];\r\n\r\n        // Allow multiselect\r\n        this.multiSelect = vnode.attrs.multiSelect || false;\r\n\r\n        // Drag & drop\r\n        this.dragDrop = null;\r\n\r\n        // Initialize uploads\r\n        this.onUpload();\r\n    }\r\n\r\n    className() {\r\n      return \"Modal--large fof-file-manager-modal\";\r\n    }\r\n\r\n    /**\r\n     * Initialize drag & drop\r\n     */\r\n    oncreate(vnode) {\r\n        super.oncreate(vnode);\r\n\r\n        this.dragDrop = new DragAndDrop((files) => this.uploader.upload(files, false), this.$().find(\".Modal-content\")[0]);\r\n    }\r\n\r\n    /**\r\n     * Remove events from modal content\r\n     */\r\n    onremove() {\r\n        if(this.dragDrop) {\r\n            this.dragDrop.unload();\r\n        }\r\n    }\r\n\r\n    view() {\r\n        return (\r\n            <div className={'Modal modal-dialog ' + this.className()}>\r\n                <div className=\"Modal-content\">\r\n                    <div className=\"fof-modal-buttons App-backControl\">\r\n                        {UploadButton.component({\r\n                            uploader: this.uploader,\r\n                            disabled: app.fileListState.isLoading(),\r\n                            isMediaUploadButton: true\r\n                        })}\r\n                    </div>\r\n\r\n                    <div className={\"fof-drag-and-drop\"}>\r\n                        <div className={\"fof-drag-and-drop-release\"}>\r\n                            <i className={\"fas fa-cloud-upload-alt\"}></i>\r\n\r\n                            {app.translator.trans(\"fof-upload.forum.file_list.release_to_upload\")}\r\n                        </div>\r\n                    </div>\r\n        \r\n                    <div className=\"Modal-header\">\r\n                        <h3 className=\"App-titleControl App-titleControl--text\">{app.translator.trans(\"fof-upload.forum.media_manager\")}</h3>\r\n                    </div>\r\n\r\n                    {this.alertAttrs ? <div className=\"Modal-alert\">{Alert.component(this.alertAttrs)}</div> : ''}\r\n\r\n                    <div className={\"Modal-body\"}>\r\n                        {UserFileList.component({\r\n                            user: this.attrs.user,\r\n                            selectable: true,\r\n                            onFileSelect: this.onFileSelect.bind(this),\r\n                            selectedFiles: this.selectedFiles\r\n                        })}\r\n                    </div>\r\n\r\n                    <div className={\"Modal-footer\"}>\r\n                        {Button.component({\r\n                            onclick: this.hide.bind(this),\r\n                            className: 'Button',\r\n                        }, app.translator.trans(\"fof-upload.forum.buttons.cancel\"))}\r\n\r\n                        {Button.component({\r\n                            onclick: this.onSelect.bind(this),\r\n                            disabled: this.selectedFiles.length === 0 || !this.multiSelect && this.selectedFiles.length > 1,\r\n                            className: 'Button Button--primary',\r\n                        }, app.translator.transChoice('fof-upload.forum.buttons.select_file', this.selectedFiles.length))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Add or remove file from selected files\r\n     * \r\n     * @param {File} file \r\n     */\r\n    onFileSelect(file) {\r\n        const itemPosition = this.selectedFiles.indexOf(file.id());\r\n\r\n        if(itemPosition >= 0) {\r\n            this.selectedFiles.splice(itemPosition, 1);\r\n        }else{\r\n            if(this.multiSelect) {\r\n                this.selectedFiles.push(file.id());\r\n            }else{\r\n                this.selectedFiles = [file.id()];\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Add files to file list after upload\r\n     */\r\n    onUpload() {\r\n        this.uploader.on('success', ({ file }) => {\r\n            if(this.multiSelect) {\r\n                this.selectedFiles.push(file.id());\r\n            }else{\r\n                this.selectedFiles = [file.id()];\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Add selected files to the composer\r\n     */\r\n    onSelect() {\r\n        this.hide();\r\n\r\n        // Custom callback\r\n        if(this.attrs.onSelect) {\r\n            this.attrs.onSelect(this.selectedFiles);\r\n\r\n            return;\r\n        }\r\n        \r\n        // Add selected files to composer\r\n        this.selectedFiles.map((fileId) => {\r\n            const file = app.store.getById(\"files\", fileId);\r\n\r\n            app.composer.editor.insertAtCursor(file.bbcode() + '\\n')\r\n        });\r\n    }\r\n}","export default class PasteClipboard {\r\n    constructor(upload, textAreaElement) {\r\n        this.upload = upload;\r\n\r\n        // We don't need to remove the events listeners, because they are bound to the textarea when it's created,\r\n        // and need to stay as long as the textarea exists in the DOM\r\n        textAreaElement.addEventListener('paste', this.paste.bind(this));\r\n    }\r\n\r\n    paste(e) {\r\n        if (e.clipboardData && e.clipboardData.items) {\r\n            const items = e.clipboardData.items;\r\n\r\n            const files = [];\r\n\r\n            for (let i = 0; i < items.length; i++) {\r\n                if (items[i].type.indexOf('image') !== -1) {\r\n                    files.push(items[i].getAsFile());\r\n                }\r\n            }\r\n\r\n            if (files.length > 0) {\r\n                e.preventDefault();\r\n\r\n                this.upload(files);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport Component from 'flarum/Component';\r\nimport classList from 'flarum/utils/classList';\r\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\r\nimport Button from 'flarum/components/Button';\r\n\r\nexport default class UploadButton extends Component {\r\n    oninit(vnode) {\r\n        super.oninit(vnode);\r\n\r\n        this.attrs.uploader.on('uploaded', () => {\r\n            // reset the button for a new upload\r\n            this.$('form')[0].reset();\r\n\r\n            // redraw to reflect uploader.loading in the DOM\r\n            m.redraw();\r\n        });\r\n\r\n        this.isMediaUploadButton = vnode.attrs.isMediaUploadButton || false;\r\n    }\r\n\r\n    oncreate(vnode) {\r\n        super.oncreate(vnode);\r\n  \r\n        // Add tooltip\r\n        if(!this.isMediaUploadButton) {\r\n            this.$().tooltip();\r\n        }\r\n    }\r\n\r\n    view() {\r\n        const buttonText = this.attrs.uploader.uploading\r\n            ? app.translator.trans('fof-upload.forum.states.loading')\r\n            : app.translator.trans('fof-upload.forum.buttons.upload');\r\n\r\n        return Button.component({\r\n            className: classList([\"Button\", \"hasIcon\", \"fof-upload-button\", !this.isMediaUploadButton && !this.attrs.uploader.uploading && \"Button--icon\", !this.isMediaUploadButton && !this.attrs.uploader.uploading && \"Button--link\", this.attrs.uploader.uploading && \"uploading\"]),\r\n            icon: !this.attrs.uploader.uploading && 'fas fa-file-upload',\r\n            onclick: this.uploadButtonClicked.bind(this),\r\n            title: !this.isMediaUploadButton ? buttonText : null,\r\n            disabled: this.attrs.disabled\r\n        }, [\r\n            this.attrs.uploader.uploading && LoadingIndicator.component({\r\n                size: 'tiny',\r\n                className: 'LoadingIndicator--inline Button-icon',\r\n            }),\r\n            this.isMediaUploadButton || this.attrs.uploader.uploading ? <span className=\"Button-label\">{buttonText}</span> : null,\r\n            <form>\r\n                <input type=\"file\" multiple={true} onchange={this.process.bind(this)} />\r\n            </form>\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * Process the upload event.\r\n     *\r\n     * @param e\r\n     */\r\n    process(e) {\r\n        // get the file from the input field\r\n        const files = this.$('input').prop('files');\r\n\r\n        if (files.length === 0) {\r\n            // We've got no files to upload, so trying\r\n            // to begin an upload will show an error\r\n            // to the user.\r\n            return;\r\n        }\r\n\r\n        this.attrs.uploader.upload(files, !this.isMediaUploadButton);\r\n    }\r\n\r\n    /**\r\n     * Event handler for upload button being clicked\r\n     *\r\n     * @param {PointerEvent} e\r\n     */\r\n    uploadButtonClicked(e) {\r\n        // Trigger click on hidden input element\r\n        // (Opens file dialog)\r\n        this.$('input').click();\r\n    }\r\n}\r\n","import Component from \"flarum/Component\";\r\nimport Button from \"flarum/components/Button\";\r\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\r\nimport mimeToIcon from \"../../common/mimeToIcon\";\r\n\r\nexport default class UserFileList extends Component{\r\n    oninit(vnode) {\r\n        super.oninit(vnode);\r\n\r\n        // Load file list\r\n        app.fileListState.setUser(vnode.attrs.user || app.session.user);\r\n\r\n        this.inModal = vnode.attrs.selectable;\r\n\r\n        this.restrictFileType = vnode.attrs.restrictFileType || null;\r\n    }\r\n\r\n    view() {\r\n        const state = app.fileListState;\r\n        \r\n        return (\r\n            <div className={\"fof-upload-file-list\"}>\r\n                {/* Loading */}\r\n                {state.isLoading() && state.files.length === 0 && (\r\n                    <div className={\"fof-upload-loading\"}>\r\n                        {app.translator.trans(\"fof-upload.forum.file_list.loading\")}\r\n                        \r\n                        <LoadingIndicator />\r\n                    </div>\r\n                )}\r\n                \r\n                {/* Empty personal file list */}\r\n                {this.inModal && state.empty() && (\r\n                    <p className={\"fof-upload-empty\"}>\r\n                        <i className={\"fas fa-cloud-upload-alt fof-upload-empty-icon\"}></i>\r\n\r\n                        {app.translator.trans(`fof-upload.forum.file_list.modal_empty_${app.screen() !== \"phone\" ? \"desktop\" : \"phone\"}`)}\r\n                    </p>\r\n                )}\r\n\r\n                {/* Empty file list */}\r\n                {!this.inModal && state.empty() (\r\n                    <p className={\"fof-upload-empty\"}>\r\n                        {app.translator.trans(\"fof-upload.forum.file_list.empty\")}\r\n                    </p>\r\n                )}\r\n\r\n                {/* File list */}\r\n                <ul>\r\n                    {state.files.map(file => {\r\n                        let fileClassNames = \"fof-file\";\r\n                        const fileIcon = mimeToIcon(file.type());\r\n                        const fileSelectable = this.restrictFileType ? this.isSelectable(file) : true;\r\n\r\n                        // File is image\r\n                        if(fileIcon === \"image\") {\r\n                            fileClassNames += \" fof-file-type-image\";\r\n                        }\r\n\r\n                        // File is selected\r\n                        if(this.attrs.selectedFiles && this.attrs.selectedFiles.indexOf(file.id()) >= 0) {\r\n                            fileClassNames += \" fof-file-selected\";\r\n                        }\r\n\r\n                        return (\r\n                            <li>\r\n                                <button \r\n                                    className={fileClassNames}\r\n                                    onclick={this.attrs.onFileSelect ? () => this.attrs.onFileSelect(file) : null}\r\n                                    title={file.baseName()}\r\n                                    disabled={!fileSelectable}\r\n                                    >\r\n                                    <span className={\"fof-file-icon\"}>\r\n                                        <i className={fileIcon !== 'image' ? fileIcon : 'far fa-file-image'} />\r\n                                    </span>\r\n\r\n                                    {fileIcon === 'image' && (\r\n                                        <img src={file.url()} className={\"fof-file-image-preview\"} />\r\n                                    )}\r\n\r\n                                    <span className={\"fof-file-name\"}>\r\n                                        {file.baseName()}\r\n                                    </span>\r\n                                </button>\r\n                            </li>\r\n                        )\r\n                    })}\r\n                </ul>\r\n\r\n                {/* Load more files */}\r\n                {state.hasMoreResults() && (\r\n                    <div className={\"fof-load-more-files\"}>\r\n                        <Button className={\"Button Button--primary\"} disabled={state.isLoading()} loading={state.isLoading()} onclick={() => state.loadMore()}>{app.translator.trans(\"fof-upload.forum.buttons.load_more_files\")}</Button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Check if a file is selectable \r\n     * \r\n     * @param {File} file \r\n     */\r\n    isSelectable(file) {\r\n        const fileType = file.type();\r\n\r\n        // Custom defined file types\r\n        if(Array.isArray(this.restrictFileType)) {\r\n            return this.restrictFileType.indexOf(fileType) >= 0;\r\n        }\r\n\r\n        // Image\r\n        else if(this.restrictFileType === 'image') {\r\n            return fileType.includes(\"image/\");\r\n        }\r\n\r\n        // Audio\r\n        else if(this.restrictFileType === 'audio') {\r\n            return fileType.includes(\"audio/\");\r\n        }\r\n\r\n        // Video\r\n        else if(this.restrictFileType === 'video') {\r\n            return fileType.includes(\"video/\");\r\n        }\r\n\r\n        return false;\r\n    }\r\n}","import Uploader from \"../handler/Uploader\";\r\nimport DragAndDrop from \"./DragAndDrop\";\r\nimport FileManagerButton from \"./FileManagerButton\";\r\nimport FileManagerModal from \"./FileManagerModal\";\r\nimport UserFileList from \"./UserFileList\";\r\n\r\nexport const components = {\r\n    DragAndDrop,\r\n    FileManagerButton,\r\n    FileManagerModal,\r\n    UserFileList,\r\n    Uploader\r\n};\r\n","import app from 'flarum/app';\r\nimport { extend } from 'flarum/extend';\r\nimport Post from 'flarum/components/Post';\r\n\r\n/* global $ */\r\n\r\nexport default function () {\r\n    extend(Post.prototype, 'oncreate', function () {\r\n        this.$('[data-fof-upload-download-uuid]')\r\n            .unbind('click')\r\n            .on('click', (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n\r\n                if (!app.forum.attribute('fof-upload.canDownload')) {\r\n                    alert(app.translator.trans('fof-upload.forum.states.unauthorized'));\r\n                    return;\r\n                }\r\n\r\n                let url = app.forum.attribute('apiUrl') + '/fof/download';\r\n\r\n                url += '/' + e.currentTarget.dataset.fofUploadDownloadUuid;\r\n                url += '/' + this.attrs.post.id();\r\n                url += '/' + app.session.csrfToken;\r\n\r\n                window.open(url);\r\n            });\r\n    });\r\n}\r\n","export default class Uploader {\r\n    constructor() {\r\n        this.callbacks = {\r\n            success: [],\r\n            failure: [],\r\n            uploading: [],\r\n            uploaded: [],\r\n        };\r\n        this.uploading = false;\r\n    }\r\n\r\n    on(type, callback) {\r\n        this.callbacks[type].push(callback);\r\n    }\r\n\r\n    dispatch(type, response) {\r\n        this.callbacks[type].forEach((callback) => callback(response));\r\n    }\r\n\r\n    upload(files, addBBcode = true) {\r\n        this.uploading = true;\r\n        this.dispatch('uploading', files);\r\n\r\n        m.redraw(); // Forcing a redraw so that the button also updates if uploadFiles() is called from DragAndDrop or PasteClipboard\r\n\r\n        const body = new FormData();\r\n\r\n        for (let i = 0; i < files.length; i++) {\r\n            body.append('files[]', files[i]);\r\n        }\r\n\r\n        // send a POST request to the api\r\n        return app\r\n            .request({\r\n                method: 'POST',\r\n                url: app.forum.attribute('apiUrl') + '/fof/upload',\r\n                // prevent JSON.stringify'ing the form data in the XHR call\r\n                serialize: (raw) => raw,\r\n                body,\r\n            })\r\n            .then((result) => this.uploaded(result, addBBcode))\r\n            .catch((error) => {\r\n                this.uploading = false;\r\n                m.redraw();\r\n\r\n                throw error;\r\n            });\r\n    }\r\n\r\n    uploaded(result, addBBcode = false) {\r\n        this.uploading = false;\r\n\r\n        result.data.forEach((file) => {\r\n            const fileObj = app.store.pushObject(file);\r\n\r\n            // Add file to media manager\r\n            app.fileListState.addToList(fileObj);\r\n\r\n            // Dispatch\r\n            this.dispatch('success', {\r\n                file: fileObj,\r\n                addBBcode\r\n            });\r\n        });\r\n\r\n        this.dispatch('uploaded');\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\n\r\nimport File from '../common/models/File';\r\nimport FileListState from './states/FileListState';\r\nimport downloadButtonInteraction from './downloadButtonInteraction';\r\nimport addUploadButton from './addUploadButton';\r\n\r\nexport * from './components';\r\n\r\napp.initializers.add('fof-upload', () => {\r\n    addUploadButton();\r\n    downloadButtonInteraction();\r\n\r\n    // File model\r\n    app.store.models.files = File;\r\n\r\n    // File list state\r\n    app.fileListState = new FileListState();\r\n});\r\n","export default class FileListState {\r\n    constructor() {\r\n        this.user = null;\r\n\r\n        this.files = [];\r\n    \r\n        this.moreResults = false;\r\n    \r\n        this.loading = false;\r\n    }\r\n\r\n    /**\r\n     * Set user and load list\r\n     *\r\n     * @param user A user to populate the media manager\r\n     */\r\n    setUser(user) {\r\n        // Keep previous state\r\n        if(user === this.user) return;\r\n\r\n        // Set user\r\n        this.user = user;\r\n\r\n        // Reset file list\r\n        this.files = [];\r\n\r\n        // Load user files\r\n        this.loadResults();\r\n    }\r\n\r\n    /**\r\n     * Load more user files\r\n     *\r\n     * @param offset The index to start the page at.\r\n     */\r\n    loadResults(offset = 0) {\r\n        if(!this.user) return;\r\n\r\n        this.loading = true;\r\n\r\n        return app.store.find('fof/uploads', {\r\n            filter: {\r\n                user: this.user.id()\r\n            },\r\n            page: {\r\n                offset\r\n            }\r\n        }).then(this.parseResults.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Load the next page of discussion results.\r\n     */\r\n    loadMore() {\r\n      this.loading = true;\r\n  \r\n      this.loadResults(this.files.length).then(this.parseResults.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Parse results and append them to the file list.\r\n     */\r\n    parseResults(results) {\r\n        this.files.push(...results);\r\n\r\n        this.loading = false;\r\n        this.moreResults = !!results.payload.links && !!results.payload.links.next;\r\n\r\n        m.redraw();\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Add files to the beginning of the list\r\n     */\r\n     addToList(files) {\r\n        if(Array.isArray(files)) {\r\n            this.files.unshift(...files);\r\n        }else{\r\n            this.files.unshift(files);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Are there any files in the list?\r\n     */\r\n    hasFiles() {\r\n        return this.files.length > 0;\r\n    }\r\n\r\n    /**\r\n     * Is the file list loading?\r\n     */\r\n    isLoading() {\r\n        return this.loading;\r\n    }\r\n\r\n    /**\r\n     * Does this user has more files?\r\n     */\r\n    hasMoreResults() {\r\n        return this.moreResults;\r\n    }\r\n\r\n    /**\r\n     * Does this user have any files?\r\n     */\r\n    empty() {\r\n        return !this.hasFiles() && !this.isLoading();\r\n    }\r\n}  ","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/LoadingIndicator'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['components/Post'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['utils/classList'];","module.exports = flarum.core.compat['utils/mixin'];"],"sourceRoot":""}