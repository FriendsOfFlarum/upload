{"version":3,"sources":["webpack://@fof/upload/webpack/bootstrap","webpack://@fof/upload/./forum.js","webpack://@fof/upload/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/upload/./src/common/fileToBBcode.js","webpack://@fof/upload/./src/common/mimeToIcon.js","webpack://@fof/upload/./src/common/models/File.js","webpack://@fof/upload/./src/forum/addUploadButton.js","webpack://@fof/upload/./src/forum/components/DragAndDrop.js","webpack://@fof/upload/./src/forum/components/FileManagerButton.js","webpack://@fof/upload/./src/forum/components/FileManagerModal.js","webpack://@fof/upload/./src/forum/components/PasteClipboard.js","webpack://@fof/upload/./src/forum/components/UploadButton.js","webpack://@fof/upload/./src/forum/components/UserFileList.js","webpack://@fof/upload/./src/forum/components/index.js","webpack://@fof/upload/./src/forum/downloadButtonInteraction.js","webpack://@fof/upload/./src/forum/handler/Uploader.js","webpack://@fof/upload/./src/forum/index.js","webpack://@fof/upload/./src/forum/states/FileListState.js","webpack://@fof/upload/external \"flarum.core.compat['Component']\"","webpack://@fof/upload/external \"flarum.core.compat['Model']\"","webpack://@fof/upload/external \"flarum.core.compat['app']\"","webpack://@fof/upload/external \"flarum.core.compat['components/Button']\"","webpack://@fof/upload/external \"flarum.core.compat['components/LoadingIndicator']\"","webpack://@fof/upload/external \"flarum.core.compat['components/Modal']\"","webpack://@fof/upload/external \"flarum.core.compat['components/Post']\"","webpack://@fof/upload/external \"flarum.core.compat['components/TextEditor']\"","webpack://@fof/upload/external \"flarum.core.compat['extend']\"","webpack://@fof/upload/external \"flarum.core.compat['utils/classList']\"","webpack://@fof/upload/external \"flarum.core.compat['utils/mixin']\""],"names":["fileToBBcode","file","tag","uuid","humanSize","baseName","url","image","archive","code","word","mimeToIcon","fileType","indexOf","includes","File","apiEndpoint","exists","data","id","bbcode","mixin","Model","attribute","path","type","size","createdAt","extend","TextEditor","prototype","uploader","Uploader","items","app","forum","composerButtonVisiblity","add","FileManagerButton","component","UploadButton","f_","vnode","on","addBBcode","attrs","composer","editor","insertAtCursor","preview","originalIsFullScreen","isFullScreen","dragAndDrop","DragAndDrop","files","upload","$","parents","unloadHandler","unload","bind","PasteClipboard","composerElement","handlers","supportsFileDragging","addEventListener","out","dropping","div","document","createElement","window","removeEventListener","isNotFile","event","dataTransfer","i","length","kind","preventDefault","over","classList","remove","view","Button","className","onclick","fileManagerButtonClicked","icon","title","translator","trans","oncreate","tooltip","e","modal","show","FileManagerModal","Component","oninit","selectedFiles","multiSelect","restrictFileType","dragDrop","onUpload","find","onremove","disabled","fileListState","isLoading","isMediaUploadButton","alertAttrs","Alert","UserFileList","user","selectable","onFileSelect","hide","onSelect","transChoice","itemPosition","splice","push","map","fileId","store","getById","Modal","textAreaElement","paste","clipboardData","getAsFile","reset","m","redraw","buttonText","uploading","uploadButtonClicked","LoadingIndicator","process","prop","click","setUser","session","inModal","state","empty","screen","fileClassNames","fileIcon","fileSelectable","isSelectable","hasMoreResults","loadMore","Array","isArray","components","Post","unbind","stopPropagation","alert","currentTarget","dataset","fofUploadDownloadUuid","post","csrfToken","open","callbacks","success","failure","uploaded","callback","dispatch","response","forEach","body","FormData","append","request","method","serialize","raw","then","result","error","fileObj","pushObject","addToList","initializers","addUploadButton","downloadButtonInteraction","models","FileListState","moreResults","loading","loadResults","offset","filter","page","parseResults","results","payload","links","next","unshift","hasFiles"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\r\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","export default function fileToBBcode(file) {\n    switch (file.tag()) {\n        // File\n        case 'file':\n            return `[upl-file uuid=${file.uuid()} size=${file.humanSize()}]${file.baseName()}[/upl-file]`;\n\n        // Image template\n        case 'image':\n            return `[upl-image uuid=${file.uuid()} size=${file.humanSize()} url=${file.url()}]${file.baseName()}[/upl-image]`;\n\n        // Image preview\n        case 'image-preview':\n            return `[upl-image-preview url=${file.url()}]`;\n\n        // 'just-url' or unknown\n        default:\n            return file.url();\n    }\n}\n","const image = ['image/png', 'image/jpg', 'image/jpeg', 'image/svg+xml'];\nconst archive = ['application/zip', 'application/x-7z-compressed', 'application/gzip', 'application/vnd.rar', 'application/x-rar-compressed'];\nconst code = ['text/html', 'text/css', 'text/javascript', 'application/json', 'application/ld+json', 'text/javascript', 'application/x-httpd-php'];\nconst word = ['application/x-abiword', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];\n\nexport default function mimeToIcon(fileType) {\n    // Display image (do not display for)\n    if (image.indexOf(fileType) >= 0) {\n        return 'image';\n    }\n    // Display image icon for other types\n    else if (fileType.includes('image/')) {\n        return 'far fa-file-image';\n    }\n    // Video icon\n    else if (fileType.includes('video/')) {\n        return 'far fa-file-video';\n    }\n    // Archive icon\n    else if (archive.indexOf(fileType) >= 0) {\n        return 'far fa-file-archive';\n    }\n    // PDF icon\n    else if (fileType === 'application/pdf') {\n        return 'far fa-file-pdf';\n    }\n    // Word\n    else if (word.indexOf(fileType) >= 0) {\n        return 'far fa-file-word';\n    }\n    // Audio icon\n    else if (fileType.includes('audio/')) {\n        return 'far fa-file-audio';\n    }\n    // Code files\n    else if (code.indexOf(fileType) >= 0) {\n        return 'far fa-file-code';\n    }\n\n    return 'far fa-file';\n}\n","import Model from 'flarum/Model';\nimport mixin from 'flarum/utils/mixin';\nimport fileToBBcode from '../fileToBBcode';\n\nexport default class File extends mixin(Model, {\n    baseName: Model.attribute('baseName'),\n    path: Model.attribute('path'),\n    url: Model.attribute('url'),\n    type: Model.attribute('type'),\n    size: Model.attribute('size'),\n    humanSize: Model.attribute('humanSize'),\n    createdAt: Model.attribute('createdAt'),\n    uuid: Model.attribute('uuid'),\n    tag: Model.attribute('tag'),\n}) {\n    /**\n     * Use FoF Uploads endpoint\n     */\n    apiEndpoint() {\n        return '/fof/uploads' + (this.exists ? '/' + this.data.id : '');\n    }\n\n    /**\n     * Generate bbcode for this file\n     */\n    bbcode() {\n        return fileToBBcode(this);\n    }\n}\n","import app from 'flarum/app';\nimport { extend } from 'flarum/extend';\nimport TextEditor from 'flarum/components/TextEditor';\nimport UploadButton from './components/UploadButton';\nimport DragAndDrop from './components/DragAndDrop';\nimport PasteClipboard from './components/PasteClipboard';\nimport Uploader from './handler/Uploader';\nimport FileManagerButton from './components/FileManagerButton';\n\nexport default function () {\n    extend(TextEditor.prototype, 'oninit', function () {\n        this.uploader = new Uploader();\n    });\n    extend(TextEditor.prototype, 'controlItems', function (items) {\n        if (!app.forum.attribute('fof-upload.canUpload')) return;\n\n        const composerButtonVisiblity = app.forum.attribute(\"fof-upload.composerButtonVisiblity\");\n\n        // Add media button\n        if(composerButtonVisiblity === \"both\" || composerButtonVisiblity === \"media-btn\") {\n            items.add(\n                'fof-upload-media',\n                FileManagerButton.component({\n                    uploader: this.uploader,\n                })\n            );\n        }\n\n        // Add upload button\n        if(composerButtonVisiblity === \"both\" || composerButtonVisiblity === \"upload-btn\") {\n            items.add(\n                'fof-upload',\n                UploadButton.component({\n                    uploader: this.uploader,\n                })\n            );\n        }\n    });\n\n    extend(TextEditor.prototype, 'oncreate', function (f_, vnode) {\n        if (!app.forum.attribute('fof-upload.canUpload')) return;\n\n        this.uploader.on('success', ({ file, addBBcode }) => {\n            if (!addBBcode) return;\n\n            this.attrs.composer.editor.insertAtCursor(file.bbcode() + '\\n');\n\n            // We wrap this in a typeof check to prevent it running when a user\n            // is creating a new discussion. There's nothing to preview in a new\n            // discussion, so the `preview` function isn't defined.\n            if (typeof this.attrs.preview === 'function') {\n                // Scroll the preview into view\n                // preview() causes the composer to close on mobile, but we don't want that. We want only the scroll\n                // We work around that by temporarily patching the isFullScreen method\n                const originalIsFullScreen = app.composer.isFullScreen;\n\n                app.composer.isFullScreen = () => false;\n\n                this.attrs.preview();\n\n                app.composer.isFullScreen = originalIsFullScreen;\n            }\n        });\n\n        const dragAndDrop = new DragAndDrop((files) => this.uploader.upload(files), this.$().parents('.Composer')[0]);\n\n        const unloadHandler = () => {\n            dragAndDrop.unload();\n        };\n\n        this.$('textarea').bind('onunload', unloadHandler);\n\n        new PasteClipboard((files) => this.uploader.upload(files), this.$('textarea')[0]);\n    });\n}\n","export default class DragAndDrop {\n    constructor(upload, composerElement) {\n        this.upload = upload;\n        this.composerElement = composerElement;\n\n        // Keep references to the bound methods so we can remove the event listeners later\n        this.handlers = {};\n\n        if (!this.supportsFileDragging()) {\n            return;\n        }\n\n        this.composerElement.addEventListener('dragover', (this.handlers.in = this.in.bind(this)));\n\n        this.composerElement.addEventListener('dragleave', (this.handlers.out = this.out.bind(this)));\n        this.composerElement.addEventListener('dragend', this.handlers.out);\n\n        this.composerElement.addEventListener('drop', (this.handlers.dropping = this.dropping.bind(this)));\n    }\n\n    supportsFileDragging() {\n        // Based on https://css-tricks.com/drag-and-drop-file-uploading/\n        const div = document.createElement('div');\n\n        return ('draggable' in div || ('ondragstart' in div && 'ondrop' in div)) && 'FormData' in window && 'FileReader' in window;\n    }\n\n    unload() {\n        // If the handlers were not set (drag and drop not supported), we skip removing them\n        if (!this.handlers.in) {\n            return;\n        }\n\n        this.composerElement.removeEventListener('dragover', this.handlers.in);\n\n        this.composerElement.removeEventListener('dragleave', this.handlers.out);\n        this.composerElement.removeEventListener('dragend', this.handlers.out);\n\n        this.composerElement.removeEventListener('drop', this.handlers.dropping);\n    }\n\n    isNotFile(event) {\n        // Checking event.dataTransfer.files.length does not work on dragover event, it's always zero\n        // So we use the dataTransfer.items property to check whether any file is being dragged\n        if (event.dataTransfer.items) {\n            for (let i = 0; i < event.dataTransfer.items.length; i++) {\n                if (event.dataTransfer.items[i].kind !== 'file') {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n    in(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (!this.over) {\n            this.composerElement.classList.add('fof-upload-dragging');\n            this.over = true;\n        }\n    }\n\n    out(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        if (this.over) {\n            this.composerElement.classList.remove('fof-upload-dragging');\n            this.over = false;\n        }\n    }\n\n    dropping(event) {\n        if (this.isNotFile(event)) {\n            return;\n        }\n\n        event.preventDefault();\n\n        this.upload(event.dataTransfer.files);\n\n        this.composerElement.classList.remove('fof-upload-dragging');\n    }\n}\n","import app from 'flarum/app';\nimport Component from 'flarum/Component';\nimport Button from 'flarum/components/Button';\nimport FileManagerModal from './FileManagerModal';\n\nexport default class FileManagerButton extends Component {\n    view() {\n        return Button.component({\n            className: 'Button fof-upload-button Button--icon',\n            onclick: this.fileManagerButtonClicked.bind(this),\n            icon: 'fas fa-photo-video',\n            title: app.translator.trans('fof-upload.forum.buttons.media'),\n        });\n    }\n\n    /**\n     * Show tooltip on hover\n     *\n     * @param {*} vnode\n     */\n    oncreate(vnode) {\n        super.oncreate(vnode);\n\n        // Add tooltip\n        this.$().tooltip();\n    }\n\n    /**\n     * Event handler for upload button being clicked\n     *\n     * @param {PointerEvent} e\n     */\n    fileManagerButtonClicked(e) {\n        e.preventDefault();\n\n        // Open dialog\n        app.modal.show(FileManagerModal, {\n            uploader: this.attrs.uploader\n        });\n    }\n}\n","import Modal from 'flarum/components/Modal';\nimport Button from 'flarum/components/Button';\nimport UploadButton from './UploadButton';\nimport UserFileList from './UserFileList';\nimport DragAndDrop from './DragAndDrop';\n\nexport default class FileManagerModal extends Modal {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        // Initialize upload managers\n        this.uploader = vnode.attrs.uploader;\n\n        // Current selected files\n        this.selectedFiles = [];\n\n        // Allow multiselect\n        this.multiSelect = vnode.attrs.multiSelect || true;\n\n        // Restrict file selection to specific types\n        this.restrictFileType = vnode.attrs.restrictFileType || null;\n\n        // Drag & drop\n        this.dragDrop = null;\n\n        // Initialize uploads\n        this.onUpload();\n    }\n\n    className() {\n        return 'Modal--large fof-file-manager-modal';\n    }\n\n    /**\n     * Initialize drag & drop\n     */\n    oncreate(vnode) {\n        super.oncreate(vnode);\n\n        this.dragDrop = new DragAndDrop((files) => this.uploader.upload(files, false), this.$().find('.Modal-content')[0]);\n    }\n\n    /**\n     * Remove events from modal content\n     */\n    onremove() {\n        if (this.dragDrop) {\n            this.dragDrop.unload();\n        }\n    }\n\n    view() {\n        return (\n            <div className={'Modal modal-dialog ' + this.className()}>\n                <div className=\"Modal-content\">\n                    <div className=\"fof-modal-buttons App-backControl\">\n                        {UploadButton.component({\n                            uploader: this.uploader,\n                            disabled: app.fileListState.isLoading(),\n                            isMediaUploadButton: true,\n                        })}\n                    </div>\n\n                    <div className={'fof-drag-and-drop'}>\n                        <div className={'fof-drag-and-drop-release'}>\n                            <i className={'fas fa-cloud-upload-alt'}></i>\n\n                            {app.translator.trans('fof-upload.forum.file_list.release_to_upload')}\n                        </div>\n                    </div>\n\n                    <div className=\"Modal-header\">\n                        <h3 className=\"App-titleControl App-titleControl--text\">{app.translator.trans('fof-upload.forum.media_manager')}</h3>\n                    </div>\n\n                    {this.alertAttrs ? <div className=\"Modal-alert\">{Alert.component(this.alertAttrs)}</div> : ''}\n\n                    <div className={'Modal-body'}>\n                        {UserFileList.component({\n                            user: this.attrs.user,\n                            selectable: true,\n                            onFileSelect: this.onFileSelect.bind(this),\n                            selectedFiles: this.selectedFiles,\n                            restrictFileType: this.restrictFileType\n                        })}\n                    </div>\n\n                    <div className={'Modal-footer'}>\n                        {Button.component(\n                            {\n                                onclick: this.hide.bind(this),\n                                className: 'Button',\n                            },\n                            app.translator.trans('fof-upload.forum.buttons.cancel')\n                        )}\n\n                        {Button.component(\n                            {\n                                onclick: this.onSelect.bind(this),\n                                disabled: this.selectedFiles.length === 0 || (!this.multiSelect && this.selectedFiles.length > 1),\n                                className: 'Button Button--primary',\n                            },\n                            app.translator.transChoice('fof-upload.forum.buttons.select_file', this.selectedFiles.length)\n                        )}\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    /**\n     * Add or remove file from selected files\n     *\n     * @param {File} file\n     */\n    onFileSelect(file) {\n        const itemPosition = this.selectedFiles.indexOf(file.id());\n\n        if (itemPosition >= 0) {\n            this.selectedFiles.splice(itemPosition, 1);\n        } else {\n            if (this.multiSelect) {\n                this.selectedFiles.push(file.id());\n            } else {\n                this.selectedFiles = [file.id()];\n            }\n        }\n    }\n\n    /**\n     * Add files to file list after upload\n     */\n    onUpload() {\n        this.uploader.on('success', ({ file }) => {\n            if (this.multiSelect) {\n                this.selectedFiles.push(file.id());\n            } else {\n                this.selectedFiles = [file.id()];\n            }\n        });\n    }\n\n    /**\n     * Add selected files to the composer\n     */\n    onSelect() {\n        this.hide();\n\n        // Custom callback\n        if (this.attrs.onSelect) {\n            this.attrs.onSelect(this.selectedFiles);\n\n            return;\n        }\n\n        // Add selected files to composer\n        this.selectedFiles.map((fileId) => {\n            const file = app.store.getById('files', fileId);\n\n            app.composer.editor.insertAtCursor(file.bbcode() + '\\n');\n        });\n    }\n}\n","export default class PasteClipboard {\n    constructor(upload, textAreaElement) {\n        this.upload = upload;\n\n        // We don't need to remove the events listeners, because they are bound to the textarea when it's created,\n        // and need to stay as long as the textarea exists in the DOM\n        textAreaElement.addEventListener('paste', this.paste.bind(this));\n    }\n\n    paste(e) {\n        if (e.clipboardData && e.clipboardData.items) {\n            const items = e.clipboardData.items;\n\n            const files = [];\n\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type.indexOf('image') !== -1) {\n                    files.push(items[i].getAsFile());\n                }\n            }\n\n            if (files.length > 0) {\n                e.preventDefault();\n\n                this.upload(files);\n            }\n        }\n    }\n}\n","import app from 'flarum/app';\nimport Component from 'flarum/Component';\nimport classList from 'flarum/utils/classList';\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\nimport Button from 'flarum/components/Button';\n\nexport default class UploadButton extends Component {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.attrs.uploader.on('uploaded', () => {\n            // reset the button for a new upload\n            this.$('form')[0].reset();\n\n            // redraw to reflect uploader.loading in the DOM\n            m.redraw();\n        });\n\n        this.isMediaUploadButton = vnode.attrs.isMediaUploadButton || false;\n    }\n\n    oncreate(vnode) {\n        super.oncreate(vnode);\n\n        // Add tooltip\n        if (!this.isMediaUploadButton) {\n            this.$().tooltip();\n        }\n    }\n\n    view() {\n        const buttonText = this.attrs.uploader.uploading\n            ? app.translator.trans('fof-upload.forum.states.loading')\n            : app.translator.trans('fof-upload.forum.buttons.upload');\n\n        return Button.component(\n            {\n                className: classList([\n                    'Button',\n                    'hasIcon',\n                    'fof-upload-button',\n                    !this.isMediaUploadButton && !this.attrs.uploader.uploading && 'Button--icon',\n                    !this.isMediaUploadButton && !this.attrs.uploader.uploading && 'Button--link',\n                    this.attrs.uploader.uploading && 'uploading',\n                ]),\n                icon: !this.attrs.uploader.uploading && 'fas fa-file-upload',\n                onclick: this.uploadButtonClicked.bind(this),\n                title: !this.isMediaUploadButton ? buttonText : null,\n                disabled: this.attrs.disabled,\n            },\n            [\n                this.attrs.uploader.uploading &&\n                    LoadingIndicator.component({\n                        size: 'tiny',\n                        className: 'LoadingIndicator--inline Button-icon',\n                    }),\n                this.isMediaUploadButton || this.attrs.uploader.uploading ? <span className=\"Button-label\">{buttonText}</span> : null,\n                <form>\n                    <input type=\"file\" multiple={true} onchange={this.process.bind(this)} />\n                </form>,\n            ]\n        );\n    }\n\n    /**\n     * Process the upload event.\n     *\n     * @param e\n     */\n    process(e) {\n        // get the file from the input field\n        const files = this.$('input').prop('files');\n\n        if (files.length === 0) {\n            // We've got no files to upload, so trying\n            // to begin an upload will show an error\n            // to the user.\n            return;\n        }\n\n        this.attrs.uploader.upload(files, !this.isMediaUploadButton);\n    }\n\n    /**\n     * Event handler for upload button being clicked\n     *\n     * @param {PointerEvent} e\n     */\n    uploadButtonClicked(e) {\n        // Trigger click on hidden input element\n        // (Opens file dialog)\n        this.$('input').click();\n    }\n}\n","import Component from 'flarum/Component';\nimport Button from 'flarum/components/Button';\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\nimport mimeToIcon from '../../common/mimeToIcon';\n\nexport default class UserFileList extends Component {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        // Load file list\n        app.fileListState.setUser(vnode.attrs.user || app.session.user);\n\n        this.inModal = vnode.attrs.selectable;\n\n        this.restrictFileType = vnode.attrs.restrictFileType || null;\n    }\n\n    view() {\n        const state = app.fileListState;\n\n        return (\n            <div className={'fof-upload-file-list'}>\n                {/* Loading */}\n                {state.isLoading() && state.files.length === 0 && (\n                    <div className={'fof-upload-loading'}>\n                        {app.translator.trans('fof-upload.forum.file_list.loading')}\n\n                        <LoadingIndicator />\n                    </div>\n                )}\n\n                {/* Empty personal file list */}\n                {this.inModal && state.empty() && (\n                    <p className={'fof-upload-empty'}>\n                        <i className={'fas fa-cloud-upload-alt fof-upload-empty-icon'}></i>\n\n                        {app.translator.trans(`fof-upload.forum.file_list.modal_empty_${app.screen() !== 'phone' ? 'desktop' : 'phone'}`)}\n                    </p>\n                )}\n\n                {/* Empty file list */}\n                {!this.inModal && state.empty()(<p className={'fof-upload-empty'}>{app.translator.trans('fof-upload.forum.file_list.empty')}</p>)}\n\n                {/* File list */}\n                <ul>\n                    {state.files.map((file) => {\n                        let fileClassNames = 'fof-file';\n                        const fileIcon = mimeToIcon(file.type());\n                        const fileSelectable = this.restrictFileType ? this.isSelectable(file) : true;\n\n                        // File is image\n                        if (fileIcon === 'image') {\n                            fileClassNames += ' fof-file-type-image';\n                        }\n\n                        // File is selected\n                        if (this.attrs.selectedFiles && this.attrs.selectedFiles.indexOf(file.id()) >= 0) {\n                            fileClassNames += ' fof-file-selected';\n                        }\n\n                        return (\n                            <li>\n                                <button\n                                    className={fileClassNames}\n                                    onclick={this.attrs.onFileSelect ? () => this.attrs.onFileSelect(file) : null}\n                                    title={file.baseName()}\n                                    disabled={!fileSelectable}\n                                >\n                                    <span className={'fof-file-icon'}>\n                                        <i className={fileIcon !== 'image' ? fileIcon : 'far fa-file-image'} />\n                                    </span>\n\n                                    {fileIcon === 'image' && <img src={file.url()} className={'fof-file-image-preview'} draggable={false} />}\n\n                                    <span className={'fof-file-name'}>{file.baseName()}</span>\n                                </button>\n                            </li>\n                        );\n                    })}\n                </ul>\n\n                {/* Load more files */}\n                {state.hasMoreResults() && (\n                    <div className={'fof-load-more-files'}>\n                        <Button\n                            className={'Button Button--primary'}\n                            disabled={state.isLoading()}\n                            loading={state.isLoading()}\n                            onclick={() => state.loadMore()}\n                        >\n                            {app.translator.trans('fof-upload.forum.buttons.load_more_files')}\n                        </Button>\n                    </div>\n                )}\n            </div>\n        );\n    }\n\n    /**\n     * Check if a file is selectable\n     *\n     * @param {File} file\n     */\n    isSelectable(file) {\n        const fileType = file.type();\n\n        // Custom defined file types\n        if (Array.isArray(this.restrictFileType)) {\n            return this.restrictFileType.indexOf(fileType) >= 0;\n        }\n\n        // Image\n        else if (this.restrictFileType === 'image') {\n            return fileType.includes('image/');\n        }\n\n        // Audio\n        else if (this.restrictFileType === 'audio') {\n            return fileType.includes('audio/');\n        }\n\n        // Video\n        else if (this.restrictFileType === 'video') {\n            return fileType.includes('video/');\n        }\n\n        return false;\n    }\n}\n","import Uploader from '../handler/Uploader';\nimport DragAndDrop from './DragAndDrop';\nimport FileManagerButton from './FileManagerButton';\nimport FileManagerModal from './FileManagerModal';\nimport UserFileList from './UserFileList';\n\nexport const components = {\n    DragAndDrop,\n    FileManagerButton,\n    FileManagerModal,\n    UserFileList,\n    Uploader,\n};\n","import app from 'flarum/app';\nimport { extend } from 'flarum/extend';\nimport Post from 'flarum/components/Post';\n\n/* global $ */\n\nexport default function () {\n    extend(Post.prototype, 'oncreate', function () {\n        this.$('[data-fof-upload-download-uuid]')\n            .unbind('click')\n            .on('click', (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n\n                if (!app.forum.attribute('fof-upload.canDownload')) {\n                    alert(app.translator.trans('fof-upload.forum.states.unauthorized'));\n                    return;\n                }\n\n                let url = app.forum.attribute('apiUrl') + '/fof/download';\n\n                url += '/' + e.currentTarget.dataset.fofUploadDownloadUuid;\n                url += '/' + this.attrs.post.id();\n                url += '/' + app.session.csrfToken;\n\n                window.open(url);\n            });\n    });\n}\n","export default class Uploader {\n    constructor() {\n        this.callbacks = {\n            success: [],\n            failure: [],\n            uploading: [],\n            uploaded: [],\n        };\n        this.uploading = false;\n    }\n\n    on(type, callback) {\n        this.callbacks[type].push(callback);\n    }\n\n    dispatch(type, response) {\n        this.callbacks[type].forEach((callback) => callback(response));\n    }\n\n    upload(files, addBBcode = true) {\n        this.uploading = true;\n        this.dispatch('uploading', files);\n\n        m.redraw(); // Forcing a redraw so that the button also updates if uploadFiles() is called from DragAndDrop or PasteClipboard\n\n        const body = new FormData();\n\n        for (let i = 0; i < files.length; i++) {\n            body.append('files[]', files[i]);\n        }\n\n        // send a POST request to the api\n        return app\n            .request({\n                method: 'POST',\n                url: app.forum.attribute('apiUrl') + '/fof/upload',\n                // prevent JSON.stringify'ing the form data in the XHR call\n                serialize: (raw) => raw,\n                body,\n            })\n            .then((result) => this.uploaded(result, addBBcode))\n            .catch((error) => {\n                this.uploading = false;\n                m.redraw();\n\n                throw error;\n            });\n    }\n\n    uploaded(result, addBBcode = false) {\n        this.uploading = false;\n\n        result.data.forEach((file) => {\n            const fileObj = app.store.pushObject(file);\n\n            // Add file to media manager\n            app.fileListState.addToList(fileObj);\n\n            // Dispatch\n            this.dispatch('success', {\n                file: fileObj,\n                addBBcode,\n            });\n        });\n\n        this.dispatch('uploaded');\n    }\n}\n","import app from 'flarum/app';\n\nimport File from '../common/models/File';\nimport FileListState from './states/FileListState';\nimport downloadButtonInteraction from './downloadButtonInteraction';\nimport addUploadButton from './addUploadButton';\n\nexport * from './components';\n\napp.initializers.add('fof-upload', () => {\n    addUploadButton();\n    downloadButtonInteraction();\n\n    // File model\n    app.store.models.files = File;\n\n    // File list state\n    app.fileListState = new FileListState();\n});\n","export default class FileListState {\n    constructor() {\n        this.user = null;\n\n        this.files = [];\n\n        this.moreResults = false;\n\n        this.loading = false;\n    }\n\n    /**\n     * Set user and load list\n     *\n     * @param user A user to populate the media manager\n     */\n    setUser(user) {\n        // Keep previous state\n        if (user === this.user) return;\n\n        // Set user\n        this.user = user;\n\n        // Reset file list\n        this.files = [];\n\n        // Load user files\n        this.loadResults();\n    }\n\n    /**\n     * Load more user files\n     *\n     * @param offset The index to start the page at.\n     */\n    loadResults(offset = 0) {\n        if (!this.user) return;\n\n        this.loading = true;\n\n        return app.store\n            .find('fof/uploads', {\n                filter: {\n                    user: this.user.id(),\n                },\n                page: {\n                    offset,\n                },\n            })\n            .then(this.parseResults.bind(this));\n    }\n\n    /**\n     * Load the next page of discussion results.\n     */\n    loadMore() {\n        this.loading = true;\n\n        this.loadResults(this.files.length).then(this.parseResults.bind(this));\n    }\n\n    /**\n     * Parse results and append them to the file list.\n     */\n    parseResults(results) {\n        this.files.push(...results);\n\n        this.loading = false;\n        this.moreResults = !!results.payload.links && !!results.payload.links.next;\n\n        m.redraw();\n\n        return results;\n    }\n\n    /**\n     * Add files to the beginning of the list\n     */\n    addToList(files) {\n        if (Array.isArray(files)) {\n            this.files.unshift(...files);\n        } else {\n            this.files.unshift(files);\n        }\n    }\n\n    /**\n     * Are there any files in the list?\n     */\n    hasFiles() {\n        return this.files.length > 0;\n    }\n\n    /**\n     * Is the file list loading?\n     */\n    isLoading() {\n        return this.loading;\n    }\n\n    /**\n     * Does this user has more files?\n     */\n    hasMoreResults() {\n        return this.moreResults;\n    }\n\n    /**\n     * Does this user have any files?\n     */\n    empty() {\n        return !this.hasFiles() && !this.isLoading();\n    }\n}\n","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/LoadingIndicator'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['components/Post'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['utils/classList'];","module.exports = flarum.core.compat['utils/mixin'];"],"sourceRoot":""}