(()=>{var t={195:(t,e,i)=>{t.exports=i(236)},236:t=>{var e=function(t){"use strict";var e,i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},r=a.iterator||"@@iterator",n=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,i){return t[e]=i}}function u(t,e,i,o){var a=e&&e.prototype instanceof v?e:v,r=Object.create(a.prototype),n=new B(o||[]);return r._invoke=function(t,e,i){var o=c;return function(a,r){if(o===p)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw r;return E()}for(i.method=a,i.arg=r;;){var n=i.delegate;if(n){var s=k(n,i);if(s){if(s===m)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===c)throw o=h,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=p;var l=f(t,e,i);if("normal"===l.type){if(o=i.done?h:d,l.arg===m)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(o=h,i.method="throw",i.arg=l.arg)}}}(t,i,n),r}function f(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var c="suspendedStart",d="suspendedYield",p="executing",h="completed",m={};function v(){}function g(){}function y(){}var b={};l(b,r,(function(){return this}));var w=Object.getPrototypeOf,F=w&&w(w(U([])));F&&F!==i&&o.call(F,r)&&(b=F);var x=y.prototype=v.prototype=Object.create(b);function L(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function N(t,e){function i(a,r,n,s){var l=f(t[a],t,r);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&o.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,n,s)}),(function(t){i("throw",t,n,s)})):e.resolve(c).then((function(t){u.value=t,n(u)}),(function(t){return i("throw",t,n,s)}))}s(l.arg)}var a;this._invoke=function(t,o){function r(){return new e((function(e,a){i(t,o,e,a)}))}return a=a?a.then(r,r):r()}}function k(t,i){var o=t.iterator[i.method];if(o===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=e,k(t,i),"throw"===i.method))return m;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=f(o,t.iterator,i.arg);if("throw"===a.type)return i.method="throw",i.arg=a.arg,i.delegate=null,m;var r=a.arg;return r?r.done?(i[t.resultName]=r.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,m):r:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,m)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function U(t){if(t){var i=t[r];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,n=function i(){for(;++a<t.length;)if(o.call(t,a))return i.value=t[a],i.done=!1,i;return i.value=e,i.done=!0,i};return n.next=n}}return{next:E}}function E(){return{value:e,done:!0}}return g.prototype=y,l(x,"constructor",y),l(y,"constructor",g),g.displayName=l(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,s,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},L(N.prototype),l(N.prototype,n,(function(){return this})),t.AsyncIterator=N,t.async=function(e,i,o,a,r){void 0===r&&(r=Promise);var n=new N(u(e,i,o,a),r);return t.isGeneratorFunction(i)?n:n.next().then((function(t){return t.done?t.value:n.next()}))},L(x),l(x,s,"Generator"),l(x,r,(function(){return this})),l(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var o=e.pop();if(o in t)return i.value=o,i.done=!1,i}return i.done=!0,i}},t.values=U,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(_),!t)for(var i in this)"t"===i.charAt(0)&&o.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function a(o,a){return s.type="throw",s.arg=t,i.next=o,a&&(i.method="next",i.arg=e),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r],s=n.completion;if("root"===n.tryLoc)return a("end");if(n.tryLoc<=this.prev){var l=o.call(n,"catchLoc"),u=o.call(n,"finallyLoc");if(l&&u){if(this.prev<n.catchLoc)return a(n.catchLoc,!0);if(this.prev<n.finallyLoc)return a(n.finallyLoc)}else if(l){if(this.prev<n.catchLoc)return a(n.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return a(n.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var n=r?r.completion:{};return n.type=t,n.arg=e,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),_(i),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var o=i.completion;if("throw"===o.type){var a=o.arg;_(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,o){return this.delegate={iterator:U(t),resultName:i,nextLoc:o},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}},e={};function i(o){var a=e[o];if(void 0!==a)return a.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};(()=>{"use strict";i.r(o),i.d(o,{components:()=>ht,extend:()=>dt});const t=flarum.core.compat["forum/app"];var e=i.n(t);const a=flarum.core.compat["common/models/User"];var r=i.n(a);const n=flarum.core.compat["common/Model"];var s=i.n(n);const l=flarum.core.compat["common/app"];var u=i.n(l),f=function(){function t(){this.user=null,this.files=[],this.moreResults=!1,this.loading=!1}var e=t.prototype;return e.setUser=function(t){t!==this.user&&(this.user=t,this.files=[],this.loadResults())},e.loadResults=function(t){if(void 0===t&&(t=0),this.user)return this.loading=!0,u().store.find("fof/uploads",{filter:{user:this.user.id()},page:{offset:t}}).then(this.parseResults.bind(this))},e.loadMore=function(){this.loading=!0,this.loadResults(this.files.length).then(this.parseResults.bind(this))},e.parseResults=function(t){var e;return(e=this.files).push.apply(e,t),this.loading=!1,this.moreResults=!!t.payload.links&&!!t.payload.links.next,m.redraw(),t},e.addToList=function(t){var e;Array.isArray(t)?(e=this.files).unshift.apply(e,t):this.files.unshift(t)},e.hasFiles=function(){return this.files.length>0},e.isLoading=function(){return this.loading},e.hasMoreResults=function(){return this.moreResults},e.empty=function(){return!this.hasFiles()&&!this.isLoading()},t}();const c=flarum.core.compat["common/extend"],d=flarum.core.compat["forum/components/Post"];var p=i.n(d);const h=flarum.core.compat["common/components/TextEditor"];var v=i.n(h);function g(t,e){return g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},g(t,e)}function y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,g(t,e)}const b=flarum.core.compat["common/Component"];var w=i.n(b);const F=flarum.core.compat["common/components/Button"];var x=i.n(F);const L=flarum.core.compat["common/components/LoadingIndicator"];var N=i.n(L);const k=flarum.core.compat["common/utils/classList"];var S=i.n(k),_=function(t){function i(){return t.apply(this,arguments)||this}y(i,t);var o=i.prototype;return o.oninit=function(e){var i=this;t.prototype.oninit.call(this,e),this.attrs.uploader.on("uploaded",(function(){i.$("form")[0].reset(),m.redraw()})),this.isMediaUploadButton=e.attrs.isMediaUploadButton||!1},o.view=function(){var t=this.attrs.uploader.uploading?e().translator.trans("fof-upload.forum.states.loading"):e().translator.trans("fof-upload.forum.buttons.upload");return m(x(),{className:S()(["Button","hasIcon","fof-upload-button",!this.isMediaUploadButton&&!this.attrs.uploader.uploading&&"Button--icon",!this.isMediaUploadButton&&!this.attrs.uploader.uploading&&"Button--link",this.attrs.uploader.uploading&&"uploading"]),icon:!this.attrs.uploader.uploading&&"fas fa-file-upload",onclick:this.uploadButtonClicked.bind(this),disabled:this.attrs.disabled},this.attrs.uploader.uploading&&m(N(),{size:"small",display:"inline",className:"Button-icon"}),(this.isMediaUploadButton||this.attrs.uploader.uploading)&&m("span",{className:"Button-label"},t),m("form",null,m("input",{type:"file",multiple:!0,onchange:this.process.bind(this)})))},o.process=function(t){var e=this.$("input").prop("files");0!==e.length&&this.attrs.uploader.upload(e,!this.isMediaUploadButton)},o.uploadButtonClicked=function(t){this.$("input").click()},i}(w()),B=function(){function t(t,e){this.upload=t,this.composerElement=e,this.handlers={},this.supportsFileDragging()&&(this.composerElement.addEventListener("dragover",this.handlers.in=this.in.bind(this)),this.composerElement.addEventListener("dragleave",this.handlers.out=this.out.bind(this)),this.composerElement.addEventListener("dragend",this.handlers.out),this.composerElement.addEventListener("drop",this.handlers.dropping=this.dropping.bind(this)))}var e=t.prototype;return e.supportsFileDragging=function(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&"FormData"in window&&"FileReader"in window},e.unload=function(){this.handlers.in&&(this.composerElement.removeEventListener("dragover",this.handlers.in),this.composerElement.removeEventListener("dragleave",this.handlers.out),this.composerElement.removeEventListener("dragend",this.handlers.out),this.composerElement.removeEventListener("drop",this.handlers.dropping))},e.isNotFile=function(t){if(t.dataTransfer.items)for(var e=0;e<t.dataTransfer.items.length;e++)if("file"!==t.dataTransfer.items[e].kind)return!0;return!1},e.in=function(t){this.isNotFile(t)||(t.preventDefault(),this.over||(this.composerElement.classList.add("fof-upload-dragging"),this.over=!0))},e.out=function(t){this.isNotFile(t)||(t.preventDefault(),this.over&&(this.composerElement.classList.remove("fof-upload-dragging"),this.over=!1))},e.dropping=function(t){this.isNotFile(t)||(t.preventDefault(),this.upload(t.dataTransfer.files),this.composerElement.classList.remove("fof-upload-dragging"))},t}(),U=function(){function t(t,e){this.upload=t,e.addEventListener("paste",this.paste.bind(this))}return t.prototype.paste=function(t){if(t.clipboardData&&t.clipboardData.items){for(var e=t.clipboardData.items,i=[],o=0;o<e.length;o++)-1!==e[o].type.indexOf("image")&&i.push(e[o].getAsFile());i.length>0&&(t.preventDefault(),this.upload(i))}},t}(),E=function(){function t(){this.callbacks={success:[],failure:[],uploading:[],uploaded:[]},this.uploading=!1}var i=t.prototype;return i.on=function(t,e){this.callbacks[t].push(e)},i.dispatch=function(t,e){this.callbacks[t].forEach((function(t){return t(e)}))},i.upload=function(t,i){var o=this;void 0===i&&(i=!0),this.uploading=!0,this.dispatch("uploading",t),m.redraw();for(var a=new FormData,r=0;r<t.length;r++)a.append("files[]",t[r]);return e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/fof/upload",serialize:function(t){return t},body:a}).then((function(t){return o.uploaded(t,i)})).catch((function(t){o.uploading=!1,m.redraw();var i=t.response.errors[0];if(!i.code.includes("fof-upload"))throw t;e().alerts.clear(),e().alerts.show({type:"error"},i.detail)}))},i.uploaded=function(t,i){var o=this;void 0===i&&(i=!1),this.uploading=!1,t.data.forEach((function(t){var a=e().store.pushObject(t);e().fileListState.addToList(a),o.dispatch("success",{file:a,addBBcode:i})})),this.dispatch("uploaded")},t}();const M=flarum.core.compat["common/components/Modal"];var C=i.n(M);const O=flarum.core.compat["common/components/Alert"];var T=i.n(O);const A=flarum.core.compat["common/utils/extractText"];var D=i.n(A),j=new Map([["image/png","far fa-file-image"],["image/jpg","far fa-file-image"],["image/jpeg","far fa-file-image"],["image/svg+xml","far fa-file-image"],["image/gif","far fa-file-image"],["image/bmp","far fa-file-image"],["image/webp","far fa-file-image"],["application/zip","far fa-file-archive"],["application/x-7z-compressed","far fa-file-archive"],["application/gzip","far fa-file-archive"],["application/vnd.rar","far fa-file-archive"],["application/x-rar-compressed","far fa-file-archive"],["application/x-tar","far fa-file-archive"],["application/x-iso9660-image","far fa-file-archive"],["text/plain","far fa-file-alt"],["text/csv","far fa-file-csv"],["text/xml","far fa-file-code"],["text/html","far fa-file-code"],["text/css","far fa-file-code"],["text/javascript","far fa-file-code"],["application/json","far fa-file-code"],["application/ld+json","far fa-file-code"],["application/x-httpd-php","far fa-file-code"],["application/xml","far fa-file-code"],["text/xml","far fa-file-code"],["application/x-abiword","far fa-file-word"],["application/msword","far fa-file-word"],["application/vnd.openxmlformats-officedocument.wordprocessingml.document","far fa-file-word"],["application/vnd.oasis.opendocument.text","far fa-file-word"],["application/vnd.ms-excel","far fa-file-excel"],["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","far fa-file-excel"],["application/vnd.oasis.opendocument.spreadsheet","far fa-file-excel"],["application/vnd.ms-powerpoint","far fa-file-powerpoint"],["application/vnd.openxmlformats-officedocument.presentationml.presentation","far fa-file-powerpoint"],["application/vnd.oasis.opendocument.presentation","far fa-file-powerpoint"],["application/pdf","far fa-file-pdf"],["application/rtf","far fa-file-alt"],["application/epub+zip","far fa-book"],["application/x-mobipocket-ebook","far fa-book"],["application/vnd.amazon.ebook","far fa-book"],["audio/mpeg","far fa-file-audio"],["audio/wav","far fa-file-audio"],["audio/x-wav","far fa-file-audio"],["audio/aac","far fa-file-audio"],["audio/ogg","far fa-file-audio"],["audio/flac","far fa-file-audio"],["audio/aiff","far fa-file-audio"],["audio/x-aiff","far fa-file-audio"],["video/x-msvideo","far fa-file-video"],["video/mp4","far fa-file-video"],["video/quicktime","far fa-file-video"]]);function I(t){return j.get(t)||(t.startsWith("image/")?"far fa-file-image":t.startsWith("video/")?"far fa-file-video":t.startsWith("audio/")?"far fa-file-audio":"far fa-file")}const P=flarum.core.compat["common/helpers/icon"];var R=i.n(P),z=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),u().fileListState.setUser(e.attrs.user||u().session.user),this.inModal=e.attrs.selectable,this.restrictFileType=e.attrs.restrictFileType||null,this.downloadOnClick=this.attrs.downloadOnClick||!1,this.filesBeingHidden=[],this.user=u().fileListState.user},i.view=function(){var t=this,e=u().fileListState;return m("div",{className:"fof-upload-file-list","aria-live":"polite"},e.isLoading()&&0===e.files.length&&m("div",{className:"fof-upload-loading"},u().translator.trans("fof-upload.forum.file_list.loading"),m(N(),null)),this.inModal&&e.empty()&&m("p",{className:"fof-upload-empty"},m("i",{className:"fas fa-cloud-upload-alt fof-upload-empty-icon"}),u().translator.trans("fof-upload.forum.file_list.modal_empty_"+("phone"!==u().screen()?"desktop":"phone"))),!this.inModal&&e.empty()&&m("div",{className:"Placeholder"},m("p",{className:"fof-upload-empty"},u().translator.trans("fof-upload.forum.file_list.empty"))),m("ul",null,e.files.map((function(e){var i=I(e.type()),o=!t.restrictFileType||t.isSelectable(e),a=S()(["fof-file","far fa-file-image"===i&&"fof-file-type-image",t.attrs.selectedFiles&&t.attrs.selectedFiles.indexOf(e.id())>=0&&"fof-file-selected"]),r=e.baseName(),n=t.filesBeingHidden.includes(e.uuid());return m("li",{"aria-busy":n},u().session.user&&(t.user===u().session.user||u().session.user.deleteOthersMediaLibrary())&&m(x(),{className:"Button Button--icon fof-file-delete",icon:"far fa-trash-alt","aria-label":u().translator.trans("fof-upload.forum.file_list.delete_file_a11y_label",{fileName:r}),disabled:n,onclick:t.hideFile.bind(t,e)}),m("button",{className:a,onclick:function(){return t.onFileClick(e)},disabled:!o||n,"aria-label":D()(u().translator.trans("fof-upload.forum.file_list.select_file_a11y_label",{fileName:r}))},m("figure",null,"far fa-file-image"===i?m("img",{src:e.url(),className:"fof-file-image-preview",draggable:!1,alt:""}):m("span",{className:"fof-file-icon",role:"presentation"},R()("fa-fw "+i)),m("figcaption",{className:"fof-file-name"},r),n&&m("span",{class:"fof-file-loading",role:"status","aria-label":u().translator.trans("fof-upload.forum.file_list.hide_file.loading")},m(N(),null)))))}))),e.hasMoreResults()&&m("div",{className:"fof-load-more-files"},m(x(),{className:"Button Button--primary",disabled:e.isLoading(),loading:e.isLoading(),onclick:function(){return e.loadMore()}},u().translator.trans("fof-upload.forum.file_list.load_more_files_btn"))))},i.onFileClick=function(t){this.attrs.onFileSelect?this.attrs.onFileSelect(t):this.attrs.downloadOnClick&&window.open(t.url())},i.isSelectable=function(t){var e=t.type();return Array.isArray(this.restrictFileType)?this.restrictFileType.indexOf(e)>=0:"image"===this.restrictFileType?e.includes("image/"):"audio"===this.restrictFileType?e.includes("audio/"):"video"===this.restrictFileType&&e.includes("video/")},i.hideFile=function(t){var e=this,i=t.uuid();if(!this.filesBeingHidden.includes(i))if(this.filesBeingHidden.push(i),confirm(D()(u().translator.trans("fof-upload.forum.file_list.hide_file.hide_confirmation",{fileName:t.baseName()}))))u().request({method:"PATCH",url:u().forum.attribute("apiUrl")+"/fof/upload/hide",body:{uuid:i}}).then((function(){u().alerts.show(T(),{type:"success"},u().translator.trans("fof-upload.forum.file_list.hide_file.hide_success"))})).catch((function(){u().alerts.show(T(),{type:"error"},u().translator.trans("fof-upload.forum.file_list.hide_file.hide_fail",{fileName:t.fileName()}))})).then((function(){var t=u().fileListState,o=t.files.findIndex((function(t){return i===t.uuid()}));t.files.splice(o,1);var a=e.filesBeingHidden.indexOf(i);e.filesBeingHidden.splice(a,1)}));else{var o=this.filesBeingHidden.indexOf(i);this.filesBeingHidden.splice(o,1)}},e}(w());const H=flarum.core.compat["common/components/Switch"];var G=i.n(H),$=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))||this).files=[],e.fileInput=null,e.options={shared:!0,hidden:!1},e.onUploadComplete=void 0,e}y(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.onUploadComplete=this.attrs.onUploadComplete},i.className=function(){return"UploadSharedFileModal Modal--medium"},i.title=function(){return u().translator.trans("fof-upload.lib.upload-shared-file-modal.title")},i.onFileChange=function(t){this.addFiles(Array.from(t.target.files))},i.addFiles=function(t){var e;(e=this.files).push.apply(e,t),m.redraw()},i.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"UploadSharedFileModal-files"},m("input",{type:"file",multiple:!0,onchange:this.onFileChange.bind(this)}),this.files.map((function(t){var e=t.type.startsWith("image/");return m("div",{className:"UploadedFile"},e?m("img",{src:URL.createObjectURL(t),alt:t.name}):m("i",{className:I(t.type)}),m("div",null,t.name))}))),m("div",{className:"UploadSharedFileModal-options Form-group"},m(G(),{state:this.options.hidden,onchange:function(e){return t.options.hidden=e}},u().translator.trans("fof-upload.lib.upload-shared-file-modal.hide-from-media-gallery"))),m("div",{className:"UploadSharedFileModal-submit App-primaryControl"},m(x(),{className:"Button Button--primary",onclick:this.upload.bind(this),disabled:!this.files.length},u().translator.trans("fof-upload.lib.upload-shared-file-modal.upload"))))},i.upload=function(){var t=this,e=new FormData;this.files.forEach((function(t){e.append("files[]",t)})),Object.keys(this.options).forEach((function(i){e.append("options["+i+"]",t.options[i])})),u().request({method:"POST",url:u().forum.attribute("apiUrl")+"/fof/upload",serialize:function(t){return t},body:e}).then((function(){t.files=[],t.hide(),t.onUploadComplete()})).catch((function(t){console.error(t)}))},e}(C());const q=flarum.core.compat["common/utils/ItemList"];var W=i.n(q);function Y(t,e,i,o,a,r,n){try{var s=t[r](n),l=s.value}catch(t){return void i(t)}s.done?e(l):Promise.resolve(l).then(o,a)}var V=i(195),J=i.n(V);const K=flarum.core.compat["admin/app"];var Q=i.n(K),X=function(t){function e(){for(var e,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))||this).file=void 0,e.callback=void 0,e.imageLoaded=!0,e.handleImageError=function(){e.imageLoaded=!1,m.redraw()},e.handleImageLoad=function(){e.imageLoaded=!0,m.redraw()},e}y(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.file=this.attrs.file,this.callback=this.attrs.callback},i.view=function(){var t=this,e=this.file.type().startsWith("image/"),i=I(this.file.type()),o=this.file.isPrivateShared()?"fas fa-lock":"fas fa-unlock";return m("div",{className:"UploadedFile",key:this.file.uuid()},m("div",{className:"UploadedFile--sharestatus"},m("span",null,R()(o),this.file.baseName())),m("div",{className:"UploadedFile--preview",onclick:function(){return t.onFileClick(t.file)}},e?this.imageLoaded?m("img",{src:this.file.url(),loading:"lazy",onerror:this.handleImageError,onload:this.handleImageLoad}):R()("fas fa-exclamation-triangle",{className:"icon-fallback"}):R()(i,{className:"icon-fallback"})),m("div",{className:"UploadedFile--actions"},this.actionItems().toArray()))},i.actionItems=function(){var t=this,e=new(W());e.add("view-info",m(x(),{className:"Button Button--icon",icon:"fas fa-info-circle",onclick:function(){return t.viewFileInfo()},"aria-label":"info"})),e.add("download",m(x(),{className:"Button Button--icon",icon:"fas fa-download",onclick:function(){return window.open(t.file.url())},"aria-label":"download"}));var i=this.file.isPrivateShared()?"fas fa-lock":this.file.hidden()?"fas fa-eye":"fas fa-eye-slash";return e.add("hide-file",m(x(),{className:"Button Button--icon",icon:i,onclick:function(){return t.hideFile()},"aria-label":"hide"})),e.add("delete",m(x(),{className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.confirmDelete()},"aria-label":"delete"})),e},i.confirmDelete=function(){var t,e=(t=J().mark((function t(){var e;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm("Are you sure you want to delete this file?")){t.next=6;break}return e=this.file.uuid(),t.next=5,Q().request({method:"DELETE",url:Q().forum.attribute("apiUrl")+"/fof/upload/delete/"+e});case 5:this.callback&&this.callback();case 6:case"end":return t.stop()}}),t,this)})),function(){var e=this,i=arguments;return new Promise((function(o,a){var r=t.apply(e,i);function n(t){Y(r,o,a,n,s,"next",t)}function s(t){Y(r,o,a,n,s,"throw",t)}n(void 0)}))});return function(){return e.apply(this,arguments)}}(),i.viewFileInfo=function(){console.log("view file info")},i.hideFile=function(){console.log("hide file")},i.onFileClick=function(t){this.attrs.onFileSelect&&this.attrs.onFileSelect(t)},e}(w()),Z=function(t){function i(){return t.apply(this,arguments)||this}y(i,t);var o=i.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.uploader=e.attrs.uploader,this.selectedFiles=[],this.multiSelect=e.attrs.multiSelect||!0,this.restrictFileType=e.attrs.restrictFileType||null,this.dragDrop=null,this.selectedFilesLibrary=e.attrs.defaultFilesLibrary||"user",this.sharedUploads=null,this.onUpload()},o.className=function(){return"Modal--large fof-file-manager-modal"},o.oncreate=function(e){var i=this;t.prototype.oncreate.call(this,e),this.dragDrop=new B((function(t){return i.uploader.upload(t,!1)}),this.$().find(".Modal-content")[0])},o.onremove=function(){this.dragDrop&&this.dragDrop.unload()},o.view=function(){var t=this.selectedFiles.length;return m("div",{className:"Modal modal-dialog "+this.className()},m("div",{className:"Modal-content"},m("div",{className:"fof-modal-buttons App-backControl"},m(_,{uploader:this.uploader,disabled:e().fileListState.isLoading(),isMediaUploadButton:!0}),e().session.user&&e().session.user.uploadSharedFiles()&&m(x(),{className:"Button",icon:"fas fa-cloud-upload-alt",onclick:function(){e().modal.show($,{},!0)}},e().translator.trans("fof-upload.forum.buttons.upload_shared"))),m("div",{className:"fof-drag-and-drop"},m("div",{className:"fof-drag-and-drop-release"},m("i",{className:"fas fa-cloud-upload-alt"}),e().translator.trans("fof-upload.forum.file_list.release_to_upload"))),m("div",{className:"Modal-header"},m("h3",{className:"App-titleControl App-titleControl--text"},e().translator.trans("fof-upload.forum.media_manager"))),this.alertAttrs&&m("div",{className:"Modal-alert"},m(Alert,this.alertAttrs)),m("div",{className:"Modal-body"},m("div",{className:"LibrarySelection"},this.fileLibraryButtonItems().toArray()),"user"===this.selectedFilesLibrary&&this.userFilesContent(),"shared"===this.selectedFilesLibrary&&this.sharedFilesContent()),m("div",{className:"Modal-footer"},m(x(),{onclick:this.hide.bind(this),className:"Button"},e().translator.trans("fof-upload.forum.buttons.cancel")),m(x(),{onclick:this.onSelect.bind(this),disabled:0===this.selectedFiles.length||!this.multiSelect&&this.selectedFiles.length>1,className:"Button Button--primary"},e().translator.trans("fof-upload.forum.file_list.confirm_selection_btn",{fileCount:t})))))},o.fileLibraryButtonItems=function(){var t=this,i=new(W());return i.add("user",m(x(),{className:"Button "+("user"===this.selectedFilesLibrary?"active":""),onclick:function(){return t.setLibrary("user")}},e().translator.trans("fof-upload.forum.buttons.media"))),i.add("shared",m(x(),{className:"Button "+("shared"===this.selectedFilesLibrary?"active":""),onclick:function(){return t.setLibrary("shared")}},e().translator.trans("fof-upload.forum.buttons.shared_media"))),i},o.setLibrary=function(t){this.selectedFilesLibrary=t,m.redraw()},o.userFilesContent=function(){return m(z,{user:this.attrs.user,selectable:!0,onFileSelect:this.onFileSelect.bind(this),selectedFiles:this.selectedFiles,restrictFileType:this.restrictFileType})},o.sharedFilesContent=function(){var t=this;return null===this.sharedUploads&&this.loadSharedUploads(),m("div",{className:"SharedFileList"},this.sharedUploads&&this.sharedUploads.map((function(e){return m(X,{file:e,callback:function(){return t.callback()},onFileSelect:t.onFileSelect.bind(t)})})))},o.loadSharedUploads=function(t){var i=this;void 0===t&&(t=1),this.loading=!0,e().store.find("fof/upload/shared-files").then((function(t){i.sharedUploads=t})).catch((function(){})).then((function(){i.loading=!1,m.redraw()}))},o.onFileSelect=function(t){var e=this.selectedFiles.indexOf(t.id());e>=0?this.selectedFiles.splice(e,1):this.multiSelect?this.selectedFiles.push(t.id()):this.selectedFiles=[t.id()]},o.onUpload=function(){var t=this;this.uploader.on("success",(function(e){var i=e.file;t.multiSelect?t.selectedFiles.push(i.id()):t.selectedFiles=[i.id()]}))},o.onSelect=function(){this.hide(),this.attrs.onSelect?this.attrs.onSelect(this.selectedFiles):this.selectedFiles.map((function(t){var i=e().store.getById("files",t)||e().store.getById("shared-files",t);e().composer.editor.insertAtCursor(i.bbcode()+"\n",!1)}))},i}(C());const tt=flarum.core.compat["common/components/Tooltip"];var et=i.n(tt),it=function(t){function i(){return t.apply(this,arguments)||this}y(i,t);var o=i.prototype;return o.view=function(){return m(et(),{text:e().translator.trans("fof-upload.forum.buttons.media")},x().component({className:"Button fof-upload-button Button--icon",onclick:this.fileManagerButtonClicked.bind(this),icon:"fas fa-photo-video"}))},o.fileManagerButtonClicked=function(t){t.preventDefault(),e().modal.show(Z,{uploader:this.attrs.uploader})},i}(w());const ot=flarum.core.compat["forum/components/UserPage"];var at=i.n(ot);const rt=flarum.core.compat["common/components/LinkButton"];var nt=i.n(rt);const st=flarum.core.compat["common/extenders"];var lt=i.n(st),ut=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var i=e.prototype;return i.baseName=function(){return s().attribute("baseName").call(this)},i.path=function(){return s().attribute("path").call(this)},i.url=function(){return s().attribute("url").call(this)},i.size=function(){return s().attribute("size").call(this)},i.type=function(){return s().attribute("type").call(this)},i.humanSize=function(){return s().attribute("humanSize").call(this)},i.createdAt=function(){return s().attribute("createdAt",s().transformDate).call(this)},i.uuid=function(){return s().attribute("uuid").call(this)},i.tag=function(){return s().attribute("tag").call(this)},i.hidden=function(){return s().attribute("hidden").call(this)},i.bbcode=function(){return s().attribute("bbcode").call(this)},i.isShared=function(){return s().attribute("shared").call(this)},i.isPrivateShared=function(){return s().attribute("isPrivateShared").call(this)},i.apiEndpoint=function(){return"/fof/uploads"+(this.exists?"/"+this.id():"")},e}(s());const ft=[(new(lt().Store)).add("files",ut).add("shared-files",ut)];var ct=function(t){function i(){return t.apply(this,arguments)||this}y(i,t);var o=i.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.user=null,this.loadUser(m.route.param("username"))},o.content=function(){return e().session.user&&(e().session.user.viewOthersMediaLibrary()||this.user===e().session.user)?this.user&&z.component({user:this.user,selectable:!1,downloadOnClick:!0}):null},o.show=function(e){t.prototype.show.call(this,e),this.user=e},i}(at());const dt=[].concat(ft,[(new(lt().Routes)).add("user.uploads","/u/:username/uploads",ct)]);function pt(){return pt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},pt.apply(this,arguments)}var ht=pt({},{UploadedFile:X,UploadSharedFileModal:$,UserFileList:z},{DragAndDrop:B,FileManagerButton:it,FileManagerModal:Z,Uploader:E,UploadButton:_});e().initializers.add("fof-upload",(function(){r().prototype.viewOthersMediaLibrary=s().attribute("fof-upload-viewOthersMediaLibrary"),r().prototype.deleteOthersMediaLibrary=s().attribute("fof-upload-deleteOthersMediaLibrary"),r().prototype.uploadCountCurrent=s().attribute("fof-upload-uploadCountCurrent"),r().prototype.uploadCountAll=s().attribute("fof-upload-uploadCountAll"),r().prototype.uploadSharedFiles=s().attribute("fof-upload-uploadSharedFiles"),e().fileListState=new f,(0,c.extend)(v().prototype,"oninit",(function(){this.uploader=new E})),(0,c.extend)(v().prototype,"controlItems",(function(t){if(e().forum.attribute("fof-upload.canUpload")){var i=e().forum.attribute("fof-upload.composerButtonVisiblity");"both"!==i&&"media-btn"!==i||t.add("fof-upload-media",it.component({uploader:this.uploader})),"both"!==i&&"upload-btn"!==i||t.add("fof-upload",_.component({uploader:this.uploader}))}})),(0,c.extend)(v().prototype,"oncreate",(function(t,i){var o=this;if(e().forum.attribute("fof-upload.canUpload")){this.uploader.on("success",(function(t){var i=t.file;if(t.addBBcode&&(o.attrs.composer.editor.insertAtCursor(i.bbcode()+"\n",!1),"function"==typeof o.attrs.preview)){var a=e().composer.isFullScreen;e().composer.isFullScreen=function(){return!1},o.attrs.preview(),e().composer.isFullScreen=a}}));var a=this.fofUploadDragAndDropTarget();a&&(this.dragAndDrop=new B((function(t){return o.uploader.upload(t)}),a)),new U((function(t){return o.uploader.upload(t)}),this.$(".TextEditor-editor")[0])}})),(0,c.extend)(v().prototype,"onremove",(function(t,i){e().forum.attribute("fof-upload.canUpload")&&this.dragAndDrop&&this.dragAndDrop.unload()})),v().prototype.fofUploadDragAndDropTarget=function(){return this.$().parents(".Composer")[0]},(0,c.extend)(p().prototype,"oncreate",(function(){var t=this;this.$("[data-fof-upload-download-uuid]").unbind("click").on("click",(function(i){if(i.preventDefault(),i.stopPropagation(),e().forum.attribute("fof-upload.canDownload")){var o=e().forum.attribute("apiUrl")+"/fof/download";o+="/"+encodeURIComponent(i.currentTarget.dataset.fofUploadDownloadUuid),o+="/"+encodeURIComponent(t.attrs.post.id()),o+="/"+encodeURIComponent(e().session.csrfToken),window.open(o)}else alert(e().translator.trans("fof-upload.forum.states.unauthorized"))}))})),(0,c.extend)(at().prototype,"navItems",(function(t){var i=!!e().forum.attribute("fof-upload.canUpload"),o=!!this.user.uploadCountCurrent();if(e().session.user&&(e().session.user.viewOthersMediaLibrary()||this.user===e().session.user&&(i||o))){var a=this.user.uploadCountCurrent();t.add("uploads",nt().component({href:e().route("user.uploads",{username:this.user.username()}),name:"uploads",icon:"fas fa-file-upload"},[this.user===e().session.user?e().translator.trans("fof-upload.forum.buttons.media"):e().translator.trans("fof-upload.forum.buttons.user_uploads")," ",a>0?m("span",{className:"Button-badge"},a):""]),80)}}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map