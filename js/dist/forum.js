(()=>{var t={195:(t,e,i)=>{t.exports=i(236)},236:t=>{var e=function(t){"use strict";var e,i=Object.prototype,a=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",n=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function l(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,i){return t[e]=i}}function u(t,e,i,a){var o=e&&e.prototype instanceof v?e:v,r=Object.create(o.prototype),n=new _(a||[]);return r._invoke=function(t,e,i){var a=c;return function(o,r){if(a===h)throw new Error("Generator is already running");if(a===p){if("throw"===o)throw r;return E()}for(i.method=o,i.arg=r;;){var n=i.delegate;if(n){var s=N(n,i);if(s){if(s===m)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===c)throw a=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=h;var l=f(t,e,i);if("normal"===l.type){if(a=i.done?p:d,l.arg===m)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(a=p,i.method="throw",i.arg=l.arg)}}}(t,i,n),r}function f(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var c="suspendedStart",d="suspendedYield",h="executing",p="completed",m={};function v(){}function g(){}function y(){}var b={};l(b,r,(function(){return this}));var w=Object.getPrototypeOf,F=w&&w(w(D([])));F&&F!==i&&a.call(F,r)&&(b=F);var S=y.prototype=v.prototype=Object.create(b);function x(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function L(t,e){function i(o,r,n,s){var l=f(t[o],t,r);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&a.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,n,s)}),(function(t){i("throw",t,n,s)})):e.resolve(c).then((function(t){u.value=t,n(u)}),(function(t){return i("throw",t,n,s)}))}s(l.arg)}var o;this._invoke=function(t,a){function r(){return new e((function(e,o){i(t,a,e,o)}))}return o=o?o.then(r,r):r()}}function N(t,i){var a=t.iterator[i.method];if(a===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=e,N(t,i),"throw"===i.method))return m;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=f(a,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,m;var r=o.arg;return r?r.done?(i[t.resultName]=r.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,m):r:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,m)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function B(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function D(t){if(t){var i=t[r];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,n=function i(){for(;++o<t.length;)if(a.call(t,o))return i.value=t[o],i.done=!1,i;return i.value=e,i.done=!0,i};return n.next=n}}return{next:E}}function E(){return{value:e,done:!0}}return g.prototype=y,l(S,"constructor",y),l(y,"constructor",g),g.displayName=l(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},x(L.prototype),l(L.prototype,n,(function(){return this})),t.AsyncIterator=L,t.async=function(e,i,a,o,r){void 0===r&&(r=Promise);var n=new L(u(e,i,a,o),r);return t.isGeneratorFunction(i)?n:n.next().then((function(t){return t.done?t.value:n.next()}))},x(S),l(S,s,"Generator"),l(S,r,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var a=e.pop();if(a in t)return i.value=a,i.done=!1,i}return i.done=!0,i}},t.values=D,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var i in this)"t"===i.charAt(0)&&a.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function o(a,o){return s.type="throw",s.arg=t,i.next=a,o&&(i.method="next",i.arg=e),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r],s=n.completion;if("root"===n.tryLoc)return o("end");if(n.tryLoc<=this.prev){var l=a.call(n,"catchLoc"),u=a.call(n,"finallyLoc");if(l&&u){if(this.prev<n.catchLoc)return o(n.catchLoc,!0);if(this.prev<n.finallyLoc)return o(n.finallyLoc)}else if(l){if(this.prev<n.catchLoc)return o(n.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return o(n.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i];if(o.tryLoc<=this.prev&&a.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var n=r?r.completion:{};return n.type=t,n.arg=e,r?(this.method="next",this.next=r.finallyLoc,m):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),B(i),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var a=i.completion;if("throw"===a.type){var o=a.arg;B(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,a){return this.delegate={iterator:D(t),resultName:i,nextLoc:a},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}},e={};function i(a){var o=e[a];if(void 0!==o)return o.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{"use strict";i.r(a),i.d(a,{components:()=>mt,extend:()=>ht});const t=flarum.core.compat["forum/app"];var e=i.n(t);const o=flarum.core.compat["common/models/User"];var r=i.n(o);const n=flarum.core.compat["common/Model"];var s=i.n(n);const l=flarum.core.compat["common/extend"],u=flarum.core.compat["forum/components/Post"];var f=i.n(u);const c=flarum.core.compat["common/components/TextEditor"];var d=i.n(c);function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}function p(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,h(t,e)}const v=flarum.core.compat["common/Component"];var g=i.n(v);const y=flarum.core.compat["common/components/Button"];var b=i.n(y);const w=flarum.core.compat["common/components/LoadingIndicator"];var F=i.n(w);const S=flarum.core.compat["common/utils/classList"];var x=i.n(S),L=function(t){function i(){return t.apply(this,arguments)||this}p(i,t);var a=i.prototype;return a.oninit=function(e){var i=this;t.prototype.oninit.call(this,e),this.attrs.uploader.on("uploaded",(function(){i.$("form")[0].reset(),m.redraw()})),this.isMediaUploadButton=e.attrs.isMediaUploadButton||!1},a.view=function(){var t=this.attrs.uploader.uploading?e().translator.trans("fof-upload.forum.states.loading"):e().translator.trans("fof-upload.forum.buttons.upload");return m(b(),{className:x()(["Button","hasIcon","fof-upload-button",!this.isMediaUploadButton&&!this.attrs.uploader.uploading&&"Button--icon",!this.isMediaUploadButton&&!this.attrs.uploader.uploading&&"Button--link",this.attrs.uploader.uploading&&"uploading"]),icon:!this.attrs.uploader.uploading&&"fas fa-file-upload",onclick:this.uploadButtonClicked.bind(this),disabled:this.attrs.disabled},this.attrs.uploader.uploading&&m(F(),{size:"small",display:"inline",className:"Button-icon"}),(this.isMediaUploadButton||this.attrs.uploader.uploading)&&m("span",{className:"Button-label"},t),m("form",null,m("input",{type:"file",multiple:!0,onchange:this.process.bind(this)})))},a.process=function(t){var e=this.$("input").prop("files");0!==e.length&&this.attrs.uploader.upload(e,!this.isMediaUploadButton)},a.uploadButtonClicked=function(t){this.$("input").click()},i}(g()),N=function(){function t(t,e){this.upload=t,this.composerElement=e,this.handlers={},this.supportsFileDragging()&&(this.composerElement.addEventListener("dragover",this.handlers.in=this.in.bind(this)),this.composerElement.addEventListener("dragleave",this.handlers.out=this.out.bind(this)),this.composerElement.addEventListener("dragend",this.handlers.out),this.composerElement.addEventListener("drop",this.handlers.dropping=this.dropping.bind(this)))}var e=t.prototype;return e.supportsFileDragging=function(){var t=document.createElement("div");return("draggable"in t||"ondragstart"in t&&"ondrop"in t)&&"FormData"in window&&"FileReader"in window},e.unload=function(){this.handlers.in&&(this.composerElement.removeEventListener("dragover",this.handlers.in),this.composerElement.removeEventListener("dragleave",this.handlers.out),this.composerElement.removeEventListener("dragend",this.handlers.out),this.composerElement.removeEventListener("drop",this.handlers.dropping))},e.isNotFile=function(t){if(t.dataTransfer.items)for(var e=0;e<t.dataTransfer.items.length;e++)if("file"!==t.dataTransfer.items[e].kind)return!0;return!1},e.in=function(t){this.isNotFile(t)||(t.preventDefault(),this.over||(this.composerElement.classList.add("fof-upload-dragging"),this.over=!0))},e.out=function(t){this.isNotFile(t)||(t.preventDefault(),this.over&&(this.composerElement.classList.remove("fof-upload-dragging"),this.over=!1))},e.dropping=function(t){this.isNotFile(t)||(t.preventDefault(),this.upload(t.dataTransfer.files),this.composerElement.classList.remove("fof-upload-dragging"))},t}(),k=function(){function t(t,e){this.upload=t,e.addEventListener("paste",this.paste.bind(this))}return t.prototype.paste=function(t){if(t.clipboardData&&t.clipboardData.items){for(var e=t.clipboardData.items,i=[],a=0;a<e.length;a++)-1!==e[a].type.indexOf("image")&&i.push(e[a].getAsFile());i.length>0&&(t.preventDefault(),this.upload(i))}},t}(),B=function(){function t(){this.callbacks={success:[],failure:[],uploading:[],uploaded:[]},this.uploading=!1}var i=t.prototype;return i.setState=function(t){this.fileState=t},i.on=function(t,e){this.callbacks[t].push(e)},i.dispatch=function(t,e){this.callbacks[t].forEach((function(t){return t(e)}))},i.upload=function(t,i){var a=this;void 0===i&&(i=!0),this.uploading=!0,this.dispatch("uploading",t),m.redraw();for(var o=new FormData,r=0;r<t.length;r++)o.append("files[]",t[r]);return e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/fof/upload",serialize:function(t){return t},body:o}).then((function(t){return a.uploaded(t,i)})).catch((function(t){a.uploading=!1,m.redraw();var i=t.response.errors[0];if(!i.code.includes("fof-upload"))throw t;e().alerts.clear(),e().alerts.show({type:"error"},i.detail)}))},i.uploaded=function(t,i){var a=this;void 0===i&&(i=!1),this.uploading=!1,t.data.forEach((function(t){var o=e().store.pushObject(t);a.fileState.addToList(o),a.dispatch("success",{file:o,addBBcode:i})})),this.dispatch("uploaded")},t}();const _=flarum.core.compat["common/components/Modal"];var D=i.n(_);const E=flarum.core.compat["common/app"];var U=i.n(E);function C(t,e,i,a,o,r,n){try{var s=t[r](n),l=s.value}catch(t){return void i(t)}s.done?e(l):Promise.resolve(l).then(a,o)}function M(t){return function(){var e=this,i=arguments;return new Promise((function(a,o){var r=t.apply(e,i);function n(t){C(r,a,o,n,s,"next",t)}function s(t){C(r,a,o,n,s,"throw",t)}n(void 0)}))}}var O=i(195),T=i.n(O),I=new Map([["image/png","far fa-file-image"],["image/jpg","far fa-file-image"],["image/jpeg","far fa-file-image"],["image/svg+xml","far fa-file-image"],["image/gif","far fa-file-image"],["image/bmp","far fa-file-image"],["image/webp","far fa-file-image"],["application/zip","far fa-file-archive"],["application/x-7z-compressed","far fa-file-archive"],["application/gzip","far fa-file-archive"],["application/vnd.rar","far fa-file-archive"],["application/x-rar-compressed","far fa-file-archive"],["application/x-tar","far fa-file-archive"],["application/x-iso9660-image","far fa-file-archive"],["text/plain","far fa-file-alt"],["text/csv","far fa-file-csv"],["text/xml","far fa-file-code"],["text/html","far fa-file-code"],["text/css","far fa-file-code"],["text/javascript","far fa-file-code"],["application/json","far fa-file-code"],["application/ld+json","far fa-file-code"],["application/x-httpd-php","far fa-file-code"],["application/xml","far fa-file-code"],["text/xml","far fa-file-code"],["application/x-abiword","far fa-file-word"],["application/msword","far fa-file-word"],["application/vnd.openxmlformats-officedocument.wordprocessingml.document","far fa-file-word"],["application/vnd.oasis.opendocument.text","far fa-file-word"],["application/vnd.ms-excel","far fa-file-excel"],["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","far fa-file-excel"],["application/vnd.oasis.opendocument.spreadsheet","far fa-file-excel"],["application/vnd.ms-powerpoint","far fa-file-powerpoint"],["application/vnd.openxmlformats-officedocument.presentationml.presentation","far fa-file-powerpoint"],["application/vnd.oasis.opendocument.presentation","far fa-file-powerpoint"],["application/pdf","far fa-file-pdf"],["application/rtf","far fa-file-alt"],["application/epub+zip","far fa-book"],["application/x-mobipocket-ebook","far fa-book"],["application/vnd.amazon.ebook","far fa-book"],["audio/mpeg","far fa-file-audio"],["audio/wav","far fa-file-audio"],["audio/x-wav","far fa-file-audio"],["audio/aac","far fa-file-audio"],["audio/ogg","far fa-file-audio"],["audio/flac","far fa-file-audio"],["audio/aiff","far fa-file-audio"],["audio/x-aiff","far fa-file-audio"],["video/x-msvideo","far fa-file-video"],["video/mp4","far fa-file-video"],["video/quicktime","far fa-file-video"]]);function A(t){return I.get(t)||(t.startsWith("image/")?"far fa-file-image":t.startsWith("video/")?"far fa-file-video":t.startsWith("audio/")?"far fa-file-audio":"far fa-file")}const P=flarum.core.compat["common/helpers/icon"];var j=i.n(P);const R=flarum.core.compat["common/utils/ItemList"];var H=i.n(R);const z=flarum.core.compat["common/components/Tooltip"];var G=i.n(z),$=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).isFileHiding=void 0,e.imageLoaded=!0,e.file=void 0,e.fileIcon=void 0,e.isSelected=void 0,e.isSelectable=void 0,e.handleImageError=function(){e.imageLoaded=!1,e.fileIcon="fas fa-exclamation-triangle",e.isSelectable=!1,m.redraw()},e.handleImageLoad=function(){e.imageLoaded=!0,m.redraw()},e}p(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.file=this.attrs.file,this.isFileHiding=void 0!==this.attrs.isFileHiding&&this.attrs.isFileHiding,this.fileIcon=A(this.file.type()),this.isSelected=void 0!==this.attrs.isSelected&&this.attrs.isSelected,this.isSelectable=void 0===this.attrs.fileSelectable||this.attrs.fileSelectable},i.onbeforeupdate=function(e){t.prototype.onbeforeupdate.call(this,e),this.isSelected=void 0!==this.attrs.isSelected&&this.attrs.isSelected},i.view=function(){var t=this,e=this.file.type().startsWith("image/"),i=this.isSelected?"selected":"";return m("div",{className:"UploadedFile "+i,key:this.file.uuid(),onclick:function(){t.isSelectable&&!t.isFileHiding&&(t.isSelected=!t.isSelected,t.attrs.onFileClick(t.file))},disabled:!this.isSelectable||this.isFileHiding},this.imageLoaded&&e?m("img",{src:this.file.url(),className:"fof-file-image-preview",draggable:!1,onerror:this.handleImageError,onload:this.handleImageLoad,alt:this.file.baseName()}):this.displayIcon(this.fileIcon),m("div",{className:"fof-file-actions"},this.actionItems(this.file).toArray()),m("div",{className:"fof-file-name"},m(G(),{text:this.file.baseName()},m("span",null,this.file.baseName()))),this.isFileHiding&&m("div",{class:"fof-file-loading",role:"status","aria-label":U().translator.trans("fof-upload.lib.file_list.hide_file.loading")},m(F(),null)))},i.displayIcon=function(t){return m("span",{className:"fof-file-icon",role:"presentation",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},j()("fa-fw "+t))},i.actionItems=function(t){var e=this,i=new(H());t.canViewInfo()&&i.add("view-info",m(b(),{className:"Button Button--icon fof-file-action",icon:"fas fa-info-circle","aria-label":"info",onclick:function(){return e.viewFileInfo()}}),100);var a=t.isShared()?"fof-upload.lib.file_list.hide_shared_file":"fof-upload.lib.file_list.hide_file";return t.canHide()&&i.add("hide-file",m(b(),{className:"Button Button--icon fof-file-action",icon:this.file.hidden()?"fas fa-eye":"fas fa-eye-slash","aria-label":U().translator.trans(this.file.hidden()?a+".btn_a11y_label_show":a+".btn_a11y_label_hide",{fileName:t.baseName()}),disabled:this.isFileHiding,onclick:function(t){return e.hide(t)}}),80),t.canDelete()&&i.add("delete-file",m(b(),{className:"Button Button--icon fof-file-action",icon:"fas fa-trash","aria-label":U().translator.trans("fof-upload.lib.file_list.delete_file_a11y_label",{fileName:t.baseName()}),disabled:this.isFileHiding,onclick:function(){return e.confirmDelete()}}),60),i},i.viewFileInfo=function(){console.log("view file info")},i.hide=function(t){t.stopPropagation(),this.attrs.onHide&&this.attrs.onHide(this.file)},i.confirmDelete=function(){var t=M(T().mark((function t(){var e;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm("Are you sure you want to delete this file?")){t.next=6;break}return e=this.file.uuid(),t.next=5,U().request({method:"DELETE",url:U().forum.attribute("apiUrl")+"/fof/upload/delete/"+e});case 5:this.attrs.onDelete&&this.attrs.onDelete(this.file);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(g());const q=flarum.core.compat["common/components/Alert"];var W=i.n(q);const V=flarum.core.compat["common/utils/extractText"];var Y=i.n(V),J=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).user=null,e.inModal=void 0,e.restrictFileType=void 0,e.downloadOnClick=void 0,e.filesBeingHidden=void 0,e.fileState=void 0,e}p(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.inModal=this.attrs.selectable,this.restrictFileType=this.attrs.restrictFileType||null,this.downloadOnClick=this.attrs.downloadOnClick||!1,this.filesBeingHidden=[],this.fileState=this.attrs.fileState,this.loadFileList()},i.view=function(){var t=this;return m("div",{className:"SharedFileList fof-upload-file-list","aria-live":"polite"},this.isLoading()&&0===this.fileCollection().length&&m("div",{className:"fof-upload-loading"},U().translator.trans("fof-upload.lib.file_list.loading"),m(F(),null)),!this.isLoading()&&0===this.fileCollection().length&&m("div",{className:"Placeholder"},m("p",{className:"fof-upload-empty"},U().translator.trans("fof-upload.lib.file_list.empty"))),m("ul",null,this.fileCollection().map((function(e){var i,a,o=A(e.type()),r=!t.restrictFileType||t.isSelectable(e),n=x()(["fof-file","far fa-file-image"===o&&"fof-file-type-image",t.attrs.selectedFiles&&t.attrs.selectedFiles.indexOf(null!=(i=e.id())?i:"")>=0&&"fof-file-selected"]),s=t.filesBeingHidden.includes(e.uuid());return m("li",{"aria-busy":s,key:e.uuid()},m($,{file:e,fileSelectable:r,isSelected:t.attrs.selectedFiles&&t.attrs.selectedFiles.indexOf(null!=(a=e.id())?a:"")>=0,fileClassNames:n,isFileHiding:s,onHide:t.hideFile.bind(t),onFileClick:t.onFileClick.bind(t),user:t.attrs.user,onDelete:t.onDelete.bind(t)}))})),this.hasMoreResults()&&m("div",{className:"fof-load-more-files"},m(b(),{className:"Button Button--primary",disabled:this.isLoading(),loading:this.isLoading(),onclick:function(){return t.loadMore()}},U().translator.trans("fof-upload.lib.file_list.load_more_files_btn")))))},i.onDelete=function(t){this.attrs.onDelete&&this.attrs.onDelete(t)},i.onFileClick=function(t){this.attrs.onFileSelect?this.attrs.onFileSelect(t):this.attrs.downloadOnClick&&window.open(t.url())},i.isSelectable=function(t){var e=t.type();return Array.isArray(this.restrictFileType)?this.restrictFileType.indexOf(e)>=0:"image"===this.restrictFileType?e.includes("image/"):"audio"===this.restrictFileType?e.includes("audio/"):"video"===this.restrictFileType&&e.includes("video/")},i.hideFile=function(){var t=M(T().mark((function t(e){var i,a,o,r,n;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.uuid(),!this.filesBeingHidden.includes(i)){t.next=3;break}return t.abrupt("return");case 3:if(this.filesBeingHidden.push(i),a=e.isShared()?"fof-upload.lib.file_list.hide_shared_file":"fof-upload.lib.file_list.hide_file",!confirm(Y()(U().translator.trans(e.hidden()?a+".show_confirmation":a+".hide_confirmation",{fileName:e.baseName()})))){t.next=24;break}return t.prev=7,t.next=10,U().request({method:"PATCH",url:U().forum.attribute("apiUrl")+"/fof/upload/hide",body:{uuid:i}});case 10:o=t.sent,U().store.pushPayload(o),m.redraw(),U().alerts.show(W(),{type:"success"},[j()(e.hidden()?"fas fa-eye-slash":"fas fa-eye")," ",U().translator.trans(null!=e&&e.hidden()?a+".hide_success":a+".show_success")]),this.fileState.user&&(r=this.fileState.files.findIndex((function(t){return i===t.uuid()})),this.fileState.files.splice(r,1)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),U().alerts.show(W(),{type:"error"},U().translator.trans(null!=e&&e.hidden()?a+".hide_fail":a+".show_fail",{fileName:e.baseName()}));case 20:return t.prev=20,n=this.filesBeingHidden.indexOf(i),this.filesBeingHidden.splice(n,1),t.finish(20);case 24:case"end":return t.stop()}}),t,this,[[7,17,20,24]])})));return function(e){return t.apply(this,arguments)}}(),e}(g()),K=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var i=e.prototype;return i.loadFileList=function(){this.fileState.setUser(this.attrs.user||U().session.user),this.user=this.fileState.user},i.hasMoreResults=function(){return this.fileState.hasMoreResults()},i.loadMore=function(){this.fileState.loadMore()},i.isLoading=function(){return this.fileState.isLoading()},i.fileCollection=function(){return this.fileState.files},e}(J);const Q=flarum.core.compat["common/components/Switch"];var X=i.n(Q),Z=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).files=[],e.fileInput=null,e.options={shared:!0,hidden:!1},e.loading=!1,e}p(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e)},i.className=function(){return"UploadSharedFileModal Modal--medium"},i.title=function(){return U().translator.trans("fof-upload.lib.upload-shared-file-modal.title")},i.onFileChange=function(t){this.addFiles(Array.from(t.target.files))},i.addFiles=function(t){var e;(e=this.files).push.apply(e,t),m.redraw()},i.onDragOver=function(t){t.preventDefault(),t.stopPropagation()},i.onDrop=function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer&&t.dataTransfer.files&&this.addFiles(Array.from(t.dataTransfer.files))},i.onDropzoneClick=function(){this.fileInput&&this.fileInput.click()},i.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"UploadSharedFileModal-dropzone",onclick:function(){return t.onDropzoneClick()},ondragover:this.onDragOver.bind(this),ondrop:this.onDrop.bind(this)},U().translator.trans("fof-upload.lib.upload-shared-file-modal.dropzone"),m("input",{type:"file",multiple:!0,onchange:this.onFileChange.bind(this),style:{opacity:0,position:"absolute",left:"-9999px"},oncreate:function(e){t.fileInput=e.dom}})),m("div",{className:"UploadSharedFileModal-files"},this.files.map((function(e){var i=e.type.startsWith("image/");return m("div",{className:"UploadedFile"},i?m("img",{src:URL.createObjectURL(e),alt:e.name}):m("i",{className:A(e.type)}),m("div",{className:"UploadedFile-name"},e.name),m(b(),{className:"Button Button--icon Button--link UploadedFile-remove",icon:"fas fa-times",onclick:function(){t.files=t.files.filter((function(t){return t!==e}))}}))}))),m("div",{className:"UploadSharedFileModal-options Form-group"},m(X(),{state:this.options.hidden,onchange:function(e){return t.options.hidden=e}},U().translator.trans("fof-upload.lib.upload-shared-file-modal.hide-from-media-gallery"))),m("div",{className:"UploadSharedFileModal-submit App-primaryControl"},m(b(),{className:"Button Button--primary",loading:this.loading,onclick:this.upload.bind(this),disabled:!this.files.length||this.loading},U().translator.trans("fof-upload.lib.upload-shared-file-modal.upload"))))},i.upload=function(){var t=M(T().mark((function t(){var e,i,a,o=this;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),e=new FormData,this.files.forEach((function(t){e.append("files[]",t)})),Object.keys(this.options).forEach((function(t){e.append("options["+t+"]",o.options[t])})),t.next=7,U().request({method:"POST",url:U().forum.attribute("apiUrl")+"/fof/upload",serialize:function(t){return t},body:e});case 7:i=t.sent,a=U().store.pushPayload(i),this.attrs.onUploadComplete(a),this.files=[],this.hide(),this.loading=!1,m.redraw();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(D()),tt=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var i=e.prototype;return i.loadFileList=function(){this.fileState.loadResults()},i.hasMoreResults=function(){return this.fileState.hasMoreResults()},i.loadMore=function(){this.fileState.loadMore()},i.isLoading=function(){return this.fileState.isLoading()},i.fileCollection=function(){return this.fileState.files},e}(J),et=function(){function t(t){void 0===t&&(t=!1),this.user=void 0,this.files=void 0,this.moreResults=void 0,this.loading=void 0,this.sharedFiles=void 0,this.user=null,this.files=[],this.moreResults=!1,this.loading=!1,this.sharedFiles=t}var e=t.prototype;return e.setUser=function(t){t!==this.user&&(this.user=t,this.files=[],this.loadResults())},e.refresh=function(){this.files=[],this.loadResults(),m.redraw()},e.loadResults=function(){var t=M(T().mark((function t(e){var i,a,o;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e&&(e=0),this.sharedFiles||this.user){t.next=3;break}return t.abrupt("return",Promise.reject("User not set"));case 3:return this.loading=!0,i="fof/uploads",a={},!this.sharedFiles&&this.user?a={filter:{user:this.user.id()},page:{offset:e}}:(i="fof/upload/shared-files",a={page:{offset:e}}),t.next=9,U().store.find(i,a);case 9:return o=t.sent,t.abrupt("return",this.parseResults(o));case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.loadMore=function(){var t=M(T().mark((function t(){return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.abrupt("return",this.loadResults(this.files.length));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.parseResults=function(t){var e,i;return this.files=t,this.loading=!1,this.moreResults=!(null==(e=t.payload)||null==(i=e.links)||!i.next),m.redraw(),t},e.addToList=function(t){var e;Array.isArray(t)?(e=this.files).unshift.apply(e,t):this.files.unshift(t),m.redraw()},e.removeFromList=function(t){Array.isArray(t)?this.files=this.files.filter((function(e){return!t.includes(e)})):this.files=this.files.filter((function(e){return e!==t})),m.redraw()},e.hasFiles=function(){return this.files.length>0},e.isLoading=function(){return this.loading},e.hasMoreResults=function(){return this.moreResults},e.empty=function(){return!this.hasFiles()&&!this.isLoading()},t}(),it=function(t){function i(){return t.apply(this,arguments)||this}p(i,t);var a=i.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.uploader=e.attrs.uploader,this.selectedFiles=[],this.multiSelect=void 0===e.attrs.multiSelect||e.attrs.multiSelect,this.restrictFileType=e.attrs.restrictFileType||null,this.dragDrop=null,this.selectedFilesLibrary=e.attrs.defaultFilesLibrary||"user",this.sharedUploads=null,this.userFileState=new et,this.sharedFileState=new et(!0),this.uploader.setState(this.userFileState),this.onUpload()},a.className=function(){return"Modal--large fof-file-manager-modal"},a.oncreate=function(e){var i=this;t.prototype.oncreate.call(this,e),this.dragDrop=new N((function(t){return i.uploader.upload(t,!1)}),this.$().find(".Modal-content")[0])},a.onremove=function(){this.dragDrop&&this.dragDrop.unload()},a.view=function(){var t,i=this,a=this.selectedFiles.length,o=this.attrs,r=o.hideUser,n=o.hideShared;return m("div",{className:"Modal modal-dialog "+this.className()},m("div",{className:"Modal-content"},m("div",{className:"fof-modal-buttons App-backControl"},!r&&"user"===this.selectedFilesLibrary&&m(L,{uploader:this.uploader,disabled:this.userFileState.isLoading(),isMediaUploadButton:!0}),e().session.user&&e().session.user.uploadSharedFiles()&&!n&&"shared"===this.selectedFilesLibrary&&m(b(),{className:"Button",icon:"fas fa-file-upload",onclick:function(){i.showUploadModal()}},e().translator.trans("fof-upload.forum.buttons.upload"))),m("div",{className:"fof-drag-and-drop"},m("div",{className:"fof-drag-and-drop-release"},m("i",{className:"fas fa-cloud-upload-alt"}),e().translator.trans("fof-upload.forum.lib.release_to_upload"))),m("div",{className:"Modal-header"},m("h3",{className:"App-titleControl App-titleControl--text"},e().translator.trans("fof-upload.forum.media_manager")),(null==(t=e().session.user)?void 0:t.accessSharedFiles())&&!r&&!n&&m("div",{className:"LibrarySelection"},this.fileLibraryButtonItems().toArray())),this.alertAttrs&&m("div",{className:"Modal-alert"},m(Alert,this.alertAttrs)),m("div",{className:"Modal-body"},"user"===this.selectedFilesLibrary&&this.userFilesContent(),"shared"===this.selectedFilesLibrary&&this.sharedFilesContent()),m("div",{className:"Modal-footer"},m(b(),{onclick:this.hide.bind(this),className:"Button"},e().translator.trans("fof-upload.forum.buttons.cancel")),m(b(),{onclick:this.onSelect.bind(this),disabled:0===this.selectedFiles.length||!this.multiSelect&&this.selectedFiles.length>1,className:"Button Button--primary"},e().translator.trans("fof-upload.lib.file_list.confirm_selection_btn",{fileCount:a})))))},a.fileLibraryButtonItems=function(){var t=this,i=new(H());return i.add("user",m(b(),{className:"Button Button--flat "+("user"===this.selectedFilesLibrary?"active":""),onclick:function(){return t.setLibrary("user")}},e().translator.trans("fof-upload.forum.buttons.media"))),i.add("shared",m(b(),{className:"Button Button--flat "+("shared"===this.selectedFilesLibrary?"active":""),onclick:function(){return t.setLibrary("shared")}},e().translator.trans("fof-upload.forum.buttons.shared_media"))),i},a.setLibrary=function(t){this.selectedFilesLibrary=t,m.redraw()},a.userFilesContent=function(){return m(K,{user:this.attrs.user,selectable:!0,onFileSelect:this.onFileSelect.bind(this),selectedFiles:this.selectedFiles,restrictFileType:this.restrictFileType,fileState:this.userFileState,onDelete:this.onDelete.bind(this)})},a.sharedFilesContent=function(){return m(tt,{selectable:!0,onFileSelect:this.onFileSelect.bind(this),selectedFiles:this.selectedFiles,restrictFileType:this.restrictFileType,user:this.attrs.user,fileState:this.sharedFileState,onDelete:this.onDelete.bind(this)})},a.onFileSelect=function(t){var e=this.selectedFiles.indexOf(t.id());e>=0?this.selectedFiles.splice(e,1):this.multiSelect?this.selectedFiles.push(t.id()):this.selectedFiles=[t.id()]},a.onUpload=function(){var t=this;this.uploader.on("success",(function(e){var i=e.file;t.multiSelect?t.selectedFiles.push(i.id()):t.selectedFiles=[i.id()]}))},a.onSelect=function(){this.hide(),this.attrs.onSelect?this.attrs.onSelect(this.selectedFiles):this.selectedFiles.map((function(t){var i=e().store.getById("files",t)||e().store.getById("shared-files",t);e().composer.editor.insertAtCursor(i.bbcode()+"\n",!1)}))},a.showUploadModal=function(){var t=this;e().modal.show(Z,{onUploadComplete:function(e){t.sharedFileState.addToList(e)}},!0)},a.onDelete=function(t){this.sharedFileState.removeFromList(t),this.userFileState.removeFromList(t)},i}(D()),at=function(t){function i(){return t.apply(this,arguments)||this}p(i,t);var a=i.prototype;return a.view=function(){return m(G(),{text:e().translator.trans("fof-upload.forum.buttons.media")},b().component({className:"Button fof-upload-button Button--icon",onclick:this.fileManagerButtonClicked.bind(this),icon:"fas fa-photo-video"}))},a.fileManagerButtonClicked=function(t){t.preventDefault(),e().modal.show(it,{uploader:this.attrs.uploader})},i}(g());const ot=flarum.core.compat["forum/components/UserPage"];var rt=i.n(ot);const nt=flarum.core.compat["common/components/LinkButton"];var st=i.n(nt);const lt=flarum.core.compat["common/extenders"];var ut=i.n(lt),ft=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var i=e.prototype;return i.baseName=function(){return s().attribute("baseName").call(this)},i.path=function(){return s().attribute("path").call(this)},i.url=function(){return s().attribute("url").call(this)},i.size=function(){return s().attribute("size").call(this)},i.type=function(){return s().attribute("type").call(this)},i.humanSize=function(){return s().attribute("humanSize").call(this)},i.createdAt=function(){return s().attribute("createdAt",s().transformDate).call(this)},i.uuid=function(){return s().attribute("uuid").call(this)},i.tag=function(){return s().attribute("tag").call(this)},i.hidden=function(){return s().attribute("hidden").call(this)},i.bbcode=function(){return s().attribute("bbcode").call(this)},i.isShared=function(){return s().attribute("shared").call(this)},i.isPrivateShared=function(){return s().attribute("isPrivateShared").call(this)},i.canViewInfo=function(){return s().attribute("canViewInfo").call(this)},i.canHide=function(){return s().attribute("canHide").call(this)},i.canDelete=function(){return s().attribute("canDelete").call(this)},i.apiEndpoint=function(){return"/fof/uploads"+(this.exists?"/"+this.id():"")},e}(s());const ct=[(new(ut().Store)).add("files",ft).add("shared-files",ft)];var dt=function(t){function i(){return t.apply(this,arguments)||this}p(i,t);var a=i.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.user=null,this.loadUser(m.route.param("username"))},a.content=function(){var t=new et;return e().session.user&&(e().session.user.viewOthersMediaLibrary()||this.user===e().session.user)?this.user&&K.component({user:this.user,selectable:!1,downloadOnClick:!0,fileState:t}):null},a.show=function(e){t.prototype.show.call(this,e),this.user=e},i}(rt());const ht=[].concat(ct,[(new(ut().Routes)).add("user.uploads","/u/:username/uploads",dt)]);function pt(){return pt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},pt.apply(this,arguments)}var mt=pt({},{UploadedFile:function(t){function e(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).file=void 0,e.callback=void 0,e.imageLoaded=!0,e.handleImageError=function(){e.imageLoaded=!1,m.redraw()},e.handleImageLoad=function(){e.imageLoaded=!0,m.redraw()},e}p(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.file=this.attrs.file},i.view=function(){var t=this,e=this.file.type().startsWith("image/"),i=A(this.file.type()),a=this.file.isPrivateShared()?"fas fa-lock":"fas fa-unlock";return m("div",{className:"UploadedFile",key:this.file.uuid()},m("div",{className:"UploadedFile--sharestatus"},m("span",null,j()(a),this.file.baseName())),m("div",{className:"UploadedFile--preview",onclick:function(){return t.onFileClick(t.file)}},e?this.imageLoaded?m("img",{className:this.attrs.fileClassNames,src:this.file.url(),loading:"lazy",onerror:this.handleImageError,onload:this.handleImageLoad,alt:this.file.baseName()}):j()("fas fa-exclamation-triangle",{className:"icon-fallback"}):j()(i,{className:"icon-fallback"})),m("div",{className:"UploadedFile--actions"},this.actionItems().toArray()))},i.actionItems=function(){var t=this,e=new(H());e.add("view-info",m(b(),{className:"Button Button--icon",icon:"fas fa-info-circle",onclick:function(){return t.viewFileInfo()},"aria-label":"info"})),e.add("download",m(b(),{className:"Button Button--icon",icon:"fas fa-download",onclick:function(){return window.open(t.file.url())},"aria-label":"download"}));var i=this.file.isPrivateShared()?"fas fa-lock":this.file.hidden()?"fas fa-eye":"fas fa-eye-slash";return e.add("hide-file",m(b(),{className:"Button Button--icon",icon:i,onclick:function(){return t.hideFile()},"aria-label":"hide"})),e.add("delete",m(b(),{className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.confirmDelete()},"aria-label":"delete"})),e},i.confirmDelete=function(){var t=M(T().mark((function t(){var e;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm("Are you sure you want to delete this file?")){t.next=6;break}return e=this.file.uuid(),t.next=5,U().request({method:"DELETE",url:U().forum.attribute("apiUrl")+"/fof/upload/delete/"+e});case 5:this.attrs.onDelete&&this.attrs.onDelete(this.file);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),i.viewFileInfo=function(){console.log("view file info")},i.hideFile=function(){console.log("hide file")},i.onFileClick=function(t){this.attrs.onFileSelect&&this.attrs.onFileSelect(t)},e}(g()),UploadSharedFileModal:Z,UserFileList:K},{DragAndDrop:N,FileManagerButton:at,FileManagerModal:it,Uploader:B,UploadButton:L});e().initializers.add("fof-upload",(function(){r().prototype.viewOthersMediaLibrary=s().attribute("fof-upload-viewOthersMediaLibrary"),r().prototype.deleteOthersMediaLibrary=s().attribute("fof-upload-deleteOthersMediaLibrary"),r().prototype.uploadCountCurrent=s().attribute("fof-upload-uploadCountCurrent"),r().prototype.uploadCountAll=s().attribute("fof-upload-uploadCountAll"),r().prototype.uploadSharedFiles=s().attribute("fof-upload-uploadSharedFiles"),r().prototype.accessSharedFiles=s().attribute("fof-upload-accessSharedFiles"),(0,l.extend)(d().prototype,"oninit",(function(){this.uploader=new B})),(0,l.extend)(d().prototype,"controlItems",(function(t){if(e().forum.attribute("fof-upload.canUpload")){var i=e().forum.attribute("fof-upload.composerButtonVisiblity");"both"!==i&&"media-btn"!==i||t.add("fof-upload-media",at.component({uploader:this.uploader})),"both"!==i&&"upload-btn"!==i||t.add("fof-upload",L.component({uploader:this.uploader}))}})),(0,l.extend)(d().prototype,"oncreate",(function(t,i){var a=this;if(e().forum.attribute("fof-upload.canUpload")){this.uploader.on("success",(function(t){var i=t.file;if(t.addBBcode&&(a.attrs.composer.editor.insertAtCursor(i.bbcode()+"\n",!1),"function"==typeof a.attrs.preview)){var o=e().composer.isFullScreen;e().composer.isFullScreen=function(){return!1},a.attrs.preview(),e().composer.isFullScreen=o}}));var o=this.fofUploadDragAndDropTarget();o&&(this.dragAndDrop=new N((function(t){return a.uploader.upload(t)}),o)),new k((function(t){return a.uploader.upload(t)}),this.$(".TextEditor-editor")[0])}})),(0,l.extend)(d().prototype,"onremove",(function(t,i){e().forum.attribute("fof-upload.canUpload")&&this.dragAndDrop&&this.dragAndDrop.unload()})),d().prototype.fofUploadDragAndDropTarget=function(){return this.$().parents(".Composer")[0]},(0,l.extend)(f().prototype,"oncreate",(function(){var t=this;this.$("[data-fof-upload-download-uuid]").unbind("click").on("click",(function(i){if(i.preventDefault(),i.stopPropagation(),e().forum.attribute("fof-upload.canDownload")){var a=e().forum.attribute("apiUrl")+"/fof/download";a+="/"+encodeURIComponent(i.currentTarget.dataset.fofUploadDownloadUuid),a+="/"+encodeURIComponent(t.attrs.post.id()),a+="/"+encodeURIComponent(e().session.csrfToken),window.open(a)}else alert(e().translator.trans("fof-upload.forum.states.unauthorized"))}))})),(0,l.extend)(rt().prototype,"navItems",(function(t){var i=!!e().forum.attribute("fof-upload.canUpload"),a=!!this.user.uploadCountCurrent();if(e().session.user&&(e().session.user.viewOthersMediaLibrary()||this.user===e().session.user&&(i||a))){var o=this.user.uploadCountCurrent();t.add("uploads",st().component({href:e().route("user.uploads",{username:this.user.username()}),name:"uploads",icon:"fas fa-file-upload"},[this.user===e().session.user?e().translator.trans("fof-upload.forum.buttons.media"):e().translator.trans("fof-upload.forum.buttons.user_uploads")," ",o>0?m("span",{className:"Button-badge"},o):""]),80)}}))}))})(),module.exports=a})();
//# sourceMappingURL=forum.js.map