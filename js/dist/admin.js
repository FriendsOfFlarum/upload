(()=>{var t={195:(t,e,a)=>{t.exports=a(236)},236:t=>{var e=function(t){"use strict";var e,a=Object.prototype,i=a.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.asyncIterator||"@@asyncIterator",l=n.toStringTag||"@@toStringTag";function s(t,e,a){return Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,a){return t[e]=a}}function u(t,e,a,i){var n=e&&e.prototype instanceof v?e:v,o=Object.create(n.prototype),r=new P(i||[]);return o._invoke=function(t,e,a){var i=d;return function(n,o){if(i===p)throw new Error("Generator is already running");if(i===m){if("throw"===n)throw o;return O()}for(a.method=n,a.arg=o;;){var r=a.delegate;if(r){var l=T(r,a);if(l){if(l===h)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(i===d)throw i=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);i=p;var s=f(t,e,a);if("normal"===s.type){if(i=a.done?m:c,s.arg===h)continue;return{value:s.arg,done:a.done}}"throw"===s.type&&(i=m,a.method="throw",a.arg=s.arg)}}}(t,a,r),o}function f(t,e,a){try{return{type:"normal",arg:t.call(e,a)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var d="suspendedStart",c="suspendedYield",p="executing",m="completed",h={};function v(){}function g(){}function y(){}var b={};s(b,o,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(M([])));x&&x!==a&&i.call(x,o)&&(b=x);var _=y.prototype=v.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function a(n,o,r,l){var s=f(t[n],t,o);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==typeof d&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){a("next",t,r,l)}),(function(t){a("throw",t,r,l)})):e.resolve(d).then((function(t){u.value=t,r(u)}),(function(t){return a("throw",t,r,l)}))}l(s.arg)}var n;this._invoke=function(t,i){function o(){return new e((function(e,n){a(t,i,e,n)}))}return n=n?n.then(o,o):o()}}function T(t,a){var i=t.iterator[a.method];if(i===e){if(a.delegate=null,"throw"===a.method){if(t.iterator.return&&(a.method="return",a.arg=e,T(t,a),"throw"===a.method))return h;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=f(i,t.iterator,a.arg);if("throw"===n.type)return a.method="throw",a.arg=n.arg,a.delegate=null,h;var o=n.arg;return o?o.done?(a[t.resultName]=o.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=e),a.delegate=null,h):o:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,h)}function F(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(F,this),this.reset(!0)}function M(t){if(t){var a=t[o];if(a)return a.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function a(){for(;++n<t.length;)if(i.call(t,n))return a.value=t[n],a.done=!1,a;return a.value=e,a.done=!0,a};return r.next=r}}return{next:O}}function O(){return{value:e,done:!0}}return g.prototype=y,s(_,"constructor",y),s(y,"constructor",g),g.displayName=s(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,s(t,l,"GeneratorFunction")),t.prototype=Object.create(_),t},t.awrap=function(t){return{__await:t}},k(S.prototype),s(S.prototype,r,(function(){return this})),t.AsyncIterator=S,t.async=function(e,a,i,n,o){void 0===o&&(o=Promise);var r=new S(u(e,a,i,n),o);return t.isGeneratorFunction(a)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},k(_),s(_,l,"Generator"),s(_,o,(function(){return this})),s(_,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var a in t)e.push(a);return e.reverse(),function a(){for(;e.length;){var i=e.pop();if(i in t)return a.value=i,a.done=!1,a}return a.done=!0,a}},t.values=M,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var a in this)"t"===a.charAt(0)&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var a=this;function n(i,n){return l.type="throw",l.arg=t,a.next=i,n&&(a.method="next",a.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],l=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var s=i.call(r,"catchLoc"),u=i.call(r,"finallyLoc");if(s&&u){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),N(a),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc===t){var i=a.completion;if("throw"===i.type){var n=i.arg;N(a)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,a,i){return this.delegate={iterator:M(t),resultName:a,nextLoc:i},"next"===this.method&&(this.arg=e),h}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}},e={};function a(i){var n=e[i];if(void 0!==n)return n.exports;var o=e[i]={exports:{}};return t[i](o,o.exports,a),o.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};(()=>{"use strict";a.r(i),a.d(i,{components:()=>rt,extend:()=>ht});const t=flarum.core.compat["admin/app"];var e=a.n(t);function n(t,e){return n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}const r=flarum.core.compat["common/components/Button"];var l=a.n(r);const s=flarum.core.compat["admin/utils/saveSettings"];var u=a.n(s);const f=flarum.core.compat["common/components/Alert"];var d=a.n(f);const c=flarum.core.compat["common/components/Select"];var p=a.n(c);const h=flarum.core.compat["common/components/Switch"];var v=a.n(h);const g=flarum.core.compat["admin/components/UploadImageButton"];var y=a.n(g);const b=flarum.core.compat["common/utils/withAttr"];var w=a.n(b);const x=flarum.core.compat["common/utils/Stream"];var _=a.n(x);const k=flarum.core.compat["admin/components/ExtensionPage"];var S=a.n(k);const T=flarum.core.compat["common/utils/ItemList"];var F=a.n(T);const N=flarum.core.compat["common/components/Modal"];var P=a.n(N);const M=flarum.core.compat["common/components/LoadingIndicator"];var O=a.n(M),L=function(t){function a(){return t.apply(this,arguments)||this}o(a,t);var i=a.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.uploading=!1,this.inspection={}},i.className=function(){return"Modal--small fof-upload-inspect-mime-modal"},i.title=function(){return e().translator.trans("fof-upload.admin.inspect-mime.title")},i.content=function(){return m("div",{className:"Modal-body"},m("p",null,e().translator.trans("fof-upload.admin.inspect-mime.description",{a:m("a",{href:"https://github.com/SoftCreatR/php-mime-detector"})})),m("p",null,e().translator.trans("fof-upload.admin.inspect-mime.select")),m("div",null,m("input",{type:"file",onchange:this.onupload.bind(this),disabled:this.uploading}),this.uploading?O().component():null),m("dl",null,m("dt",null,e().translator.trans("fof-upload.admin.inspect-mime.laravel-validation")),m("dd",null,void 0===this.inspection.laravel_validation?m("em",null,e().translator.trans("fof-upload.admin.inspect-mime.no-file-selected")):this.inspection.laravel_validation?e().translator.trans("fof-upload.admin.inspect-mime.validation-passed"):e().translator.trans("fof-upload.admin.inspect-mime.validation-failed",{error:this.inspection.laravel_validation_error||"?"}))),m("dl",null,m("dt",null,e().translator.trans("fof-upload.admin.inspect-mime.mime-detector")),m("dd",null,this.inspection.mime_detector?m("code",null,this.inspection.mime_detector):m("em",null,e().translator.trans("fof-upload.admin.inspect-mime.not-available")))),m("dl",null,m("dt",null,e().translator.trans("fof-upload.admin.inspect-mime.mime-fileinfo")),m("dd",null,this.inspection.php_mime?m("code",null,this.inspection.php_mime):m("em",null,e().translator.trans("fof-upload.admin.inspect-mime.not-available")))),m("dl",null,m("dt",null,e().translator.trans("fof-upload.admin.inspect-mime.guessed-extension")),m("dd",null,this.inspection.guessed_extension?m("code",null,this.inspection.guessed_extension):m("em",null,e().translator.trans("fof-upload.admin.inspect-mime.not-available")))))},i.onupload=function(t){for(var a=this,i=new FormData,n=0;n<t.target.files.length;n++)i.append("files[]",t.target.files[n]);return this.uploading=!0,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/fof/upload/inspect-mime",serialize:function(t){return t},body:i}).then((function(t){a.uploading=!1,a.inspection=t,m.redraw()})).catch((function(t){throw a.uploading=!1,a.inspection={},m.redraw(),t}))},a}(P());const U=flarum.core.compat["common/helpers/icon"];var B=a.n(U);const E=flarum.core.compat["common/components/Link"];var C=a.n(E),j=function(t){function a(){return t.apply(this,arguments)||this}o(a,t);var i=a.prototype;return i.oninit=function(a){var i=this;t.prototype.oninit.call(this,a),this.loading=!1,this.fields=["resizeMaxWidth","cdnUrl","maxFileSize","whitelistedClientExtensions","composerButtonVisiblity","watermark","watermarkPosition","imgurClientId","awsS3Key","awsS3Secret","awsS3Bucket","awsS3Region","awsS3Endpoint","awsS3ACL","qiniuKey","qiniuSecret","qiniuBucket"],this.checkboxes=["mustResize","addsWatermarks","disableHotlinkProtection","disableDownloadLogging","awsS3UsePathStyleEndpoint"],this.objects=["mimeTypes"],this.watermarkPositions={"top-left":"top-left","top-right":"top-right","bottom-left":"bottom-left","bottom-right":"bottom-right",center:"center",left:"left",top:"top",right:"right",bottom:"bottom"},this.composerButtonVisiblityOptions={both:e().translator.trans("fof-upload.admin.labels.composer_buttons.options.both"),"upload-btn":e().translator.trans("fof-upload.admin.labels.composer_buttons.options.upload-btn"),"media-btn":e().translator.trans("fof-upload.admin.labels.composer_buttons.options.media-btn")};var n=e().data.settings;this.settingsPrefix="fof-upload",this.uploadMethodOptions=n[this.addPrefix("availableUploadMethods")]||{},this.templateOptions=n[this.addPrefix("availableTemplates")]||{},this.values={},this.fields.forEach((function(t){return i.values[t]=_()(n[i.addPrefix(t)])})),this.checkboxes.forEach((function(t){return i.values[t]=_()("1"===n[i.addPrefix(t)])})),this.objects.forEach((function(t){return i.values[t]=n[i.addPrefix(t)]?_()(JSON.parse(n[i.addPrefix(t)])):_()()})),this.defaultAdap=Object.keys(this.uploadMethodOptions)[Object.keys(this.uploadMethodOptions).length-1],this.values.mimeTypes()||(this.values.mimeTypes=_()({"^image\\/.*":{adapter:this.defaultAdap,template:"image-preview"}})),this.newMimeType={regex:_()(""),adapter:_()(this.defaultAdap),template:_()("file")}},i.content=function(){var t=this,a=e().data.settings[this.addPrefix("php_ini.post_max_size")],i=e().data.settings[this.addPrefix("php_ini.upload_max_filesize")];return[m(".UploadPage",[m(".container",[m("form",{onsubmit:this.onsubmit.bind(this)},[m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.preferences.title")),m("label",e().translator.trans("fof-upload.admin.labels.preferences.max_file_size")),m("input.FormControl",{value:this.values.maxFileSize(),oninput:w()("value",this.values.maxFileSize),type:"number",min:"0"}),m(".helpText",e().translator.trans("fof-upload.admin.labels.preferences.php_ini_values",{post:a,upload:i})),m("label",e().translator.trans("fof-upload.admin.labels.preferences.mime_types")),m(".MimeTypes--Container",Object.keys(this.values.mimeTypes()).map((function(e){var a=t.values.mimeTypes()[e];return"object"!=typeof a&&(a={adapter:a,template:"file"}),m("div",[m("input.FormControl.MimeTypes",{value:e,oninput:w()("value",t.updateMimeTypeKey.bind(t,e))}),p().component({options:t.uploadMethodOptions,onchange:t.updateMimeTypeAdapter.bind(t,e,a),value:a.adapter||"local"}),p().component({options:t.getTemplateOptionsForInput(),onchange:t.updateMimeTypeTemplate.bind(t,e,a),value:a.template||"local"}),l().component({type:"button",className:"Button Button--warning",onclick:t.deleteMimeType.bind(t,e)},"x")])})),m("br"),m("div",[m("input.FormControl.MimeTypes.add-MimeType-key",{value:this.newMimeType.regex(),oninput:w()("value",this.newMimeType.regex)}),p().component({options:this.uploadMethodOptions,className:"add-MimeType-value",oninput:w()("value",this.newMimeType.adapter),value:this.newMimeType.adapter()}),p().component({options:this.getTemplateOptionsForInput(),className:"add-MimeType-value",oninput:w()("value",this.newMimeType.template),value:this.newMimeType.template()}),l().component({type:"button",className:"Button Button--warning",onclick:this.addMimeType.bind(this)},"+")])),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.mime_types")),l().component({className:"Button",onclick:function(){e().modal.show(L)}},e().translator.trans("fof-upload.admin.labels.inspect-mime")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.download_templates")),this.templateOptionsDescriptions()]),m("fieldset.composerButtons",[m("legend",e().translator.trans("fof-upload.admin.labels.composer_buttons.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.composer_buttons")),m("div",[p().component({options:this.composerButtonVisiblityOptions,onchange:this.values.composerButtonVisiblity,value:this.values.composerButtonVisiblity()||"both"})])]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.resize.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.resize")),v().component({state:this.values.mustResize()||!1,onchange:this.values.mustResize},e().translator.trans("fof-upload.admin.labels.resize.toggle")),m("label",e().translator.trans("fof-upload.admin.labels.resize.max_width")),m("input",{className:"FormControl",value:this.values.resizeMaxWidth()||100,oninput:w()("value",this.values.resizeMaxWidth),disabled:!this.values.mustResize(),type:"number",min:"0"})]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.client_extension.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.client_extension")),m("input",{className:"FormControl",value:this.values.whitelistedClientExtensions()||"",oninput:w()("value",this.values.whitelistedClientExtensions)})]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.watermark.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.watermark")),v().component({state:this.values.addsWatermarks()||!1,onchange:this.values.addsWatermarks},e().translator.trans("fof-upload.admin.labels.watermark.toggle")),m("label",e().translator.trans("fof-upload.admin.labels.watermark.position")),m("div",[p().component({options:this.watermarkPositions,onchange:this.values.watermarkPosition,value:this.values.watermarkPosition()||"bottom-right"})]),m("label",{},e().translator.trans("fof-upload.admin.labels.watermark.file")),y().component({name:"fof/watermark"})]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.disable-hotlink-protection.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.disable-hotlink-protection")),v().component({state:this.values.disableHotlinkProtection()||!1,onchange:this.values.disableHotlinkProtection},e().translator.trans("fof-upload.admin.labels.disable-hotlink-protection.toggle")),m("legend",e().translator.trans("fof-upload.admin.labels.disable-download-logging.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.disable-download-logging")),v().component({state:this.values.disableDownloadLogging()||!1,onchange:this.values.disableDownloadLogging},e().translator.trans("fof-upload.admin.labels.disable-download-logging.toggle"))]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.local.title")),m("label",e().translator.trans("fof-upload.admin.labels.local.cdn_url")),m("input.FormControl",{value:this.values.cdnUrl()||"",oninput:w()("value",this.values.cdnUrl)})]),this.adaptorItems().toArray(),l().component({type:"submit",className:"Button Button--primary",loading:this.loading,disabled:!this.changed()},e().translator.trans("core.admin.settings.submit_button"))])])])]},i.adaptorItems=function(){var t=new(F());return void 0!==this.uploadMethodOptions.imgur&&t.add("imgur",m("div",{className:"imgur"},m("fieldset",null,m("legend",null,e().translator.trans("fof-upload.admin.labels.imgur.title")),m("p",null,B()("fas fa-exclamation-circle")," ",e().translator.trans("fof-upload.admin.labels.imgur.tos",{a:m(C(),{href:"https://imgur.com/tos",external:!0,target:"_blank"})})),m("label",null,e().translator.trans("fof-upload.admin.labels.imgur.client_id")),m("input",{className:"FormControl",value:this.values.imgurClientId()||"",oninput:w()("value",this.values.imgurClientId)}))),100),void 0!==this.uploadMethodOptions.qiniu&&t.add("qiniu",m(".qiniu",[m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.qiniu.title")),m("label",e().translator.trans("fof-upload.admin.labels.qiniu.key")),m("input.FormControl",{value:this.values.qiniuKey()||"",oninput:w()("value",this.values.qiniuKey)}),m("label",{},e().translator.trans("fof-upload.admin.labels.qiniu.secret")),m("input.FormControl",{value:this.values.qiniuSecret()||"",oninput:w()("value",this.values.qiniuSecret)}),m("label",{},e().translator.trans("fof-upload.admin.labels.qiniu.bucket")),m("input.FormControl",{value:this.values.qiniuBucket()||"",oninput:w()("value",this.values.qiniuBucket)})])]),80),void 0!==this.uploadMethodOptions["aws-s3"]&&t.add("aws-s3",m(".aws",[m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.aws-s3.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.s3_instance_profile")),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.key")),m("input.FormControl",{value:this.values.awsS3Key()||"",oninput:w()("value",this.values.awsS3Key)}),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.secret")),m("input.FormControl",{value:this.values.awsS3Secret()||"",oninput:w()("value",this.values.awsS3Secret)}),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.bucket")),m("input.FormControl",{value:this.values.awsS3Bucket()||"",oninput:w()("value",this.values.awsS3Bucket)}),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.region")),m("input.FormControl",{value:this.values.awsS3Region()||"",oninput:w()("value",this.values.awsS3Region)})]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.aws-s3.advanced_title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.s3_compatible_storage")),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.endpoint")),m("input.FormControl",{value:this.values.awsS3Endpoint()||"",oninput:w()("value",this.values.awsS3Endpoint)}),v().component({state:this.values.awsS3UsePathStyleEndpoint()||!1,onchange:this.values.awsS3UsePathStyleEndpoint},e().translator.trans("fof-upload.admin.labels.aws-s3.use_path_style_endpoint")),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.acl")),m("input.FormControl",{value:this.values.awsS3ACL()||"",oninput:w()("value",this.values.awsS3ACL)}),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.s3_acl"))])]),60),t},i.getTemplateOptionsForInput=function(){var t={};for(var e in this.templateOptions)this.templateOptions.hasOwnProperty(e)&&(t[e]=this.templateOptions[e].name);return t},i.updateMimeTypeKey=function(t,e){this.values.mimeTypes()[e]=this.values.mimeTypes()[t],this.deleteMimeType(t)},i.updateMimeTypeAdapter=function(t,e,a){e.adapter=a,this.values.mimeTypes()[t]=e},i.updateMimeTypeTemplate=function(t,e,a){e.template=a,this.values.mimeTypes()[t]=e},i.deleteMimeType=function(t){delete this.values.mimeTypes()[t]},i.templateOptionsDescriptions=function(){var t=[];for(var e in this.templateOptions)this.templateOptions.hasOwnProperty(e)&&t.push(m("li",null,this.templateOptions[e].name,": ",m.trust(this.templateOptions[e].description)));return m("ul",t)},i.addMimeType=function(){this.values.mimeTypes()[this.newMimeType.regex()]={adapter:this.newMimeType.adapter(),template:this.newMimeType.template()},this.newMimeType.regex(""),this.newMimeType.adapter("local"),this.newMimeType.template("file")},i.changed=function(){var t=this,a=this.fields.some((function(a){return t.values[a]()!==e().data.settings[t.addPrefix(a)]})),i=this.checkboxes.some((function(a){return t.values[a]()!==("1"===e().data.settings[t.addPrefix(a)])})),n=this.objects.some((function(a){return JSON.stringify(t.values[a]())!==e().data.settings[t.addPrefix(a)]}));return a||i||n},i.onsubmit=function(t){var a=this;if(t.preventDefault(),!this.loading){this.loading=!0,e().alerts.dismiss(this.successAlert);var i={};this.fields.forEach((function(t){return i[a.addPrefix(t)]=a.values[t]()})),this.checkboxes.forEach((function(t){return i[a.addPrefix(t)]=a.values[t]()})),this.objects.forEach((function(t){return i[a.addPrefix(t)]=JSON.stringify(a.values[t]())})),u()(i).then((function(){a.successAlert=e().alerts.show(d(),{type:"success"},e().translator.trans("core.admin.settings.saved_message"))})).catch((function(){})).then((function(){a.loading=!1,m.redraw()}))}},i.addPrefix=function(t){return this.settingsPrefix+"."+t},a}(S());const A=flarum.core.compat["common/extend"],z=flarum.core.compat["admin/components/AdminNav"];var I=a.n(z);const R=flarum.core.compat["common/components/LinkButton"];var q=a.n(R);const D=flarum.core.compat["common/app"];var H=a.n(D),W=function(){function t(){this.user=null,this.files=[],this.moreResults=!1,this.loading=!1}var e=t.prototype;return e.setUser=function(t){t!==this.user&&(this.user=t,this.files=[],this.loadResults())},e.loadResults=function(t){if(void 0===t&&(t=0),this.user)return this.loading=!0,H().store.find("fof/uploads",{filter:{user:this.user.id()},page:{offset:t}}).then(this.parseResults.bind(this))},e.loadMore=function(){this.loading=!0,this.loadResults(this.files.length).then(this.parseResults.bind(this))},e.parseResults=function(t){var e;return(e=this.files).push.apply(e,t),this.loading=!1,this.moreResults=!!t.payload.links&&!!t.payload.links.next,m.redraw(),t},e.addToList=function(t){var e;Array.isArray(t)?(e=this.files).unshift.apply(e,t):this.files.unshift(t)},e.hasFiles=function(){return this.files.length>0},e.isLoading=function(){return this.loading},e.hasMoreResults=function(){return this.moreResults},e.empty=function(){return!this.hasFiles()&&!this.isLoading()},t}();function G(){return G=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},G.apply(this,arguments)}var K=new Map([["image/png","far fa-file-image"],["image/jpg","far fa-file-image"],["image/jpeg","far fa-file-image"],["image/svg+xml","far fa-file-image"],["image/gif","far fa-file-image"],["image/bmp","far fa-file-image"],["image/webp","far fa-file-image"],["application/zip","far fa-file-archive"],["application/x-7z-compressed","far fa-file-archive"],["application/gzip","far fa-file-archive"],["application/vnd.rar","far fa-file-archive"],["application/x-rar-compressed","far fa-file-archive"],["application/x-tar","far fa-file-archive"],["application/x-iso9660-image","far fa-file-archive"],["text/plain","far fa-file-alt"],["text/csv","far fa-file-csv"],["text/xml","far fa-file-code"],["text/html","far fa-file-code"],["text/css","far fa-file-code"],["text/javascript","far fa-file-code"],["application/json","far fa-file-code"],["application/ld+json","far fa-file-code"],["application/x-httpd-php","far fa-file-code"],["application/xml","far fa-file-code"],["text/xml","far fa-file-code"],["application/x-abiword","far fa-file-word"],["application/msword","far fa-file-word"],["application/vnd.openxmlformats-officedocument.wordprocessingml.document","far fa-file-word"],["application/vnd.oasis.opendocument.text","far fa-file-word"],["application/vnd.ms-excel","far fa-file-excel"],["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","far fa-file-excel"],["application/vnd.oasis.opendocument.spreadsheet","far fa-file-excel"],["application/vnd.ms-powerpoint","far fa-file-powerpoint"],["application/vnd.openxmlformats-officedocument.presentationml.presentation","far fa-file-powerpoint"],["application/vnd.oasis.opendocument.presentation","far fa-file-powerpoint"],["application/pdf","far fa-file-pdf"],["application/rtf","far fa-file-alt"],["application/epub+zip","far fa-book"],["application/x-mobipocket-ebook","far fa-book"],["application/vnd.amazon.ebook","far fa-book"],["audio/mpeg","far fa-file-audio"],["audio/wav","far fa-file-audio"],["audio/x-wav","far fa-file-audio"],["audio/aac","far fa-file-audio"],["audio/ogg","far fa-file-audio"],["audio/flac","far fa-file-audio"],["audio/aiff","far fa-file-audio"],["audio/x-aiff","far fa-file-audio"],["video/x-msvideo","far fa-file-video"],["video/mp4","far fa-file-video"],["video/quicktime","far fa-file-video"]]);function V(t){return K.get(t)||(t.startsWith("image/")?"far fa-file-image":t.startsWith("video/")?"far fa-file-video":t.startsWith("audio/")?"far fa-file-audio":"far fa-file")}var J=function(t){function e(){for(var e,a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return(e=t.call.apply(t,[this].concat(i))||this).files=[],e.fileInput=null,e.options={shared:!0,hidden:!1},e.onUploadComplete=void 0,e}o(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.onUploadComplete=this.attrs.onUploadComplete},a.className=function(){return"UploadSharedFileModal Modal--medium"},a.title=function(){return H().translator.trans("fof-upload.lib.upload-shared-file-modal.title")},a.onFileChange=function(t){this.addFiles(Array.from(t.target.files))},a.addFiles=function(t){var e;(e=this.files).push.apply(e,t),m.redraw()},a.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"UploadSharedFileModal-files"},m("input",{type:"file",multiple:!0,onchange:this.onFileChange.bind(this)}),this.files.map((function(t){var e=t.type.startsWith("image/");return m("div",{className:"UploadedFile"},e?m("img",{src:URL.createObjectURL(t),alt:t.name}):m("i",{className:V(t.type)}),m("div",null,t.name))}))),m("div",{className:"UploadSharedFileModal-options Form-group"},m(v(),{state:this.options.hidden,onchange:function(e){return t.options.hidden=e}},H().translator.trans("fof-upload.lib.upload-shared-file-modal.hide-from-media-gallery"))),m("div",{className:"UploadSharedFileModal-submit App-primaryControl"},m(l(),{className:"Button Button--primary",onclick:this.upload.bind(this),disabled:!this.files.length},H().translator.trans("fof-upload.lib.upload-shared-file-modal.upload"))))},a.upload=function(){var t=this,e=new FormData;this.files.forEach((function(t){e.append("files[]",t)})),Object.keys(this.options).forEach((function(a){e.append("options["+a+"]",t.options[a])})),H().request({method:"POST",url:H().forum.attribute("apiUrl")+"/fof/upload",serialize:function(t){return t},body:e}).then((function(){t.files=[],t.hide(),t.onUploadComplete()})).catch((function(t){console.error(t)}))},e}(P());function Y(t,e,a,i,n,o,r){try{var l=t[o](r),s=l.value}catch(t){return void a(t)}l.done?e(s):Promise.resolve(s).then(i,n)}var Q=a(195),X=a.n(Q);const Z=flarum.core.compat["common/Component"];var $=a.n(Z),tt=function(t){function a(){for(var e,a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return(e=t.call.apply(t,[this].concat(i))||this).file=void 0,e.callback=void 0,e.imageLoaded=!0,e.handleImageError=function(){e.imageLoaded=!1,m.redraw()},e.handleImageLoad=function(){e.imageLoaded=!0,m.redraw()},e}o(a,t);var i=a.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.file=this.attrs.file,this.callback=this.attrs.callback},i.view=function(){var t=this,e=this.file.type().startsWith("image/"),a=V(this.file.type()),i=this.file.isPrivateShared()?"fas fa-lock":"fas fa-unlock";return m("div",{className:"UploadedFile",key:this.file.uuid()},m("div",{className:"UploadedFile--sharestatus"},m("span",null,B()(i),this.file.baseName())),m("div",{className:"UploadedFile--preview",onclick:function(){return t.onFileClick(t.file)}},e?this.imageLoaded?m("img",{src:this.file.url(),loading:"lazy",onerror:this.handleImageError,onload:this.handleImageLoad}):B()("fas fa-exclamation-triangle",{className:"icon-fallback"}):B()(a,{className:"icon-fallback"})),m("div",{className:"UploadedFile--actions"},this.actionItems().toArray()))},i.actionItems=function(){var t=this,e=new(F());e.add("view-info",m(l(),{className:"Button Button--icon",icon:"fas fa-info-circle",onclick:function(){return t.viewFileInfo()},"aria-label":"info"})),e.add("download",m(l(),{className:"Button Button--icon",icon:"fas fa-download",onclick:function(){return window.open(t.file.url())},"aria-label":"download"}));var a=this.file.isPrivateShared()?"fas fa-lock":this.file.hidden()?"fas fa-eye":"fas fa-eye-slash";return e.add("hide-file",m(l(),{className:"Button Button--icon",icon:a,onclick:function(){return t.hideFile()},"aria-label":"hide"})),e.add("delete",m(l(),{className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.confirmDelete()},"aria-label":"delete"})),e},i.confirmDelete=function(){var t,a=(t=X().mark((function t(){var a;return X().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm("Are you sure you want to delete this file?")){t.next=6;break}return a=this.file.uuid(),t.next=5,e().request({method:"DELETE",url:e().forum.attribute("apiUrl")+"/fof/upload/delete/"+a});case 5:this.callback&&this.callback();case 6:case"end":return t.stop()}}),t,this)})),function(){var e=this,a=arguments;return new Promise((function(i,n){var o=t.apply(e,a);function r(t){Y(o,i,n,r,l,"next",t)}function l(t){Y(o,i,n,r,l,"throw",t)}r(void 0)}))});return function(){return a.apply(this,arguments)}}(),i.viewFileInfo=function(){console.log("view file info")},i.hideFile=function(){console.log("hide file")},i.onFileClick=function(t){this.attrs.onFileSelect&&this.attrs.onFileSelect(t)},a}($());const et=flarum.core.compat["common/utils/classList"];var at=a.n(et);const it=flarum.core.compat["common/utils/extractText"];var nt=a.n(it),ot=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),H().fileListState.setUser(e.attrs.user||H().session.user),this.inModal=e.attrs.selectable,this.restrictFileType=e.attrs.restrictFileType||null,this.downloadOnClick=this.attrs.downloadOnClick||!1,this.filesBeingHidden=[],this.user=H().fileListState.user},a.view=function(){var t=this,e=H().fileListState;return m("div",{className:"fof-upload-file-list","aria-live":"polite"},e.isLoading()&&0===e.files.length&&m("div",{className:"fof-upload-loading"},H().translator.trans("fof-upload.forum.file_list.loading"),m(O(),null)),this.inModal&&e.empty()&&m("p",{className:"fof-upload-empty"},m("i",{className:"fas fa-cloud-upload-alt fof-upload-empty-icon"}),H().translator.trans("fof-upload.forum.file_list.modal_empty_"+("phone"!==H().screen()?"desktop":"phone"))),!this.inModal&&e.empty()&&m("div",{className:"Placeholder"},m("p",{className:"fof-upload-empty"},H().translator.trans("fof-upload.forum.file_list.empty"))),m("ul",null,e.files.map((function(e){var a=V(e.type()),i=!t.restrictFileType||t.isSelectable(e),n=at()(["fof-file","far fa-file-image"===a&&"fof-file-type-image",t.attrs.selectedFiles&&t.attrs.selectedFiles.indexOf(e.id())>=0&&"fof-file-selected"]),o=e.baseName(),r=t.filesBeingHidden.includes(e.uuid());return m("li",{"aria-busy":r},H().session.user&&(t.user===H().session.user||H().session.user.deleteOthersMediaLibrary())&&m(l(),{className:"Button Button--icon fof-file-delete",icon:"far fa-trash-alt","aria-label":H().translator.trans("fof-upload.forum.file_list.delete_file_a11y_label",{fileName:o}),disabled:r,onclick:t.hideFile.bind(t,e)}),m("button",{className:n,onclick:function(){return t.onFileClick(e)},disabled:!i||r,"aria-label":nt()(H().translator.trans("fof-upload.forum.file_list.select_file_a11y_label",{fileName:o}))},m("figure",null,"far fa-file-image"===a?m("img",{src:e.url(),className:"fof-file-image-preview",draggable:!1,alt:""}):m("span",{className:"fof-file-icon",role:"presentation"},B()("fa-fw "+a)),m("figcaption",{className:"fof-file-name"},o),r&&m("span",{class:"fof-file-loading",role:"status","aria-label":H().translator.trans("fof-upload.forum.file_list.hide_file.loading")},m(O(),null)))))}))),e.hasMoreResults()&&m("div",{className:"fof-load-more-files"},m(l(),{className:"Button Button--primary",disabled:e.isLoading(),loading:e.isLoading(),onclick:function(){return e.loadMore()}},H().translator.trans("fof-upload.forum.file_list.load_more_files_btn"))))},a.onFileClick=function(t){this.attrs.onFileSelect?this.attrs.onFileSelect(t):this.attrs.downloadOnClick&&window.open(t.url())},a.isSelectable=function(t){var e=t.type();return Array.isArray(this.restrictFileType)?this.restrictFileType.indexOf(e)>=0:"image"===this.restrictFileType?e.includes("image/"):"audio"===this.restrictFileType?e.includes("audio/"):"video"===this.restrictFileType&&e.includes("video/")},a.hideFile=function(t){var e=this,a=t.uuid();if(!this.filesBeingHidden.includes(a))if(this.filesBeingHidden.push(a),confirm(nt()(H().translator.trans("fof-upload.forum.file_list.hide_file.hide_confirmation",{fileName:t.baseName()}))))H().request({method:"PATCH",url:H().forum.attribute("apiUrl")+"/fof/upload/hide",body:{uuid:a}}).then((function(){H().alerts.show(d(),{type:"success"},H().translator.trans("fof-upload.forum.file_list.hide_file.hide_success"))})).catch((function(){H().alerts.show(d(),{type:"error"},H().translator.trans("fof-upload.forum.file_list.hide_file.hide_fail",{fileName:t.fileName()}))})).then((function(){var t=H().fileListState,i=t.files.findIndex((function(t){return a===t.uuid()}));t.files.splice(i,1);var n=e.filesBeingHidden.indexOf(a);e.filesBeingHidden.splice(n,1)}));else{var i=this.filesBeingHidden.indexOf(a);this.filesBeingHidden.splice(i,1)}},e}($()),rt=G({},{UploadedFile:tt,UploadSharedFileModal:J,UserFileList:ot},{UploadPage:j});const lt=flarum.core.compat["common/extenders"];var st=a.n(lt);const ut=flarum.core.compat["common/Model"];var ft=a.n(ut),dt=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var a=e.prototype;return a.baseName=function(){return ft().attribute("baseName").call(this)},a.path=function(){return ft().attribute("path").call(this)},a.url=function(){return ft().attribute("url").call(this)},a.size=function(){return ft().attribute("size").call(this)},a.type=function(){return ft().attribute("type").call(this)},a.humanSize=function(){return ft().attribute("humanSize").call(this)},a.createdAt=function(){return ft().attribute("createdAt",ft().transformDate).call(this)},a.uuid=function(){return ft().attribute("uuid").call(this)},a.tag=function(){return ft().attribute("tag").call(this)},a.hidden=function(){return ft().attribute("hidden").call(this)},a.bbcode=function(){return ft().attribute("bbcode").call(this)},a.isShared=function(){return ft().attribute("shared").call(this)},a.isPrivateShared=function(){return ft().attribute("isPrivateShared").call(this)},a.apiEndpoint=function(){return"/fof/uploads"+(this.exists?"/"+this.id():"")},e}(ft());const ct=[(new(st().Store)).add("files",dt).add("shared-files",dt)],pt=flarum.core.compat["admin/components/AdminPage"];var mt=function(t){function a(){for(var e,a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return(e=t.call.apply(t,[this].concat(i))||this).sharedUploads=[],e.currentPage=1,e}o(a,t);var i=a.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.loadSharedUploads()},i.headerInfo=function(){return{className:"SharedUploadPage--header",icon:"fas fa-file-upload",title:e().translator.trans("fof-upload.admin.shared-uploads.title"),description:e().translator.trans("fof-upload.admin.shared-uploads.description")}},i.loadSharedUploads=function(t){var a=this;void 0===t&&(t=1),this.loading=!0,e().store.find("fof/upload/shared-files").then((function(t){a.sharedUploads=t})).catch((function(){})).then((function(){a.loading=!1,m.redraw()}))},i.content=function(){var t=this;return m("div",{className:"SharedUploadPage--content"},m("p",{className:"helpText"},e().translator.trans("fof-upload.admin.shared-uploads.introduction")),m("hr",null),m("div",{className:"SharedUploadPage--main-actions"},this.mainActionItems().toArray()),m("hr",null),m("div",{className:"SharedUploadPage--uploads"},this.loading&&m(O(),null),!this.loading&&0===this.sharedUploads.length&&m("p",null,e().translator.trans("fof-upload.admin.shared-uploads.no-files")),!this.loading&&this.sharedUploads.map((function(e){return m(tt,{file:e,callback:function(){return t.callback()}})}))))},i.showUploadModal=function(){var t=this;e().modal.show(J,{onUploadComplete:function(){t.loadSharedUploads(t.currentPage),m.redraw()}})},i.mainActionItems=function(){var t=this,a=new(F());return a.add("refresh",m(l(),{className:"Button Button--icon",icon:"fas fa-sync",onclick:function(){return t.loadSharedUploads(t.currentPage)}})),a.add("upload-new",m(l(),{className:"Button",icon:"fas fa-upload",onclick:function(){return t.showUploadModal()}},e().translator.trans("fof-upload.admin.shared-uploads.upload-new-button"))),a},i.fileActionItems=function(t){return new(F())},i.callback=function(){this.loadSharedUploads(this.currentPage),m.redraw()},a}(a.n(pt)());const ht=[].concat(ct,[(new(st().Routes)).add("adminUploads","/uploads",mt)]);e().initializers.add("fof-upload",(function(){e().extensionData.for("fof-upload").registerPage(j).registerPermission({icon:"far fa-file",label:e().translator.trans("fof-upload.admin.permissions.upload_label"),permission:"fof-upload.upload"},"start",50).registerPermission({icon:"fas fa-download",label:e().translator.trans("fof-upload.admin.permissions.download_label"),permission:"fof-upload.download",allowGuest:!0},"view",50).registerPermission({icon:"fas fa-eye",label:e().translator.trans("fof-upload.admin.permissions.view_user_uploads_label"),permission:"fof-upload.viewUserUploads"},"moderate",50).registerPermission({icon:"fas fa-trash",label:e().translator.trans("fof-upload.admin.permissions.delete_uploads_of_others_label"),permission:"fof-upload.deleteUserUploads"},"moderate",50).registerPermission({icon:"far fa-file-alt",label:e().translator.trans("fof-upload.admin.permissions.upload_shared_label"),permission:"fof-upload.upload-shared-files"},"start"),(0,A.extend)(I().prototype,"items",(function(t){t.add("shared-uploads",m(q(),{href:e().route("adminUploads"),icon:"fas fa-file-upload",title:e().translator.trans("fof-upload.admin.shared-uploads.title")},e().translator.trans("fof-upload.admin.nav.shared-uploads-button")),49)})),e().fileListState=new W}))})(),module.exports=i})();
//# sourceMappingURL=admin.js.map