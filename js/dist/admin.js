/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={24:(t,e,i)=>{var a=i(735).default;function n(){"use strict";t.exports=n=function(){return i},t.exports.__esModule=!0,t.exports.default=t.exports;var e,i={},o=Object.prototype,r=o.hasOwnProperty,s=Object.defineProperty||function(t,e,i){t[e]=i.value},l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",f=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function c(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(e){c=function(t,e,i){return t[e]=i}}function p(t,e,i,a){var n=e&&e.prototype instanceof w?e:w,o=Object.create(n.prototype),r=new U(a||[]);return s(o,"_invoke",{value:P(t,i,r)}),o}function m(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}i.wrap=p;var h="suspendedStart",v="suspendedYield",g="executing",b="completed",y={};function w(){}function x(){}function _(){}var S={};c(S,u,(function(){return this}));var k=Object.getPrototypeOf,F=k&&k(k(B([])));F&&F!==o&&r.call(F,u)&&(S=F);var T=_.prototype=w.prototype=Object.create(S);function N(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function i(n,o,s,l){var u=m(t[n],t,o);if("throw"!==u.type){var f=u.arg,d=f.value;return d&&"object"==a(d)&&r.call(d,"__await")?e.resolve(d.__await).then((function(t){i("next",t,s,l)}),(function(t){i("throw",t,s,l)})):e.resolve(d).then((function(t){f.value=t,s(f)}),(function(t){return i("throw",t,s,l)}))}l(u.arg)}var n;s(this,"_invoke",{value:function(t,a){function o(){return new e((function(e,n){i(t,a,e,n)}))}return n=n?n.then(o,o):o()}})}function P(t,i,a){var n=h;return function(o,r){if(n===g)throw Error("Generator is already running");if(n===b){if("throw"===o)throw r;return{value:e,done:!0}}for(a.method=o,a.arg=r;;){var s=a.delegate;if(s){var l=L(s,a);if(l){if(l===y)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(n===h)throw n=b,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n=g;var u=m(t,i,a);if("normal"===u.type){if(n=a.done?b:v,u.arg===y)continue;return{value:u.arg,done:a.done}}"throw"===u.type&&(n=b,a.method="throw",a.arg=u.arg)}}}function L(t,i){var a=i.method,n=t.iterator[a];if(n===e)return i.delegate=null,"throw"===a&&t.iterator.return&&(i.method="return",i.arg=e,L(t,i),"throw"===i.method)||"return"!==a&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+a+"' method")),y;var o=m(n,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,y;var r=o.arg;return r?r.done?(i[t.resultName]=r.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,y):r:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function U(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function B(t){if(t||""===t){var i=t[u];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function i(){for(;++n<t.length;)if(r.call(t,n))return i.value=t[n],i.done=!1,i;return i.value=e,i.done=!0,i};return o.next=o}}throw new TypeError(a(t)+" is not iterable")}return x.prototype=_,s(T,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:x,configurable:!0}),x.displayName=c(_,d,"GeneratorFunction"),i.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,c(t,d,"GeneratorFunction")),t.prototype=Object.create(T),t},i.awrap=function(t){return{__await:t}},N(M.prototype),c(M.prototype,f,(function(){return this})),i.AsyncIterator=M,i.async=function(t,e,a,n,o){void 0===o&&(o=Promise);var r=new M(p(t,e,a,n),o);return i.isGeneratorFunction(e)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},N(T),c(T,d,"Generator"),c(T,u,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),i.keys=function(t){var e=Object(t),i=[];for(var a in e)i.push(a);return i.reverse(),function t(){for(;i.length;){var a=i.pop();if(a in e)return t.value=a,t.done=!1,t}return t.done=!0,t}},i.values=B,U.prototype={constructor:U,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(C),!t)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function a(a,n){return s.type="throw",s.arg=t,i.next=a,n&&(i.method="next",i.arg=e),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=e,n?(this.method="next",this.next=n.finallyLoc,y):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),C(i),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var a=i.completion;if("throw"===a.type){var n=a.arg;C(i)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,i,a){return this.delegate={iterator:B(t),resultName:i,nextLoc:a},"next"===this.method&&(this.arg=e),y}},i}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(i){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,i)=>{var a=i(24)();t.exports=a;try{regeneratorRuntime=a}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=a:Function("r","regeneratorRuntime = r")(a)}}},e={};function i(a){var n=e[a];if(void 0!==n)return n.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{"use strict";i.r(a),i.d(a,{components:()=>ut,extend:()=>xt});const t=flarum.core.compat["admin/app"];var e=i.n(t);function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n(t,e)}const r=flarum.core.compat["common/components/Button"];var s=i.n(r);const l=flarum.core.compat["admin/utils/saveSettings"];var u=i.n(l);const f=flarum.core.compat["common/components/Alert"];var d=i.n(f);const c=flarum.core.compat["common/components/Select"];var p=i.n(c);const h=flarum.core.compat["common/components/Switch"];var v=i.n(h);const g=flarum.core.compat["admin/components/UploadImageButton"];var b=function(t){function i(){return t.apply(this,arguments)||this}return o(i,t),i.prototype.resourceUrl=function(){return e().forum.attribute("apiUrl")+"/"+this.attrs.path},i}(i.n(g)());const y=flarum.core.compat["common/utils/withAttr"];var w=i.n(y);const x=flarum.core.compat["common/utils/Stream"];var _=i.n(x);const S=flarum.core.compat["admin/components/ExtensionPage"];var k=i.n(S);const F=flarum.core.compat["common/utils/ItemList"];var T=i.n(F);const N=flarum.core.compat["common/components/Modal"];var M=i.n(N);const P=flarum.core.compat["common/components/LoadingIndicator"];var L=i.n(P),O=function(t){function i(){return t.apply(this,arguments)||this}o(i,t);var a=i.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.uploading=!1,this.inspection={}},a.className=function(){return"Modal--small fof-upload-inspect-mime-modal"},a.title=function(){return e().translator.trans("fof-upload.admin.inspect-mime.title")},a.content=function(){return m("div",{className:"Modal-body"},m("p",null,e().translator.trans("fof-upload.admin.inspect-mime.description",{a:m("a",{href:"https://github.com/SoftCreatR/php-mime-detector"})})),m("p",null,e().translator.trans("fof-upload.admin.inspect-mime.select")),m("div",null,m("input",{type:"file",onchange:this.onupload.bind(this),disabled:this.uploading}),this.uploading?L().component():null),m("dl",null,m("dt",null,e().translator.trans("fof-upload.admin.inspect-mime.laravel-validation")),m("dd",null,void 0===this.inspection.laravel_validation?m("em",null,e().translator.trans("fof-upload.admin.inspect-mime.no-file-selected")):this.inspection.laravel_validation?e().translator.trans("fof-upload.admin.inspect-mime.validation-passed"):e().translator.trans("fof-upload.admin.inspect-mime.validation-failed",{error:this.inspection.laravel_validation_error||"?"}))),m("dl",null,m("dt",null,e().translator.trans("fof-upload.admin.inspect-mime.mime-detector")),m("dd",null,this.inspection.mime_detector?m("code",null,this.inspection.mime_detector):m("em",null,e().translator.trans("fof-upload.admin.inspect-mime.not-available")))),m("dl",null,m("dt",null,e().translator.trans("fof-upload.admin.inspect-mime.mime-fileinfo")),m("dd",null,this.inspection.php_mime?m("code",null,this.inspection.php_mime):m("em",null,e().translator.trans("fof-upload.admin.inspect-mime.not-available")))),m("dl",null,m("dt",null,e().translator.trans("fof-upload.admin.inspect-mime.guessed-extension")),m("dd",null,this.inspection.guessed_extension?m("code",null,this.inspection.guessed_extension):m("em",null,e().translator.trans("fof-upload.admin.inspect-mime.not-available")))))},a.onupload=function(t){for(var i=this,a=new FormData,n=0;n<t.target.files.length;n++)a.append("files[]",t.target.files[n]);return this.uploading=!0,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/fof/upload/inspect-mime",serialize:function(t){return t},body:a}).then((function(t){i.uploading=!1,i.inspection=t,m.redraw()})).catch((function(t){throw i.uploading=!1,i.inspection={},m.redraw(),t}))},i}(M());const C=flarum.core.compat["common/helpers/icon"];var U=i.n(C);const B=flarum.core.compat["common/components/Link"];var E=i.n(B),I=function(t){function i(){return t.apply(this,arguments)||this}o(i,t);var a=i.prototype;return a.oninit=function(i){var a=this;t.prototype.oninit.call(this,i),this.loading=!1,this.fields=["resizeMaxWidth","cdnUrl","maxFileSize","whitelistedClientExtensions","composerButtonVisiblity","watermark","watermarkPosition","imgurClientId","awsS3Key","awsS3Secret","awsS3Bucket","awsS3Region","awsS3Endpoint","awsS3ACL","awsS3CustomUrl","qiniuKey","qiniuSecret","qiniuBucket"],this.checkboxes=["mustResize","addsWatermarks","disableHotlinkProtection","disableDownloadLogging","awsS3UsePathStyleEndpoint"],this.objects=["mimeTypes"],this.watermarkPositions={"top-left":"top-left","top-right":"top-right","bottom-left":"bottom-left","bottom-right":"bottom-right",center:"center",left:"left",top:"top",right:"right",bottom:"bottom"},this.composerButtonVisiblityOptions={both:e().translator.trans("fof-upload.admin.labels.composer_buttons.options.both"),"upload-btn":e().translator.trans("fof-upload.admin.labels.composer_buttons.options.upload-btn"),"media-btn":e().translator.trans("fof-upload.admin.labels.composer_buttons.options.media-btn")};var n=e().data.settings;this.settingsPrefix="fof-upload",this.uploadMethodOptions=n[this.addPrefix("availableUploadMethods")]||{},this.templateOptions=n[this.addPrefix("availableTemplates")]||{},this.values={},this.fields.forEach((function(t){return a.values[t]=_()(n[a.addPrefix(t)])})),this.checkboxes.forEach((function(t){return a.values[t]=_()("1"===n[a.addPrefix(t)])})),this.objects.forEach((function(t){return a.values[t]=n[a.addPrefix(t)]?_()(JSON.parse(n[a.addPrefix(t)])):_()()})),this.defaultAdap=Object.keys(this.uploadMethodOptions)[Object.keys(this.uploadMethodOptions).length-1],this.values.mimeTypes()||(this.values.mimeTypes=_()({"^image\\/.*":{adapter:this.defaultAdap,template:"image-preview"}})),this.newMimeType={regex:_()(""),adapter:_()(this.defaultAdap),template:_()("file")}},a.content=function(){var t=this,i=e().data.settings[this.addPrefix("php_ini.post_max_size")],a=e().data.settings[this.addPrefix("php_ini.upload_max_filesize")];return[m(".UploadPage",[m(".container",[m("form",{onsubmit:this.onsubmit.bind(this)},[m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.preferences.title")),m("label",e().translator.trans("fof-upload.admin.labels.preferences.max_file_size")),m("input.FormControl",{value:this.values.maxFileSize(),oninput:w()("value",this.values.maxFileSize),type:"number",min:"0"}),m(".helpText",e().translator.trans("fof-upload.admin.labels.preferences.php_ini_values",{post:i,upload:a})),m("label",e().translator.trans("fof-upload.admin.labels.preferences.mime_types")),m(".MimeTypes--Container",Object.keys(this.values.mimeTypes()).map((function(e){var i=t.values.mimeTypes()[e];return"object"!=typeof i&&(i={adapter:i,template:"file"}),m("div",[m("input.FormControl.MimeTypes",{value:e,oninput:w()("value",t.updateMimeTypeKey.bind(t,e))}),p().component({options:t.uploadMethodOptions,onchange:t.updateMimeTypeAdapter.bind(t,e,i),value:i.adapter||"local"}),p().component({options:t.getTemplateOptionsForInput(),onchange:t.updateMimeTypeTemplate.bind(t,e,i),value:i.template||"local"}),s().component({type:"button",className:"Button Button--warning",onclick:t.deleteMimeType.bind(t,e)},"x")])})),m("br"),m("div",[m("input.FormControl.MimeTypes.add-MimeType-key",{value:this.newMimeType.regex(),oninput:w()("value",this.newMimeType.regex)}),p().component({options:this.uploadMethodOptions,className:"add-MimeType-value",oninput:w()("value",this.newMimeType.adapter),value:this.newMimeType.adapter()}),p().component({options:this.getTemplateOptionsForInput(),className:"add-MimeType-value",oninput:w()("value",this.newMimeType.template),value:this.newMimeType.template()}),s().component({type:"button",className:"Button Button--warning",onclick:this.addMimeType.bind(this)},"+")])),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.mime_types")),s().component({className:"Button",onclick:function(){e().modal.show(O)}},e().translator.trans("fof-upload.admin.labels.inspect-mime")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.download_templates")),this.templateOptionsDescriptions()]),m("fieldset.composerButtons",[m("legend",e().translator.trans("fof-upload.admin.labels.composer_buttons.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.composer_buttons")),m("div",[p().component({options:this.composerButtonVisiblityOptions,onchange:this.values.composerButtonVisiblity,value:this.values.composerButtonVisiblity()||"both"})])]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.resize.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.resize")),v().component({state:this.values.mustResize()||!1,onchange:this.values.mustResize},e().translator.trans("fof-upload.admin.labels.resize.toggle")),m("label",e().translator.trans("fof-upload.admin.labels.resize.max_width")),m("input",{className:"FormControl",value:this.values.resizeMaxWidth()||100,oninput:w()("value",this.values.resizeMaxWidth),disabled:!this.values.mustResize(),type:"number",min:"0"})]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.client_extension.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.client_extension")),m("input",{className:"FormControl",value:this.values.whitelistedClientExtensions()||"",oninput:w()("value",this.values.whitelistedClientExtensions)})]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.watermark.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.watermark")),v().component({state:this.values.addsWatermarks()||!1,onchange:this.values.addsWatermarks},e().translator.trans("fof-upload.admin.labels.watermark.toggle")),m("label",e().translator.trans("fof-upload.admin.labels.watermark.position")),m("div",[p().component({options:this.watermarkPositions,onchange:this.values.watermarkPosition,value:this.values.watermarkPosition()||"bottom-right"})]),m("label",{},e().translator.trans("fof-upload.admin.labels.watermark.file")),b.component({name:"fof-watermark",path:"fof/watermark"})]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.disable-hotlink-protection.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.disable-hotlink-protection")),v().component({state:this.values.disableHotlinkProtection()||!1,onchange:this.values.disableHotlinkProtection},e().translator.trans("fof-upload.admin.labels.disable-hotlink-protection.toggle")),m("legend",e().translator.trans("fof-upload.admin.labels.disable-download-logging.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.disable-download-logging")),v().component({state:this.values.disableDownloadLogging()||!1,onchange:this.values.disableDownloadLogging},e().translator.trans("fof-upload.admin.labels.disable-download-logging.toggle"))]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.local.title")),m("label",e().translator.trans("fof-upload.admin.labels.local.cdn_url")),m("input.FormControl",{value:this.values.cdnUrl()||"",oninput:w()("value",this.values.cdnUrl)})]),this.adaptorItems().toArray(),s().component({type:"submit",className:"Button Button--primary",loading:this.loading,disabled:!this.changed()},e().translator.trans("core.admin.settings.submit_button"))])])])]},a.adaptorItems=function(){var t=new(T());return void 0!==this.uploadMethodOptions.imgur&&t.add("imgur",m("div",{className:"imgur"},m("fieldset",null,m("legend",null,e().translator.trans("fof-upload.admin.labels.imgur.title")),m("p",null,U()("fas fa-exclamation-circle")," ",e().translator.trans("fof-upload.admin.labels.imgur.tos",{a:m(E(),{href:"https://imgur.com/tos",external:!0,target:"_blank"})})),m("label",null,e().translator.trans("fof-upload.admin.labels.imgur.client_id")),m("input",{className:"FormControl",value:this.values.imgurClientId()||"",oninput:w()("value",this.values.imgurClientId)}))),100),void 0!==this.uploadMethodOptions.qiniu&&t.add("qiniu",m(".qiniu",[m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.qiniu.title")),m("label",e().translator.trans("fof-upload.admin.labels.qiniu.key")),m("input.FormControl",{value:this.values.qiniuKey()||"",oninput:w()("value",this.values.qiniuKey)}),m("label",{},e().translator.trans("fof-upload.admin.labels.qiniu.secret")),m("input.FormControl",{value:this.values.qiniuSecret()||"",oninput:w()("value",this.values.qiniuSecret)}),m("label",{},e().translator.trans("fof-upload.admin.labels.qiniu.bucket")),m("input.FormControl",{value:this.values.qiniuBucket()||"",oninput:w()("value",this.values.qiniuBucket)})])]),80),void 0!==this.uploadMethodOptions["aws-s3"]&&t.add("aws-s3",m(".aws",[m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.aws-s3.title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.s3_instance_profile")),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.key")),m("input.FormControl",{value:this.values.awsS3Key()||"",oninput:w()("value",this.values.awsS3Key)}),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.secret")),m("input.FormControl",{value:this.values.awsS3Secret()||"",oninput:w()("value",this.values.awsS3Secret)}),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.bucket")),m("input.FormControl",{value:this.values.awsS3Bucket()||"",oninput:w()("value",this.values.awsS3Bucket)}),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.region")),m("input.FormControl",{value:this.values.awsS3Region()||"",oninput:w()("value",this.values.awsS3Region)})]),m("fieldset",[m("legend",e().translator.trans("fof-upload.admin.labels.aws-s3.advanced_title")),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.s3_compatible_storage")),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.endpoint")),m("input.FormControl",{value:this.values.awsS3Endpoint()||"",oninput:w()("value",this.values.awsS3Endpoint)}),v().component({state:this.values.awsS3UsePathStyleEndpoint()||!1,onchange:this.values.awsS3UsePathStyleEndpoint},e().translator.trans("fof-upload.admin.labels.aws-s3.use_path_style_endpoint")),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.acl")),m("input.FormControl",{value:this.values.awsS3ACL()||"",oninput:w()("value",this.values.awsS3ACL)}),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.s3_acl")),m("label",e().translator.trans("fof-upload.admin.labels.aws-s3.custom_url")),m("input.FormControl",{value:this.values.awsS3CustomUrl()||"",oninput:w()("value",this.values.awsS3CustomUrl)}),m(".helpText",e().translator.trans("fof-upload.admin.help_texts.custom_s3_url"))])]),60),t},a.getTemplateOptionsForInput=function(){var t={};for(var e in this.templateOptions)this.templateOptions.hasOwnProperty(e)&&(t[e]=this.templateOptions[e].name);return t},a.updateMimeTypeKey=function(t,e){this.values.mimeTypes()[e]=this.values.mimeTypes()[t],this.deleteMimeType(t)},a.updateMimeTypeAdapter=function(t,e,i){e.adapter=i,this.values.mimeTypes()[t]=e},a.updateMimeTypeTemplate=function(t,e,i){e.template=i,this.values.mimeTypes()[t]=e},a.deleteMimeType=function(t){delete this.values.mimeTypes()[t]},a.templateOptionsDescriptions=function(){var t=[];for(var e in this.templateOptions)this.templateOptions.hasOwnProperty(e)&&t.push(m("li",null,this.templateOptions[e].name,": ",m.trust(this.templateOptions[e].description)));return m("ul",t)},a.addMimeType=function(){this.values.mimeTypes()[this.newMimeType.regex()]={adapter:this.newMimeType.adapter(),template:this.newMimeType.template()},this.newMimeType.regex(""),this.newMimeType.adapter("local"),this.newMimeType.template("file")},a.changed=function(){var t=this,i=this.fields.some((function(i){return t.values[i]()!==e().data.settings[t.addPrefix(i)]})),a=this.checkboxes.some((function(i){return t.values[i]()!==("1"===e().data.settings[t.addPrefix(i)])})),n=this.objects.some((function(i){return JSON.stringify(t.values[i]())!==e().data.settings[t.addPrefix(i)]}));return i||a||n},a.onsubmit=function(t){var i=this;if(t.preventDefault(),!this.loading){this.loading=!0,e().alerts.dismiss(this.successAlert);var a={};this.fields.forEach((function(t){return a[i.addPrefix(t)]=i.values[t]()})),this.checkboxes.forEach((function(t){return a[i.addPrefix(t)]=i.values[t]()})),this.objects.forEach((function(t){return a[i.addPrefix(t)]=JSON.stringify(i.values[t]())})),u()(a).then((function(){i.successAlert=e().alerts.show(d(),{type:"success"},e().translator.trans("core.admin.settings.saved_message"))})).catch((function(){})).then((function(){i.loading=!1,m.redraw()}))}},a.addPrefix=function(t){return this.settingsPrefix+"."+t},i}(k());const A=flarum.core.compat["common/extend"],j=flarum.core.compat["admin/components/AdminNav"];var D=i.n(j);const z=flarum.core.compat["common/components/LinkButton"];var R=i.n(z);function H(){return H=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)({}).hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t},H.apply(null,arguments)}function q(t,e,i,a,n,o,r){try{var s=t[o](r),l=s.value}catch(t){return void i(t)}s.done?e(l):Promise.resolve(l).then(a,n)}function W(t){return function(){var e=this,i=arguments;return new Promise((function(a,n){var o=t.apply(e,i);function r(t){q(o,a,n,r,s,"next",t)}function s(t){q(o,a,n,r,s,"throw",t)}r(void 0)}))}}var G=i(183),K=i.n(G);const V=flarum.core.compat["common/app"];var J=i.n(V),Y=new Map([["image/png","far fa-file-image"],["image/jpg","far fa-file-image"],["image/jpeg","far fa-file-image"],["image/svg+xml","far fa-file-image"],["image/gif","far fa-file-image"],["image/bmp","far fa-file-image"],["image/webp","far fa-file-image"],["application/zip","far fa-file-archive"],["application/x-7z-compressed","far fa-file-archive"],["application/gzip","far fa-file-archive"],["application/vnd.rar","far fa-file-archive"],["application/x-rar-compressed","far fa-file-archive"],["application/x-tar","far fa-file-archive"],["application/x-iso9660-image","far fa-file-archive"],["text/plain","far fa-file-alt"],["text/csv","far fa-file-csv"],["text/xml","far fa-file-code"],["text/html","far fa-file-code"],["text/css","far fa-file-code"],["text/javascript","far fa-file-code"],["application/json","far fa-file-code"],["application/ld+json","far fa-file-code"],["application/x-httpd-php","far fa-file-code"],["application/xml","far fa-file-code"],["text/xml","far fa-file-code"],["application/x-abiword","far fa-file-word"],["application/msword","far fa-file-word"],["application/vnd.openxmlformats-officedocument.wordprocessingml.document","far fa-file-word"],["application/vnd.oasis.opendocument.text","far fa-file-word"],["application/vnd.ms-excel","far fa-file-excel"],["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","far fa-file-excel"],["application/vnd.oasis.opendocument.spreadsheet","far fa-file-excel"],["application/vnd.ms-powerpoint","far fa-file-powerpoint"],["application/vnd.openxmlformats-officedocument.presentationml.presentation","far fa-file-powerpoint"],["application/vnd.oasis.opendocument.presentation","far fa-file-powerpoint"],["application/pdf","far fa-file-pdf"],["application/rtf","far fa-file-alt"],["application/epub+zip","far fa-book"],["application/x-mobipocket-ebook","far fa-book"],["application/vnd.amazon.ebook","far fa-book"],["audio/mpeg","far fa-file-audio"],["audio/wav","far fa-file-audio"],["audio/x-wav","far fa-file-audio"],["audio/aac","far fa-file-audio"],["audio/ogg","far fa-file-audio"],["audio/flac","far fa-file-audio"],["audio/aiff","far fa-file-audio"],["audio/x-aiff","far fa-file-audio"],["video/x-msvideo","far fa-file-video"],["video/mp4","far fa-file-video"],["video/quicktime","far fa-file-video"]]);function Q(t){return Y.get(t)||(t.startsWith("image/")?"far fa-file-image":t.startsWith("video/")?"far fa-file-video":t.startsWith("audio/")?"far fa-file-audio":"far fa-file")}var X=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).files=[],e.fileInput=null,e.options={shared:!0,hidden:!1},e.loading=!1,e}o(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e)},i.className=function(){return"UploadSharedFileModal Modal--medium"},i.title=function(){return J().translator.trans("fof-upload.lib.upload-shared-file-modal.title")},i.onFileChange=function(t){this.addFiles(Array.from(t.target.files))},i.addFiles=function(t){var e;(e=this.files).push.apply(e,t),m.redraw()},i.onDragOver=function(t){t.preventDefault(),t.stopPropagation()},i.onDrop=function(t){t.preventDefault(),t.stopPropagation(),t.dataTransfer&&t.dataTransfer.files&&this.addFiles(Array.from(t.dataTransfer.files))},i.onDropzoneClick=function(){this.fileInput&&this.fileInput.click()},i.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"UploadSharedFileModal-dropzone",onclick:function(){return t.onDropzoneClick()},ondragover:this.onDragOver.bind(this),ondrop:this.onDrop.bind(this)},J().translator.trans("fof-upload.lib.upload-shared-file-modal.dropzone"),m("input",{type:"file",multiple:!0,onchange:this.onFileChange.bind(this),style:{opacity:0,position:"absolute",left:"-9999px"},oncreate:function(e){t.fileInput=e.dom}})),m("div",{className:"UploadSharedFileModal-files"},this.files.map((function(e){var i=e.type.startsWith("image/");return m("div",{className:"UploadedFile"},i?m("img",{src:URL.createObjectURL(e),alt:e.name}):m("i",{className:Q(e.type)}),m("div",{className:"UploadedFile-name"},e.name),m(s(),{className:"Button Button--icon Button--link UploadedFile-remove",icon:"fas fa-times",onclick:function(){t.files=t.files.filter((function(t){return t!==e}))}}))}))),m("div",{className:"UploadSharedFileModal-options Form-group"},m(v(),{state:this.options.hidden,onchange:function(e){return t.options.hidden=e}},J().translator.trans("fof-upload.lib.upload-shared-file-modal.hide-from-media-gallery"))),m("div",{className:"UploadSharedFileModal-submit App-primaryControl"},m(s(),{className:"Button Button--primary",loading:this.loading,onclick:this.upload.bind(this),disabled:!this.files.length||this.loading},J().translator.trans("fof-upload.lib.upload-shared-file-modal.upload"))))},i.upload=function(){var t=W(K().mark((function t(){var e,i,a,n=this;return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,m.redraw(),e=new FormData,this.files.forEach((function(t){e.append("files[]",t)})),Object.keys(this.options).forEach((function(t){e.append("options["+t+"]",n.options[t])})),t.next=7,J().request({method:"POST",url:J().forum.attribute("apiUrl")+"/fof/upload",serialize:function(t){return t},body:e});case 7:i=t.sent,a=J().store.pushPayload(i),this.attrs.onUploadComplete(a),this.files=[],this.hide(),this.loading=!1,m.redraw();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(M());const Z=flarum.core.compat["common/Component"];var $=i.n(Z),tt=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).file=void 0,e.callback=void 0,e.imageLoaded=!0,e.handleImageError=function(){e.imageLoaded=!1,m.redraw()},e.handleImageLoad=function(){e.imageLoaded=!0,m.redraw()},e}o(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.file=this.attrs.file},i.view=function(){var t=this,e=this.file.type().startsWith("image/"),i=Q(this.file.type()),a=this.file.isPrivateShared()?"fas fa-lock":"fas fa-unlock";return m("div",{className:"UploadedFile",key:this.file.uuid()},m("div",{className:"UploadedFile--sharestatus"},m("span",null,U()(a),this.file.baseName())),m("div",{className:"UploadedFile--preview",onclick:function(){return t.onFileClick(t.file)}},e?this.imageLoaded?m("img",{className:this.attrs.fileClassNames,src:this.file.url(),loading:"lazy",onerror:this.handleImageError,onload:this.handleImageLoad,alt:this.file.baseName()}):U()("fas fa-exclamation-triangle",{className:"icon-fallback"}):U()(i,{className:"icon-fallback"})),m("div",{className:"UploadedFile--actions"},this.actionItems().toArray()))},i.actionItems=function(){var t=this,e=new(T());e.add("view-info",m(s(),{className:"Button Button--icon",icon:"fas fa-info-circle",onclick:function(){return t.viewFileInfo()},"aria-label":"info"})),e.add("download",m(s(),{className:"Button Button--icon",icon:"fas fa-download",onclick:function(){return window.open(t.file.url())},"aria-label":"download"}));var i=this.file.isPrivateShared()?"fas fa-lock":this.file.hidden()?"fas fa-eye":"fas fa-eye-slash";return e.add("hide-file",m(s(),{className:"Button Button--icon",icon:i,onclick:function(){return t.hideFile()},"aria-label":"hide"})),e.add("delete",m(s(),{className:"Button Button--icon",icon:"fas fa-trash",onclick:function(){return t.confirmDelete()},"aria-label":"delete"})),e},i.confirmDelete=function(){var t=W(K().mark((function t(){var e;return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm("Are you sure you want to delete this file?")){t.next=6;break}return e=this.file.uuid(),t.next=5,J().request({method:"DELETE",url:J().forum.attribute("apiUrl")+"/fof/upload/delete/"+e});case 5:this.attrs.onDelete&&this.attrs.onDelete(this.file);case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),i.viewFileInfo=function(){console.log("view file info")},i.hideFile=function(){console.log("hide file")},i.onFileClick=function(t){this.attrs.onFileSelect&&this.attrs.onFileSelect(t)},e}($());const et=flarum.core.compat["common/utils/classList"];var it=i.n(et);const at=flarum.core.compat["common/components/Tooltip"];var nt=i.n(at);const ot=flarum.core.compat["common/utils/extractText"];var rt=i.n(ot),st=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).isFileHiding=void 0,e.imageLoaded=!0,e.file=void 0,e.fileIcon=void 0,e.isSelected=void 0,e.isSelectable=void 0,e.handleImageError=function(){e.imageLoaded=!1,e.fileIcon="fas fa-exclamation-triangle",e.isSelectable=!1,m.redraw()},e.handleImageLoad=function(){e.imageLoaded=!0,m.redraw()},e}o(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.file=this.attrs.file,this.isFileHiding=void 0!==this.attrs.isFileHiding&&this.attrs.isFileHiding,this.fileIcon=Q(this.file.type()),this.isSelected=void 0!==this.attrs.isSelected&&this.attrs.isSelected,this.isSelectable=void 0===this.attrs.fileSelectable||this.attrs.fileSelectable},i.onbeforeupdate=function(e){t.prototype.onbeforeupdate.call(this,e),this.isSelected=void 0!==this.attrs.isSelected&&this.attrs.isSelected},i.view=function(){var t=this,e=this.file.type().startsWith("image/"),i=this.isSelected?"selected":"";return m("div",{className:"UploadedFile "+i,key:this.file.uuid(),onclick:function(){t.isSelectable&&!t.isFileHiding&&(t.isSelected=!t.isSelected,t.attrs.onFileClick(t.file))},disabled:!this.isSelectable||this.isFileHiding},this.imageLoaded&&e?m("img",{src:this.file.url(),className:"fof-file-image-preview",draggable:!1,onerror:this.handleImageError,onload:this.handleImageLoad,alt:this.file.baseName()}):this.displayIcon(this.fileIcon),m("div",{className:"fof-file-actions"},this.actionItems(this.file).toArray()),m("div",{className:"fof-file-name"},m(nt(),{text:this.file.baseName()},m("span",null,this.file.baseName()))),this.isFileHiding&&m("div",{class:"fof-file-loading",role:"status","aria-label":J().translator.trans("fof-upload.lib.file_list.hide_file.loading")},m(L(),null)))},i.displayIcon=function(t){return m("span",{className:"fof-file-icon",role:"presentation",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},U()("fa-fw "+t))},i.actionItems=function(t){var e=this,i=new(T());t.canViewInfo()&&i.add("view-info",m(s(),{className:"Button Button--icon fof-file-action",icon:"fas fa-info-circle","aria-label":"info",onclick:function(){return e.viewFileInfo()}}),100);var a=t.isShared()?"fof-upload.lib.file_list.hide_shared_file":"fof-upload.lib.file_list.hide_file",n=J().translator.trans(this.file.hidden()?a+".btn_a11y_label_show":a+".btn_a11y_label_hide",{fileName:t.baseName()});t.canHide()&&i.add("hide-file",m(nt(),{text:n,position:"bottom"},m(s(),{className:"Button Button--icon fof-file-action",icon:this.file.hidden()?"fas fa-eye":"fas fa-eye-slash","aria-label":n,disabled:this.isFileHiding,onclick:function(t){return e.hide(t)}})),80);var o=J().translator.trans("fof-upload.lib.file_list.delete_file_a11y_label",{fileName:t.baseName()});return t.canDelete()&&i.add("delete-file",m(nt(),{text:o,position:"bottom"},m(s(),{className:"Button Button--icon fof-file-action",icon:"fas fa-trash","aria-label":o,disabled:this.isFileHiding,onclick:function(t){return e.confirmDelete(t)}})),60),i},i.viewFileInfo=function(){console.log("view file info")},i.hide=function(t){t.stopPropagation(),this.attrs.onHide&&this.attrs.onHide(this.file)},i.confirmDelete=function(){var t=W(K().mark((function t(e){var i;return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.stopPropagation(),!confirm(rt()(J().translator.trans("fof-upload.lib.file_list.delete_confirmation",{fileName:this.file.baseName()})))){t.next=6;break}return i=this.file.uuid(),t.next=5,J().request({method:"DELETE",url:J().forum.attribute("apiUrl")+"/fof/upload/delete/"+i});case 5:this.attrs.onDelete&&this.attrs.onDelete(this.file);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e}($()),lt=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).user=null,e.inModal=void 0,e.restrictFileType=void 0,e.downloadOnClick=void 0,e.filesBeingHidden=void 0,e.fileState=void 0,e}o(e,t);var i=e.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.inModal=this.attrs.selectable,this.restrictFileType=this.attrs.restrictFileType||null,this.downloadOnClick=this.attrs.downloadOnClick||!1,this.filesBeingHidden=[],this.fileState=this.attrs.fileState,this.loadFileList()},i.view=function(){var t=this;return m("div",{className:"SharedFileList fof-upload-file-list","aria-live":"polite"},this.isLoading()&&0===this.fileCollection().length&&m("div",{className:"fof-upload-loading"},J().translator.trans("fof-upload.lib.file_list.loading"),m(L(),null)),!this.isLoading()&&0===this.fileCollection().length&&m("div",{className:"Placeholder"},m("p",{className:"fof-upload-empty"},J().translator.trans("fof-upload.lib.file_list.empty"))),m("ul",null,this.fileCollection().map((function(e){var i,a,n=Q(e.type()),o=!t.restrictFileType||t.isSelectable(e),r=it()(["fof-file","far fa-file-image"===n&&"fof-file-type-image",t.attrs.selectedFiles&&t.attrs.selectedFiles.indexOf(null!=(i=e.id())?i:"")>=0&&"fof-file-selected"]),s=t.filesBeingHidden.includes(e.uuid());return m("li",{"aria-busy":s,key:e.uuid()},m(st,{file:e,fileSelectable:o,isSelected:t.attrs.selectedFiles&&t.attrs.selectedFiles.indexOf(null!=(a=e.id())?a:"")>=0,fileClassNames:r,isFileHiding:s,onHide:t.hideFile.bind(t),onFileClick:t.onFileClick.bind(t),user:t.attrs.user,onDelete:t.onDelete.bind(t)}))}))),this.hasMoreResults()&&m("div",{className:"fof-load-more-files"},m(s(),{className:"Button Button--primary",disabled:this.isLoading(),loading:this.isLoading(),onclick:function(){return t.loadMore()}},J().translator.trans("fof-upload.lib.file_list.load_more_files_btn"))))},i.onDelete=function(t){this.attrs.onDelete&&this.attrs.onDelete(t)},i.onFileClick=function(t){this.attrs.onFileSelect?this.attrs.onFileSelect(t):this.attrs.downloadOnClick&&window.open(t.url())},i.isSelectable=function(t){var e=t.type();return Array.isArray(this.restrictFileType)?this.restrictFileType.indexOf(e)>=0:"image"===this.restrictFileType?e.includes("image/"):"audio"===this.restrictFileType?e.includes("audio/"):"video"===this.restrictFileType&&e.includes("video/")},i.hideFile=function(){var t=W(K().mark((function t(e){var i,a,n,o,r;return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.uuid(),!this.filesBeingHidden.includes(i)){t.next=3;break}return t.abrupt("return");case 3:if(this.filesBeingHidden.push(i),a=e.isShared()?"fof-upload.lib.file_list.hide_shared_file":"fof-upload.lib.file_list.hide_file",!confirm(rt()(J().translator.trans(e.hidden()?a+".show_confirmation":a+".hide_confirmation",{fileName:e.baseName()})))){t.next=24;break}return t.prev=7,t.next=10,J().request({method:"PATCH",url:J().forum.attribute("apiUrl")+"/fof/upload/hide",body:{uuid:i}});case 10:n=t.sent,J().store.pushPayload(n),m.redraw(),J().alerts.show(d(),{type:"success"},[U()(e.hidden()?"fas fa-eye-slash":"fas fa-eye")," ",J().translator.trans(null!=e&&e.hidden()?a+".hide_success":a+".show_success")]),this.fileState.user&&(o=this.fileState.files.findIndex((function(t){return i===t.uuid()})),this.fileState.files.splice(o,1)),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),J().alerts.show(d(),{type:"error"},J().translator.trans(null!=e&&e.hidden()?a+".hide_fail":a+".show_fail",{fileName:e.baseName()}));case 20:return t.prev=20,r=this.filesBeingHidden.indexOf(i),this.filesBeingHidden.splice(r,1),t.finish(20);case 24:case"end":return t.stop()}}),t,this,[[7,17,20,24]])})));return function(e){return t.apply(this,arguments)}}(),e}($()),ut=H({},{UploadedFile:tt,UploadSharedFileModal:X,UserFileList:function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var i=e.prototype;return i.loadFileList=function(){this.fileState.setUser(this.attrs.user||J().session.user),this.user=this.fileState.user},i.hasMoreResults=function(){return this.fileState.hasMoreResults()},i.loadMore=function(){this.fileState.loadMore()},i.isLoading=function(){return this.fileState.isLoading()},i.fileCollection=function(){return this.fileState.files},e}(lt)},{UploadPage:I});const ft=flarum.core.compat["common/extenders"];var dt=i.n(ft);const ct=flarum.core.compat["common/Model"];var pt=i.n(ct),mt=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var i=e.prototype;return i.baseName=function(){return pt().attribute("baseName").call(this)},i.path=function(){return pt().attribute("path").call(this)},i.url=function(){return pt().attribute("url").call(this)},i.size=function(){return pt().attribute("size").call(this)},i.type=function(){return pt().attribute("type").call(this)},i.humanSize=function(){return pt().attribute("humanSize").call(this)},i.createdAt=function(){return pt().attribute("createdAt",pt().transformDate).call(this)},i.uuid=function(){return pt().attribute("uuid").call(this)},i.tag=function(){return pt().attribute("tag").call(this)},i.hidden=function(){return pt().attribute("hidden").call(this)},i.bbcode=function(){return pt().attribute("bbcode").call(this)},i.isShared=function(){return pt().attribute("shared").call(this)},i.isPrivateShared=function(){return pt().attribute("isPrivateShared").call(this)},i.canViewInfo=function(){return pt().attribute("canViewInfo").call(this)},i.canHide=function(){return pt().attribute("canHide").call(this)},i.canDelete=function(){return pt().attribute("canDelete").call(this)},i.apiEndpoint=function(){return"/fof/uploads"+(this.exists?"/"+this.id():"")},e}(pt());const ht=[(new(dt().Store)).add("files",mt).add("shared-files",mt)],vt=flarum.core.compat["admin/components/AdminPage"];var gt=i.n(vt),bt=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var i=e.prototype;return i.loadFileList=function(){this.fileState.loadResults()},i.hasMoreResults=function(){return this.fileState.hasMoreResults()},i.loadMore=function(){this.fileState.loadMore()},i.isLoading=function(){return this.fileState.isLoading()},i.fileCollection=function(){return this.fileState.files},e}(lt),yt=function(){function t(t){void 0===t&&(t=!1),this.user=void 0,this.files=void 0,this.moreResults=void 0,this.loading=void 0,this.sharedFiles=void 0,this.user=null,this.files=[],this.moreResults=!1,this.loading=!1,this.sharedFiles=t}var e=t.prototype;return e.setUser=function(t){t!==this.user&&(this.user=t,this.files=[],this.loadResults())},e.refresh=function(){this.files=[],this.loadResults(),m.redraw()},e.loadResults=function(){var t=W(K().mark((function t(e){var i,a,n;return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===e&&(e=0),this.sharedFiles||this.user){t.next=3;break}return t.abrupt("return",Promise.reject("User not set"));case 3:return this.loading=!0,i="fof/uploads",a={},!this.sharedFiles&&this.user?a={filter:{user:this.user.id()},page:{offset:e}}:(i="fof/upload/shared-files",a={page:{offset:e}}),t.next=9,J().store.find(i,a);case 9:return n=t.sent,t.abrupt("return",this.parseResults(n));case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.loadMore=function(){var t=W(K().mark((function t(){return K().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.abrupt("return",this.loadResults(this.files.length));case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e.parseResults=function(t){var e;return this.files=this.files.concat(t),this.loading=!1,this.moreResults=!(null==(e=t.payload)||null==(e=e.links)||!e.next),m.redraw(),t},e.addToList=function(t){var e;Array.isArray(t)?(e=this.files).unshift.apply(e,t):this.files.unshift(t),m.redraw()},e.removeFromList=function(t){Array.isArray(t)?this.files=this.files.filter((function(e){return!t.includes(e)})):this.files=this.files.filter((function(e){return e!==t})),m.redraw()},e.hasFiles=function(){return this.files.length>0},e.isLoading=function(){return this.loading},e.hasMoreResults=function(){return this.moreResults},e.empty=function(){return!this.hasFiles()&&!this.isLoading()},t}(),wt=function(t){function i(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).sharedUploads=[],e.currentPage=1,e.fileState=void 0,e}o(i,t);var a=i.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.fileState=new yt(!0)},a.headerInfo=function(){return{className:"SharedUploadPage--header",icon:"fas fa-file-upload",title:e().translator.trans("fof-upload.admin.shared-uploads.title"),description:e().translator.trans("fof-upload.admin.shared-uploads.description")}},a.content=function(){return m("div",{className:"SharedUploadPage--content"},m("p",{className:"helpText"},e().translator.trans("fof-upload.admin.shared-uploads.introduction")),m("hr",null),m("div",{className:"SharedUploadPage--main-actions"},this.mainActionItems().toArray()),m("hr",null),m("div",{className:"SharedUploadPage--uploads"},m(bt,{user:e().session.user,selectable:!1,fileState:this.fileState,onDelete:this.onDelete.bind(this)})))},a.showUploadModal=function(){var t=this;e().modal.show(X,{onUploadComplete:function(e){t.uploadComplete(e)}})},a.mainActionItems=function(){var t=this,i=new(T());return i.add("refresh",m(s(),{className:"Button Button--icon",icon:"fas fa-sync",onclick:function(){return t.refresh()}})),i.add("upload-new",m(s(),{className:"Button",icon:"fas fa-upload",onclick:function(){return t.showUploadModal()}},e().translator.trans("fof-upload.admin.shared-uploads.upload-new-button"))),i},a.fileActionItems=function(t){return new(T())},a.uploadComplete=function(t){console.log("upload complete",t),this.fileState.addToList(t)},a.refresh=function(){this.fileState.refresh()},a.onDelete=function(t){this.fileState.removeFromList(t)},i}(gt());const xt=[].concat(ht,[(new(dt().Routes)).add("adminUploads","/uploads",wt)]);e().initializers.add("fof-upload",(function(){e().extensionData.for("fof-upload").registerPage(I).registerPermission({icon:"far fa-file",label:e().translator.trans("fof-upload.admin.permissions.upload_label"),permission:"fof-upload.upload"},"start",50).registerPermission({icon:"fas fa-download",label:e().translator.trans("fof-upload.admin.permissions.download_label"),permission:"fof-upload.download",allowGuest:!0},"view",50).registerPermission({icon:"fas fa-eye",label:e().translator.trans("fof-upload.admin.permissions.view_user_uploads_label"),permission:"fof-upload.viewUserUploads"},"moderate",50).registerPermission({icon:"fas fa-trash",label:e().translator.trans("fof-upload.admin.permissions.delete_uploads_of_others_label"),permission:"fof-upload.deleteUserUploads"},"moderate",50).registerPermission({icon:"far fa-file-alt",label:e().translator.trans("fof-upload.admin.permissions.upload_shared_label"),permission:"fof-upload.upload-shared-files"},"start").registerPermission({icon:"far fa-file-alt",label:e().translator.trans("fof-upload.admin.permissions.access_shared_label"),permission:"fof-upload.access-shared-files"},"start"),(0,A.extend)(D().prototype,"items",(function(t){t.add("shared-uploads",m(R(),{href:e().route("adminUploads"),icon:"fas fa-file-upload",title:e().translator.trans("fof-upload.admin.shared-uploads.title")},e().translator.trans("fof-upload.admin.nav.shared-uploads-button")),49)}))}))})(),module.exports=a})();
//# sourceMappingURL=admin.js.map