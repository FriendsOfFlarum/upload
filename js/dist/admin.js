module.exports=function(a){var e={};function t(l){if(e[l])return e[l].exports;var o=e[l]={i:l,l:!1,exports:{}};return a[l].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=a,t.c=e,t.d=function(a,e,l){t.o(a,e)||Object.defineProperty(a,e,{enumerable:!0,get:l})},t.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},t.t=function(a,e){if(1&e&&(a=t(a)),8&e)return a;if(4&e&&"object"==typeof a&&a&&a.__esModule)return a;var l=Object.create(null);if(t.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:a}),2&e&&"string"!=typeof a)for(var o in a)t.d(l,o,function(e){return a[e]}.bind(null,o));return l},t.n=function(a){var e=a&&a.__esModule?function(){return a.default}:function(){return a};return t.d(e,"a",e),e},t.o=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)},t.p="",t(t.s=18)}([function(a,e){a.exports=flarum.core.compat.extend},function(a,e){a.exports=flarum.core.compat["components/Select"]},function(a,e,t){"use strict";function l(a,e){a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.__proto__=e}t.d(e,"a",function(){return l})},function(a,e){a.exports=flarum.core.compat.Component},function(a,e){a.exports=flarum.core.compat["components/Switch"]},function(a,e){a.exports=flarum.core.compat["components/Button"]},,function(a,e){a.exports=flarum.core.compat["components/PermissionGrid"]},,,,function(a,e){a.exports=flarum.core.compat.app},function(a,e){a.exports=flarum.core.compat["components/AdminNav"]},function(a,e){a.exports=flarum.core.compat["components/AdminLinkButton"]},function(a,e){a.exports=flarum.core.compat["utils/saveSettings"]},function(a,e){a.exports=flarum.core.compat["components/Alert"]},function(a,e){a.exports=flarum.core.compat["components/UploadImageButton"]},,function(a,e,t){"use strict";t.r(e);var l=t(0),o=t(11),n=t.n(o),s=t(7),i=t.n(s),r=t(12),p=t.n(r),u=t(13),d=t.n(u),c=t(2),h=t(3),f=t.n(h),v=t(5),g=t.n(v),b=t(14),w=t.n(b),y=t(15),x=t.n(y),T=t(1),N=t.n(T),k=t(4),P=t.n(k),M=t(16),A=t.n(M),O=function(a){function e(){return a.apply(this,arguments)||this}Object(c.a)(e,a);var t=e.prototype;return t.init=function(){var a=this;this.loading=!1,this.fields=["resizeMaxWidth","cdnUrl","maxFileSize","overrideAvatarUpload","watermark","watermarkPosition","imgurClientId","awsS3Key","awsS3Secret","awsS3Bucket","awsS3Region","ovhUsername","ovhPassword","ovhTenantId","ovhContainer","ovhRegion","b2AccountId","b2ApplicationKey","b2BucketName","b2DownloadUrl"],this.checkboxes=["mustResize","overrideAvatarUpload","addsWatermarks","disableHotlinkProtection","disableDownloadLogging"],this.objects=["mimeTypes"],this.watermarkPositions={"top-left":"top-left","top-right":"top-right","bottom-left":"bottom-left","bottom-right":"bottom-right",center:"center",left:"left",top:"top",right:"right",bottom:"bottom"};var e=app.data.settings;this.settingsPrefix="flagrow.upload",this.uploadMethodOptions=e[this.addPrefix("availableUploadMethods")]||{},this.templateOptions=e[this.addPrefix("availableTemplates")]||{},this.values={},this.fields.forEach(function(t){return a.values[t]=m.prop(e[a.addPrefix(t)])}),this.checkboxes.forEach(function(t){return a.values[t]=m.prop("1"===e[a.addPrefix(t)])}),this.objects.forEach(function(t){return a.values[t]=e[a.addPrefix(t)]?m.prop(JSON.parse(e[a.addPrefix(t)])):m.prop()}),this.values.mimeTypes()||(this.values.mimeTypes=m.prop({"^image\\/.*":{adapter:"local",template:"image-preview"}})),this.newMimeType={regex:m.prop(""),adapter:m.prop("local"),template:m.prop("file")}},t.view=function(){var a=this;return[m("div",{className:"UploadPage"},[m("div",{className:"container"},[m("form",{onsubmit:this.onsubmit.bind(this)},[m("fieldset",{className:"UploadPage-preferences"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.preferences.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.preferences.max_file_size")),m("input",{className:"FormControl",value:this.values.maxFileSize()||2048,oninput:m.withAttr("value",this.values.maxFileSize)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.preferences.mime_types")),m("div",{className:"MimeTypes--Container"},Object.keys(this.values.mimeTypes()).map(function(e){var t=a.values.mimeTypes()[e];return"object"!=typeof t&&(t={adapter:t,template:"file"}),m("div",{},[m("input",{className:"FormControl MimeTypes",value:e,oninput:m.withAttr("value",a.updateMimeTypeKey.bind(a,e))}),N.a.component({options:a.uploadMethodOptions,onchange:a.updateMimeTypeAdapter.bind(a,e,t),value:t.adapter||"local"}),N.a.component({options:a.getTemplateOptionsForInput(),onchange:a.updateMimeTypeTemplate.bind(a,e,t),value:t.template||"local"}),g.a.component({type:"button",className:"Button Button--warning",children:"x",onclick:a.deleteMimeType.bind(a,e)})])}),m("br"),m("div",{},[m("input",{className:"FormControl MimeTypes add-MimeType-key",value:this.newMimeType.regex(),oninput:m.withAttr("value",this.newMimeType.regex)}),N.a.component({options:this.uploadMethodOptions,className:"add-MimeType-value",oninput:m.withAttr("value",this.newMimeType.adapter),value:this.newMimeType.adapter()}),N.a.component({options:this.getTemplateOptionsForInput(),className:"add-MimeType-value",oninput:m.withAttr("value",this.newMimeType.template),value:this.newMimeType.template()}),g.a.component({type:"button",className:"Button Button--warning",children:"+",onclick:this.addMimeType.bind(this)})])),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.mime_types")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.download_templates")),this.templateOptionsDescriptions()]),m("fieldset",{className:"UploadPage-resize"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.resize.title")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.resize")),P.a.component({state:this.values.mustResize()||!1,children:app.translator.trans("flagrow-upload.admin.labels.resize.toggle"),onchange:this.values.mustResize}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.resize.max_width")),m("input",{className:"FormControl",value:this.values.resizeMaxWidth()||100,oninput:m.withAttr("value",this.values.resizeMaxWidth),disabled:!this.values.mustResize()})]),m("fieldset",{className:"UploadPage-watermark"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.watermark.title")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.watermark")),P.a.component({state:this.values.addsWatermarks()||!1,children:app.translator.trans("flagrow-upload.admin.labels.watermark.toggle"),onchange:this.values.addsWatermarks}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.watermark.position")),m("div",{},[N.a.component({options:this.watermarkPositions,onchange:this.values.watermarkPosition,value:this.values.watermarkPosition()||"bottom-right"})]),m("label",{},app.translator.trans("flagrow-upload.admin.labels.watermark.file")),m(A.a,{name:"flagrow/watermark"})]),m("fieldset",{className:"UploadPage-downloading"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.disable-hotlink-protection.title")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.disable-hotlink-protection")),P.a.component({state:this.values.disableHotlinkProtection()||!1,children:app.translator.trans("flagrow-upload.admin.labels.disable-hotlink-protection.toggle"),onchange:this.values.disableHotlinkProtection}),m("legend",{},app.translator.trans("flagrow-upload.admin.labels.disable-download-logging.title")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.disable-download-logging")),P.a.component({state:this.values.disableDownloadLogging()||!1,children:app.translator.trans("flagrow-upload.admin.labels.disable-download-logging.toggle"),onchange:this.values.disableDownloadLogging})]),m("fieldset",{className:"UploadPage-local"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.local.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.local.cdn_url")),m("input",{className:"FormControl",value:this.values.cdnUrl()||"",oninput:m.withAttr("value",this.values.cdnUrl)})]),m("fieldset",{className:"UploadPage-imgur"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.imgur.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.imgur.client_id")),m("input",{className:"FormControl",value:this.values.imgurClientId()||"",oninput:m.withAttr("value",this.values.imgurClientId)})]),m("fieldset",{className:"UploadPage-aws-s3"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.key")),m("input",{className:"FormControl",value:this.values.awsS3Key()||"",oninput:m.withAttr("value",this.values.awsS3Key)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.secret")),m("input",{className:"FormControl",value:this.values.awsS3Secret()||"",oninput:m.withAttr("value",this.values.awsS3Secret)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.bucket")),m("input",{className:"FormControl",value:this.values.awsS3Bucket()||"",oninput:m.withAttr("value",this.values.awsS3Bucket)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.region")),m("input",{className:"FormControl",value:this.values.awsS3Region()||"",oninput:m.withAttr("value",this.values.awsS3Region)})]),m("fieldset",{className:"UploadPage-ovh-svfs"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.container")),m("input",{className:"FormControl",value:this.values.ovhContainer()||"",oninput:m.withAttr("value",this.values.ovhContainer)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.tenantid")),m("input",{className:"FormControl",value:this.values.ovhTenantId()||"",oninput:m.withAttr("value",this.values.ovhTenantId)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.username")),m("input",{className:"FormControl",value:this.values.ovhUsername()||"",oninput:m.withAttr("value",this.values.ovhUsername)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.password")),m("input",{className:"FormControl",value:this.values.ovhPassword()||"",oninput:m.withAttr("value",this.values.ovhPassword)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.region")),m("input",{className:"FormControl",value:this.values.ovhRegion()||"",oninput:m.withAttr("value",this.values.ovhRegion)})]),m("fieldset",{className:"UploadPage-backblaze-b2"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.backblaze-b2.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.backblaze-b2.accountid")),m("input",{className:"FormControl",value:this.values.b2AccountId()||"",oninput:m.withAttr("value",this.values.b2AccountId)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.backblaze-b2.applicationkey")),m("input",{className:"FormControl",value:this.values.b2ApplicationKey()||"",oninput:m.withAttr("value",this.values.b2ApplicationKey)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.backblaze-b2.bucketname")),m("input",{className:"FormControl",value:this.values.b2BucketName()||"",oninput:m.withAttr("value",this.values.b2BucketName)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.backblaze-b2.downloadurl")),m("input",{className:"FormControl",value:this.values.b2DownloadUrl()||"",oninput:m.withAttr("value",this.values.b2DownloadUrl)})]),g.a.component({type:"submit",className:"Button Button--primary",children:app.translator.trans("flagrow-upload.admin.buttons.save"),loading:this.loading,disabled:!this.changed()})])])])]},t.getTemplateOptionsForInput=function(){var a=[];for(var e in this.templateOptions)a[e]=this.templateOptions[e].name;return a},t.updateMimeTypeKey=function(a,e){this.values.mimeTypes()[e]=this.values.mimeTypes()[a],this.deleteMimeType(a)},t.updateMimeTypeAdapter=function(a,e,t){e.adapter=t,this.values.mimeTypes()[a]=e},t.updateMimeTypeTemplate=function(a,e,t){e.template=t,this.values.mimeTypes()[a]=e},t.deleteMimeType=function(a){delete this.values.mimeTypes()[a]},t.templateOptionsDescriptions=function(){var a=[];for(var e in this.templateOptions)a.push(m("li",this.templateOptions[e].name+": "+this.templateOptions[e].description));return m("ul",a)},t.addMimeType=function(){this.values.mimeTypes()[this.newMimeType.regex()]={adapter:this.newMimeType.adapter(),template:this.newMimeType.template()},this.newMimeType.regex(""),this.newMimeType.adapter("local"),this.newMimeType.template("file")},t.changed=function(){var a=this,e=this.fields.some(function(e){return a.values[e]()!==app.data.settings[a.addPrefix(e)]}),t=this.checkboxes.some(function(e){return a.values[e]()!==("1"==app.data.settings[a.addPrefix(e)])}),l=this.objects.some(function(e){return JSON.stringify(a.values[e]())!==app.data.settings[a.addPrefix(e)]});return e||t||l},t.onsubmit=function(a){var e=this;if(a.preventDefault(),!this.loading){this.loading=!0,app.alerts.dismiss(this.successAlert);var t={};this.fields.forEach(function(a){return t[e.addPrefix(a)]=e.values[a]()}),this.checkboxes.forEach(function(a){return t[e.addPrefix(a)]=e.values[a]()}),this.objects.forEach(function(a){return t[e.addPrefix(a)]=JSON.stringify(e.values[a]())}),w()(t).then(function(){app.alerts.show(e.successAlert=new x.a({type:"success",children:app.translator.trans("core.admin.basics.saved_message")}))}).catch(function(){}).then(function(){e.loading=!1,m.redraw()})}},t.addPrefix=function(a){return this.settingsPrefix+"."+a},e}(f.a),S=function(){app.routes["flagrow-upload"]={path:"/flagrow/upload",component:O.component()},app.extensionSettings["flagrow-upload"]=function(){return m.route(app.route("flagrow-upload"))},Object(l.extend)(p.a.prototype,"items",function(a){a.add("flagrow-upload",d.a.component({href:app.route("flagrow-upload"),icon:"far fa-file",children:"File Upload",description:app.translator.trans("flagrow-upload.admin.help_texts.description")}))})};n.a.initializers.add("flagrow-upload",function(a){S(),Object(l.extend)(i.a.prototype,"startItems",function(e){e.add("upload",{icon:"far fa-file",label:a.translator.trans("flagrow-upload.admin.permissions.upload_label"),permission:"flagrow.upload"})}),Object(l.extend)(i.a.prototype,"viewItems",function(e){e.add("download",{icon:"fas fa-download",label:a.translator.trans("flagrow-upload.admin.permissions.download_label"),permission:"flagrow.upload.download",allowGuest:!0})})})}]);
//# sourceMappingURL=admin.js.map