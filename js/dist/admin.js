module.exports=function(e){var a={};function t(o){if(a[o])return a[o].exports;var l=a[o]={i:o,l:!1,exports:{}};return e[o].call(l.exports,l,l.exports,t),l.l=!0,l.exports}return t.m=e,t.c=a,t.d=function(e,a,o){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var l in e)t.d(o,l,function(a){return e[a]}.bind(null,l));return o},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=18)}([function(e,a){e.exports=flarum.core.compat.extend},function(e,a){e.exports=flarum.core.compat["components/Select"]},function(e,a,t){"use strict";function o(e,a){e.prototype=Object.create(a.prototype),e.prototype.constructor=e,e.__proto__=a}t.d(a,"a",function(){return o})},function(e,a){e.exports=flarum.core.compat.Component},function(e,a){e.exports=flarum.core.compat["components/Switch"]},function(e,a){e.exports=flarum.core.compat["components/Button"]},,function(e,a){e.exports=flarum.core.compat["components/PermissionGrid"]},,,,function(e,a){e.exports=flarum.core.compat.app},function(e,a){e.exports=flarum.core.compat["components/AdminNav"]},function(e,a){e.exports=flarum.core.compat["components/AdminLinkButton"]},function(e,a){e.exports=flarum.core.compat["utils/saveSettings"]},function(e,a){e.exports=flarum.core.compat["components/Alert"]},function(e,a){e.exports=flarum.core.compat["components/UploadImageButton"]},,function(e,a,t){"use strict";t.r(a);var o=t(0),l=t(11),s=t.n(l),n=t(7),r=t.n(n),i=t(12),p=t.n(i),u=t(13),d=t.n(u),c=t(2),h=t(3),f=t.n(h),g=t(5),v=t.n(g),w=t(14),b=t.n(w),y=t(15),x=t.n(y),T=t(1),N=t.n(T),P=t(4),M=t.n(P),k=t(16),S=t.n(k),C=function(e){function a(){return e.apply(this,arguments)||this}Object(c.a)(a,e);var t=a.prototype;return t.init=function(){var e=this;this.loading=!1,this.fields=["resizeMaxWidth","cdnUrl","maxFileSize","overrideAvatarUpload","watermark","watermarkPosition","imgurClientId","googleCloudStorageProjectId","googleCloudStorageCredentialsFile","googleCloudStorageBucket","awsS3Key","awsS3Secret","awsS3Bucket","awsS3Region","ovhUsername","ovhPassword","ovhTenantId","ovhContainer","ovhRegion"],this.checkboxes=["mustResize","overrideAvatarUpload","addsWatermarks","disableHotlinkProtection","disableDownloadLogging"],this.objects=["mimeTypes"],this.watermarkPositions={"top-left":"top-left","top-right":"top-right","bottom-left":"bottom-left","bottom-right":"bottom-right",center:"center",left:"left",top:"top",right:"right",bottom:"bottom"};var a=app.data.settings;this.settingsPrefix="flagrow.upload",this.uploadMethodOptions=a[this.addPrefix("availableUploadMethods")]||{},this.templateOptions=a[this.addPrefix("availableTemplates")]||{},this.values={},this.fields.forEach(function(t){return e.values[t]=m.prop(a[e.addPrefix(t)])}),this.checkboxes.forEach(function(t){return e.values[t]=m.prop("1"===a[e.addPrefix(t)])}),this.objects.forEach(function(t){return e.values[t]=a[e.addPrefix(t)]?m.prop(JSON.parse(a[e.addPrefix(t)])):m.prop()}),this.values.mimeTypes()||(this.values.mimeTypes=m.prop({"^image\\/.*":{adapter:"local",template:"image-preview"}})),this.newMimeType={regex:m.prop(""),adapter:m.prop("local"),template:m.prop("file")}},t.view=function(){var e=this;return[m("div",{className:"UploadPage"},[m("div",{className:"container"},[m("form",{onsubmit:this.onsubmit.bind(this)},[m("fieldset",{className:"UploadPage-preferences"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.preferences.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.preferences.max_file_size")),m("input",{className:"FormControl",value:this.values.maxFileSize()||2048,oninput:m.withAttr("value",this.values.maxFileSize)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.preferences.mime_types")),m("div",{className:"MimeTypes--Container"},Object.keys(this.values.mimeTypes()).map(function(a){var t=e.values.mimeTypes()[a];return"object"!=typeof t&&(t={adapter:t,template:"file"}),m("div",{},[m("input",{className:"FormControl MimeTypes",value:a,oninput:m.withAttr("value",e.updateMimeTypeKey.bind(e,a))}),N.a.component({options:e.uploadMethodOptions,onchange:e.updateMimeTypeAdapter.bind(e,a,t),value:t.adapter||"local"}),N.a.component({options:e.getTemplateOptionsForInput(),onchange:e.updateMimeTypeTemplate.bind(e,a,t),value:t.template||"local"}),v.a.component({type:"button",className:"Button Button--warning",children:"x",onclick:e.deleteMimeType.bind(e,a)})])}),m("br"),m("div",{},[m("input",{className:"FormControl MimeTypes add-MimeType-key",value:this.newMimeType.regex(),oninput:m.withAttr("value",this.newMimeType.regex)}),N.a.component({options:this.uploadMethodOptions,className:"add-MimeType-value",oninput:m.withAttr("value",this.newMimeType.adapter),value:this.newMimeType.adapter()}),N.a.component({options:this.getTemplateOptionsForInput(),className:"add-MimeType-value",oninput:m.withAttr("value",this.newMimeType.template),value:this.newMimeType.template()}),v.a.component({type:"button",className:"Button Button--warning",children:"+",onclick:this.addMimeType.bind(this)})])),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.mime_types")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.download_templates")),this.templateOptionsDescriptions()]),m("fieldset",{className:"UploadPage-resize"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.resize.title")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.resize")),M.a.component({state:this.values.mustResize()||!1,children:app.translator.trans("flagrow-upload.admin.labels.resize.toggle"),onchange:this.values.mustResize}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.resize.max_width")),m("input",{className:"FormControl",value:this.values.resizeMaxWidth()||100,oninput:m.withAttr("value",this.values.resizeMaxWidth),disabled:!this.values.mustResize()})]),m("fieldset",{className:"UploadPage-watermark"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.watermark.title")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.watermark")),M.a.component({state:this.values.addsWatermarks()||!1,children:app.translator.trans("flagrow-upload.admin.labels.watermark.toggle"),onchange:this.values.addsWatermarks}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.watermark.position")),m("div",{},[N.a.component({options:this.watermarkPositions,onchange:this.values.watermarkPosition,value:this.values.watermarkPosition()||"bottom-right"})]),m("label",{},app.translator.trans("flagrow-upload.admin.labels.watermark.file")),m(S.a,{name:"flagrow/watermark"})]),m("fieldset",{className:"UploadPage-downloading"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.disable-hotlink-protection.title")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.disable-hotlink-protection")),M.a.component({state:this.values.disableHotlinkProtection()||!1,children:app.translator.trans("flagrow-upload.admin.labels.disable-hotlink-protection.toggle"),onchange:this.values.disableHotlinkProtection}),m("legend",{},app.translator.trans("flagrow-upload.admin.labels.disable-download-logging.title")),m("div",{className:"helpText"},app.translator.trans("flagrow-upload.admin.help_texts.disable-download-logging")),M.a.component({state:this.values.disableDownloadLogging()||!1,children:app.translator.trans("flagrow-upload.admin.labels.disable-download-logging.toggle"),onchange:this.values.disableDownloadLogging})]),m("fieldset",{className:"UploadPage-local"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.local.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.local.cdn_url")),m("input",{className:"FormControl",value:this.values.cdnUrl()||"",oninput:m.withAttr("value",this.values.cdnUrl)})]),m("fieldset",{className:"UploadPage-imgur"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.imgur.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.imgur.client_id")),m("input",{className:"FormControl",value:this.values.imgurClientId()||"",oninput:m.withAttr("value",this.values.imgurClientId)})]),m("fieldset",{className:"UploadPage-google-cloud-storage"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.google-cloud-storage.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.google-cloud-storage.project_id")),m("input",{className:"FormControl",value:this.values.googleCloudStorageProjectId()||"",oninput:m.withAttr("value",this.values.googleCloudStorageProjectId)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.google-cloud-storage.credentials_file")),m("input",{className:"FormControl",value:this.values.googleCloudStorageCredentialsFile()||"",oninput:m.withAttr("value",this.values.googleCloudStorageCredentialsFile)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.google-cloud-storage.bucket")),m("input",{className:"FormControl",value:this.values.googleCloudStorageBucket()||"",oninput:m.withAttr("value",this.values.googleCloudStorageBucket)})]),m("fieldset",{className:"UploadPage-aws-s3"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.key")),m("input",{className:"FormControl",value:this.values.awsS3Key()||"",oninput:m.withAttr("value",this.values.awsS3Key)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.secret")),m("input",{className:"FormControl",value:this.values.awsS3Secret()||"",oninput:m.withAttr("value",this.values.awsS3Secret)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.bucket")),m("input",{className:"FormControl",value:this.values.awsS3Bucket()||"",oninput:m.withAttr("value",this.values.awsS3Bucket)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.aws-s3.region")),m("input",{className:"FormControl",value:this.values.awsS3Region()||"",oninput:m.withAttr("value",this.values.awsS3Region)})]),m("fieldset",{className:"UploadPage-ovh-svfs"},[m("legend",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.title")),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.container")),m("input",{className:"FormControl",value:this.values.ovhContainer()||"",oninput:m.withAttr("value",this.values.ovhContainer)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.tenantid")),m("input",{className:"FormControl",value:this.values.ovhTenantId()||"",oninput:m.withAttr("value",this.values.ovhTenantId)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.username")),m("input",{className:"FormControl",value:this.values.ovhUsername()||"",oninput:m.withAttr("value",this.values.ovhUsername)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.password")),m("input",{className:"FormControl",value:this.values.ovhPassword()||"",oninput:m.withAttr("value",this.values.ovhPassword)}),m("label",{},app.translator.trans("flagrow-upload.admin.labels.ovh-svfs.region")),m("input",{className:"FormControl",value:this.values.ovhRegion()||"",oninput:m.withAttr("value",this.values.ovhRegion)})]),v.a.component({type:"submit",className:"Button Button--primary",children:app.translator.trans("flagrow-upload.admin.buttons.save"),loading:this.loading,disabled:!this.changed()})])])])]},t.getTemplateOptionsForInput=function(){var e=[];for(var a in this.templateOptions)e[a]=this.templateOptions[a].name;return e},t.updateMimeTypeKey=function(e,a){this.values.mimeTypes()[a]=this.values.mimeTypes()[e],this.deleteMimeType(e)},t.updateMimeTypeAdapter=function(e,a,t){a.adapter=t,this.values.mimeTypes()[e]=a},t.updateMimeTypeTemplate=function(e,a,t){a.template=t,this.values.mimeTypes()[e]=a},t.deleteMimeType=function(e){delete this.values.mimeTypes()[e]},t.templateOptionsDescriptions=function(){var e=[];for(var a in this.templateOptions)e.push(m("li",this.templateOptions[a].name+": "+this.templateOptions[a].description));return m("ul",e)},t.addMimeType=function(){this.values.mimeTypes()[this.newMimeType.regex()]={adapter:this.newMimeType.adapter(),template:this.newMimeType.template()},this.newMimeType.regex(""),this.newMimeType.adapter("local"),this.newMimeType.template("file")},t.changed=function(){var e=this,a=this.fields.some(function(a){return e.values[a]()!==app.data.settings[e.addPrefix(a)]}),t=this.checkboxes.some(function(a){return e.values[a]()!==("1"==app.data.settings[e.addPrefix(a)])}),o=this.objects.some(function(a){return JSON.stringify(e.values[a]())!==app.data.settings[e.addPrefix(a)]});return a||t||o},t.onsubmit=function(e){var a=this;if(e.preventDefault(),!this.loading){this.loading=!0,app.alerts.dismiss(this.successAlert);var t={};this.fields.forEach(function(e){return t[a.addPrefix(e)]=a.values[e]()}),this.checkboxes.forEach(function(e){return t[a.addPrefix(e)]=a.values[e]()}),this.objects.forEach(function(e){return t[a.addPrefix(e)]=JSON.stringify(a.values[e]())}),b()(t).then(function(){app.alerts.show(a.successAlert=new x.a({type:"success",children:app.translator.trans("core.admin.basics.saved_message")}))}).catch(function(){}).then(function(){a.loading=!1,m.redraw()})}},t.addPrefix=function(e){return this.settingsPrefix+"."+e},a}(f.a),O=function(){app.routes["flagrow-upload"]={path:"/flagrow/upload",component:C.component()},app.extensionSettings["flagrow-upload"]=function(){return m.route(app.route("flagrow-upload"))},Object(o.extend)(p.a.prototype,"items",function(e){e.add("flagrow-upload",d.a.component({href:app.route("flagrow-upload"),icon:"far fa-file",children:"File Upload",description:app.translator.trans("flagrow-upload.admin.help_texts.description")}))})};s.a.initializers.add("flagrow-upload",function(e){O(),Object(o.extend)(r.a.prototype,"startItems",function(a){a.add("upload",{icon:"far fa-file",label:e.translator.trans("flagrow-upload.admin.permissions.upload_label"),permission:"flagrow.upload"})}),Object(o.extend)(r.a.prototype,"viewItems",function(a){a.add("download",{icon:"fas fa-download",label:e.translator.trans("flagrow-upload.admin.permissions.download_label"),permission:"flagrow.upload.download",allowGuest:!0})})})}]);
//# sourceMappingURL=admin.js.map